---
slug: /native-protocol/server
sidebar_position: 3
---

# サーバーパケット

| 値   | 名称                           | 説明                                                         |
|------|-------------------------------|--------------------------------------------------------------|
| 0    | [こんにちは](#hello)           | サーバーハンドシェイクレスポンス                            |
| 1    | データ                        | [クライアントデータ](./client.md#data) と同じ                   |
| 2    | [例外](#exception)            | クエリ処理例外                                              |
| 3    | [進行状況](#progress)          | クエリ進行状況                                              |
| 4    | [ポン](#pong)                 | ピンレスポンス                                              |
| 5    | [ストリームの終わり](#end-of-stream) | すべてのパケットが転送された                                 |
| 6    | [プロファイル情報](#profile-info) | プロファイリングデータ                                       |
| 7    | 合計                          | 総合値                                                     |
| 8    | 極値                          | 極値（最小、最大）                                          |
| 9    | テーブルステータスレスポンス | TableStatusリクエストに対するレスポンス                    |
| 10   | [ログ](#log)                  | クエリシステムログ                                          |
| 11   | テーブルカラム                | カラムの説明                                               |
| 12   | UUIDs                        | ユニークパーツIDのリスト                                   |
| 13   | ReadTaskRequest               | 次のタスクが必要なリクエストを示す文字列（UUID）             |
| 14   | [プロファイルイベント](#profile-events) | サーバーからのプロファイルイベントパケット                  |

`データ`、`合計`、および`極値`は圧縮可能です。

## こんにちは {#hello}

[クライアントハロー](./client.md#hello)に対するレスポンス。

| フィールド         | 型      | 値               | 説明                     |
|-------------------|---------|------------------|-------------------------|
| 名前              | 文字列   | `Clickhouse`      | サーバー名               |
| バージョン（メジャー） | UVarInt | `21`             | サーバーメジャーバージョン |
| バージョン（マイナー） | UVarInt | `12`             | サーバーマイナーバージョン |
| リビジョン        | UVarInt | `54452`          | サーバーリビジョン       |
| tz                | 文字列   | `Europe/Moscow`  | サーバータイムゾーン     |
| ディスプレイ名    | 文字列   | `Clickhouse`      | UI用のサーバー名        |
| バージョン（パッチ） | UVarInt | `3`              | サーバーパッチバージョン |

## 例外 {#exception}

クエリ処理中のサーバー例外。

| フィールド       | 型     | 値                                    | 説明                          |
|------------------|--------|-------------------------------------|-------------------------------|
| コード           | Int32  | `60`                                | [エラーコード](https://clickhouse.com/codebrowser/ClickHouse/src/Common/ErrorCodes.cpp.html "List of error codes")を参照。 |
| 名前             | 文字列  | `DB::Exception`                     | サーバーメジャーバージョン  |
| メッセージ       | 文字列  | `DB::Exception: テーブル X が存在しません` | サーバーマイナーバージョン  |
| スタックトレース | 文字列  | ~                                   | C++スタックトレース          |
| ネスト           | ブール  | `true`                             | さらなるエラー               |

`nested`が`false`になるまで例外の連続リストが可能。

## 進行状況 {#progress}

サーバーによって定期的に報告されるクエリ実行の進行状況。

:::tip
進行状況は**デルタ**で報告されます。合計はクライアントで蓄積してください。
:::

| フィールド       | 型      | 値      | 説明               |
|------------------|---------|---------|--------------------|
| 行数            | UVarInt | `65535` | 行の数            |
| バイト数        | UVarInt | `871799`| バイトの数        |
| 合計行数        | UVarInt | `0`     | 合計行数          |
| 書き込み行数    | UVarInt | `0`     | クライアントからの行数  |
| 書き込みバイト数 | UVarInt | `0`     | クライアントからのバイト数 |

## ポン {#pong}

[クライアントピン](./client.md#ping)に対するレスポンス、パケットボディなし。

## ストリームの終わり {#end-of-stream}

これ以上の**データ**パケットは送信されず、クエリ結果はサーバーからクライアントへ完全にストリーミングされています。

パケットボディなし。

## プロファイル情報 {#profile-info}

| フィールド                        | 型      |
|-----------------------------------|---------|
| 行数                             | UVarInt |
| ブロック                          | UVarInt |
| バイト                           | UVarInt |
| 適用された制限                    | ブール   |
| 制限前の行数                      | UVarInt |
| 制限前に計算された行数           | ブール   |

## ログ {#log}

**データブロック**でのサーバーログ。

:::tip
**データブロック**のカラムとしてエンコードされますが、決して圧縮されることはありません。
:::

| カラム     | 型      |
|------------|---------|
| 時間       | DateTime |
| 時間（マイクロ） | UInt32   |
| ホスト名   | 文字列   |
| クエリID   | 文字列   |
| スレッドID | UInt64   |
| 優先度     | Int8     |
| ソース     | 文字列   |
| テキスト   | 文字列   |

## プロファイルイベント {#profile-events}

**データブロック**でのプロファイルイベント。

:::tip
**データブロック**のカラムとしてエンコードされますが、決して圧縮されることはありません。

`値`の型はサーバーリビジョンに応じて`UInt64`または`Int64`です。
:::

| カラム       | 型              |
|--------------|-----------------|
| ホスト名     | 文字列          |
| 現在の時間   | DateTime        |
| スレッドID   | UInt64          |
| タイプ       | Int8            |
| 名前         | 文字列          |
| 値           | UInt64 または Int64 |
