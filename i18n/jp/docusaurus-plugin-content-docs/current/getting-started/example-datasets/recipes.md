---
description: 'RecipeNLGデータセット、220万のレシピを含む'
sidebar_label: 'レシピデータセット'
slug: /getting-started/example-datasets/recipes
title: 'レシピデータセット'
---

RecipeNLGデータセットは[こちら](https://recipenlg.cs.put.poznan.pl/dataset)からダウンロードできます。220万のレシピを含んでいます。サイズは1GB未満です。
## データセットのダウンロードと解凍 {#download-and-unpack-the-dataset}

1. ダウンロードページに移動します [https://recipenlg.cs.put.poznan.pl/dataset](https://recipenlg.cs.put.poznan.pl/dataset)。
2. 利用規約に同意し、zipファイルをダウンロードします。
3. オプション: `md5sum dataset.zip`を使用してzipファイルを検証し、`3a168dfd0912bb034225619b3586ce76`と等しいはずです。
4. `unzip dataset.zip`を使用してzipファイルを解凍します。`dataset`ディレクトリ内に`full_dataset.csv`ファイルが生成されます。
## テーブルを作成する {#create-a-table}

clickhouse-clientを実行し、次のCREATEクエリを実行します:

```sql
CREATE TABLE recipes
(
    title String,
    ingredients Array(String),
    directions Array(String),
    link String,
    source LowCardinality(String),
    NER Array(String)
) ENGINE = MergeTree ORDER BY title;
```
## データを挿入する {#insert-the-data}

次のコマンドを実行します:

```bash
clickhouse-client --query "
    INSERT INTO recipes
    SELECT
        title,
        JSONExtract(ingredients, 'Array(String)'),
        JSONExtract(directions, 'Array(String)'),
        link,
        source,
        JSONExtract(NER, 'Array(String)')
    FROM input('num UInt32, title String, ingredients String, directions String, link String, source LowCardinality(String), NER String')
    FORMAT CSVWithNames
" --input_format_with_names_use_header 0 --format_csv_allow_single_quote 0 --input_format_allow_errors_num 10 < full_dataset.csv
```

これはカスタムCSVを解析する方法のショーケースであり、いくつかの調整が必要です。

説明:
- データセットはCSV形式ですが、挿入時にいくつかの前処理が必要です; テーブル関数 [input](../../sql-reference/table-functions/input.md) を使用して前処理を行います;
- CSVファイルの構造はテーブル関数`input`の引数で指定されます;
- フィールド`num`（行番号）は不要であり、ファイルから解析して無視します;
- `FORMAT CSVWithNames`を使用しますが、CSVのヘッダーは無視されます（コマンドラインパラメータ `--input_format_with_names_use_header 0`によって）、ヘッダーは最初のフィールドの名前を含まないためです;
- ファイルはCSV文字列を囲むためにダブルクォーテーションのみを使用します; 一部の文字列はダブルクォーテーションで囲まれていないため、シングルクォートは文字列を囲むものとして解析されてはならない - だから、`--format_csv_allow_single_quote 0`パラメータも追加しています;
- CSVからの一部の文字列は解析できません。これは、値の先頭に`\M/`シーケンスが含まれているためです; CSVでバックスラッシュで始まる唯一の値は`\N`であり、SQL NULLとして解析されます。`--input_format_allow_errors_num 10`パラメータを追加し、最大で10個の無効なレコードをスキップできます;
- 材料、手順、NERフィールドのための配列があります; これらの配列は異常な形で表現されています: JSONとして文字列にシリアライズされ、その後CSVに配置されます - それらをStringとして解析し、次に [JSONExtract](../../sql-reference/functions/json-functions.md) 関数を使用してArrayに変換します。
## 挿入されたデータの検証 {#validate-the-inserted-data}

行数をチェックすることで:

クエリ:

```sql
SELECT count() FROM recipes;
```

結果:

```text
┌─count()─┐
│ 2231142 │
└─────────┘
```
## 例クエリ {#example-queries}
### レシピ数によるトップコンポーネント: {#top-components-by-the-number-of-recipes}

この例では、[arrayJoin](../../sql-reference/functions/array-join.md)関数を使用して配列を行のセットに展開する方法を学びます。

クエリ:

```sql
SELECT
    arrayJoin(NER) AS k,
    count() AS c
FROM recipes
GROUP BY k
ORDER BY c DESC
LIMIT 50
```

結果:

```text
┌─k────────────────────┬──────c─┐
│ salt                 │ 890741 │
│ sugar                │ 620027 │
│ butter               │ 493823 │
│ flour                │ 466110 │
│ eggs                 │ 401276 │
│ onion                │ 372469 │
│ garlic               │ 358364 │
│ milk                 │ 346769 │
│ water                │ 326092 │
│ vanilla              │ 270381 │
│ olive oil            │ 197877 │
│ pepper               │ 179305 │
│ brown sugar          │ 174447 │
│ tomatoes             │ 163933 │
│ egg                  │ 160507 │
│ baking powder        │ 148277 │
│ lemon juice          │ 146414 │
│ Salt                 │ 122558 │
│ cinnamon             │ 117927 │
│ sour cream           │ 116682 │
│ cream cheese         │ 114423 │
│ margarine            │ 112742 │
│ celery               │ 112676 │
│ baking soda          │ 110690 │
│ parsley              │ 102151 │
│ chicken              │ 101505 │
│ onions               │  98903 │
│ vegetable oil        │  91395 │
│ oil                  │  85600 │
│ mayonnaise           │  84822 │
│ pecans               │  79741 │
│ nuts                 │  78471 │
│ potatoes             │  75820 │
│ carrots              │  75458 │
│ pineapple            │  74345 │
│ soy sauce            │  70355 │
│ black pepper         │  69064 │
│ thyme                │  68429 │
│ mustard              │  65948 │
│ chicken broth        │  65112 │
│ bacon                │  64956 │
│ honey                │  64626 │
│ oregano              │  64077 │
│ ground beef          │  64068 │
│ unsalted butter      │  63848 │
│ mushrooms            │  61465 │
│ Worcestershire sauce │  59328 │
│ cornstarch           │  58476 │
│ green pepper         │  58388 │
│ Cheddar cheese       │  58354 │
└──────────────────────┴────────┘

50行のセットです。経過時間: 0.112秒。2.23百万行、361.57MBを処理しました (19.99百万行/秒, 3.24 GB/秒.)
```
```yaml
title: 'ストロベリーを使った最も複雑なレシピ'
sidebar_label: 'ストロベリーを使った最も複雑なレシピ'
keywords: ['ストロベリー', 'レシピ', 'クエリ', 'SQL']
description: 'ストロベリーに関連する最も複雑なレシピを取得するためのクエリとその結果を示します。'
```

### ストロベリーを使った最も複雑なレシピ {#the-most-complex-recipes-with-strawberry}

```sql
SELECT
    title,
    length(NER),
    length(directions)
FROM recipes
WHERE has(NER, 'strawberry')
ORDER BY length(directions) DESC
LIMIT 10
```

結果:

```text
┌─title────────────────────────────────────────────────────────────┬─length(NER)─┬─length(directions)─┐
│ チョコレート・ストロベリー・オレンジ ウェディングケーキ                     │          24 │                126 │
│ ストロベリークリームチーズクランブルタルト                                 │          19 │                 47 │
│ シャルロットスタイルアイスクリーム                                       │          11 │                 45 │
│ 段重ねチョコレートレイヤーケーキ、ストロベリー入り                         │          31 │                 45 │
│ エルダーフラワーシャーベットと一緒の甘いベリー                             │          24 │                 44 │
│ チョコレート・ストロベリー・ムースケーキ                                 │          15 │                 42 │
│ ストロベリーとラム入りのルバーブシャルロット                               │          20 │                 42 │
│ シェフ・ジョイのストロベリーバニラタルト                                   │           7 │                 37 │
│ オールドファッションアイスクリームサンデーケーキ                         │          17 │                 37 │
│ ウォーターメロンケーキ                                                     │          16 │                 36 │
└──────────────────────────────────────────────────────────────────┴─────────────┴────────────────────┘

10 行がセットされています。経過時間: 0.215 秒。処理された行数: 2.23百万行, 1.48 GB (10.35百万行/秒., 6.86 GB/秒.)
```

この例では、 [has](../../sql-reference/functions/array-functions.md#hasarr-elem) 関数を使用して配列の要素でフィルタリングし、指示の数でソートしています。

126 ステップも必要なウェディングケーキがあります！その指示を確認しましょう:

クエリ:

```sql
SELECT arrayJoin(directions)
FROM recipes
WHERE title = 'Chocolate-Strawberry-Orange Wedding Cake'
```

結果:

```text
┌─arrayJoin(directions)───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ オーブンの中央に1つと下部の1/3に1つラックを配置し、350Fに予熱します。                                                                                               │
│ 直径5インチ、高さ2インチのケーキパン1つ、直径8インチ、高さ2インチのケーキパン1つ、直径12インチ、高さ2インチのケーキパン1つにバターを塗ります。                                           │
│ パンに小麦粉をふりかけ、底をクッキングシートで整えます。                                                                                                                            │
│ 厚手の小鍋に1/3カップのオレンジジュースと2オンスの無糖チョコレートを入れて混ぜます。                                                                                          │
│ 中火でかき混ぜながらチョコレートが溶けるまで加熱します。                                                                                                                          │
│ 熱から下ろします。                                                                                                                                                           │
│ 1 2/3カップのオレンジジュースを徐々に混ぜ込みます。                                                                                                                                   │
│ 中くらいのボウルに3カップの小麦粉、2/3カップのココア、2ティースプーンのベーキングソーダ、1ティースプーンの塩、1/2ティースプーンのベーキングパウダーをふるい入れます。                                               │
│ 電動ミキサーを使用して、大きなボウルに1カップ（2本）バターと3カップの砂糖を混ぜます（混合物はザラザラに見えます）。                                                           │
│ 卵4個を1個ずつ加え、各々しっかりと混ぜます。                                                                                                                                       │
│ 1テーブルスプーンのオレンジの皮と1テーブルスプーンのバニラエッセンスを混ぜ込みます。                                                                                                         │
│ ドライ材料をオレンジジュースの混合物と交互に3回に分けて混ぜ入れ、各回がしっかりと混ざるようにします。                                                                        │
│ 1カップのチョコレートチップを混ぜ込みます。                                                                                                                                               │
│ 準備した5インチのパンに1カッププラス2テーブルスプーンのバッターを、準備した8インチのパンに3カップのバッターを、残りのバッター（約6カップ）を12インチのパンに移します。                                         │
│ 5インチと8インチのパンをオーブンの中央のラックに配置します。                                                                                                                    │
│ 12インチのパンをオーブンの下のラックに配置します。                                                                                                                                    │
│ 各ケーキをテスターを中央に挿してきれいに出てくるまで、約35分焼きます。                                                                                                        │
│ パンのケーキをラックに移し、完全に冷ます。                                                                                                                                               │
│ 6インチの段ボードに直径4インチの円をマークします。                                                                                                                                  │
│ マークした円を切り抜きます。                                                                                                                                                      │
│ 8インチの段ボードに直径7インチの円をマークします。                                                                                                                                  │
│ マークした円を切り抜きます。                                                                                                                                                      │
│ 12インチの段ボードに直径11インチの円をマークします。                                                                                                                                │
│ マークした円を切り抜きます。                                                                                                                                                      │
│ 5インチのケーキの周りを切って緩めます。                                                                                                                                              │
│ パンの上に4インチの段ボードを置きます。                                                                                                                                           │
│ 段ボードとパンを一緒に持ち、ケーキを段ボードにひっくり返します。                                                                                                                   │
│ パーチメントを剥がします。ケーキをその段ボードにアルミホイルで包みます。                                                                                                         │
│ ひっくり返され、パーチメントを剥がし、アルミホイルでケーキを包む行為を繰り返します。8インチのケーキには7インチの段ボードを、12インチのケーキには11インチの段ボードを使用します。                      │
│ 残りの材料を使用して、ケーキのバッターのバッチを1つ作り、上記と同様に3層のケーキを焼きます。                                                                                  │
│ ケーキをパンの中で冷まします。                                                                                                                                                      │
│ ケーキをパンの中でしっかりとアルミホイルで覆います。                                                                                                                                │
│ （事前に準備できます。                                                                                                                                                         │
│ 室温で1日まで置いておくか、すべてのケーキ層をダブルラップし、1週間まで冷凍します。                                                                                         │
│ 使用する前にケーキ層を室温に戻します。）                                                                                                                                               │
│ 最初の12インチのケーキをその段ボードの上に作業面に置きます。                                                                                                                     │
│ ケーキの上に2 3/4カップのガナッシュを均等に広げます。                                                                                                                            │
│ ガナッシュの上に2/3カップのジャムを広げ、エッジに1/2インチのチョコレートの境界を残します。                                                                                            │
│ 1 3/4カップのホワイトチョコレートフロスティングをスプーンでジャムの上に落とします。                                                                                           │
│ フロスティングをジャムの上に優しく広げ、エッジに1/2インチのチョコレートの境界を残します。                                                                                        │
│ 2番目の12インチの段ボードにココアパウダーをふりかけます。                                                                                                                         │
│ 2番目の12インチケーキの側面を切って緩めます。                                                                                                                                      │
│ 段ボードを、ココアが表の面を下にしてパンの上に置きます。                                                                                                                             │
│ ケーキを段ボードの上にひっくり返します。                                                                                                                                           │
│ パーチメントを剥がします。                                                                                                                                                          │
│ ケーキを段ボードから優しく滑らせ、最初の12インチケーキのフィリングの上に移します。                                                                                                 │
│ 冷蔵します。                                                                                                                                                                   │
│ 最初の8インチケーキをその段ボードの上に作業面に置きます。                                                                                                                       │
│ ケーキの上に1カップのガナッシュを全体に広げます。                                                                                                                                 │
│ 1/4カップのジャムを広げ、エッジに1/2インチのチョコレートの境界を残します。                                                                                                     │
│ フロスティングをスプーンでジャムの上に落とします。                                                                                                                                 │
│ フロスティングをジャムの上に優しく広げ、エッジに1/2インチのチョコレートの境界を残します。                                                                                        │
│ 2番目の8インチの段ボードをココアでふりかけます。                                                                                                                                     │
│ 2番目の8インチケーキの側面を切って緩めます。                                                                                                                                       │
│ 段ボードを、ココアが表の面を下にしてパンの上に置きます。                                                                                                                             │
│ ケーキを段ボードの上にひっくり返します。                                                                                                                                           │
│ パーチメントを剥がします。                                                                                                                                                          │
│ ケーキを段ボードから滑らせ、最初の8インチケーキのフィリングの上に移します。                                                                                                     │
│ 冷蔵します。                                                                                                                                                                   │
│ 最初の5インチケーキをその段ボードの上に作業面に置きます。                                                                                                                       │
│ ケーキの上に1/2カップのガナッシュを全体に広げます。                                                                                                                                 │
│ 2テーブルスプーンのジャムを広げ、エッジに1/2インチのチョコレートの境界を残します。                                                                                              │
│ フロスティングをスプーンでジャムの上に落とします。                                                                                                                                   │
│ フロスティングをジャムの上に優しく広げ、エッジに1/2インチのチョコレートの境界を残します。                                                                                        │
│ 2番目の6インチの段ボードをココアでふりかけます。                                                                                                                                     │
│ 2番目の5インチケーキの側面を切って緩めます。                                                                                                                                       │
│ 段ボードを、ココアが表の面を下にしてパンの上に置きます。                                                                                                                             │
│ ケーキを段ボードの上にひっくり返します。                                                                                                                                          │
│ パーチメントを剥がします。                                                                                                                                                          │
│ ケーキを段ボードから滑らせ、最初の5インチケーキのフィリングの上に移します。                                                                                                     │
│ すべてのケーキを1時間冷やしてフィリングをセットします。                                                                                                                │
│ 12インチの重ねたケーキをその段ボードの上に回転するケーキスタンドに置きます。                                                                                                 │
│ ケーキのトップと側面に2 2/3カップのフロスティングを最初のコートとして広げます。                                                                                             │
│ ケーキを冷蔵します。                                                                                                                                                                   │
│ 8インチの重ねたケーキをその段ボードの上にケーキスタンドに置きます。                                                                                                         │
│ ケーキのトップと側面に1 1/4カップのフロスティングを最初のコートとして広げます。                                                                                            │
│ ケーキを冷蔵します。                                                                                                                                                                   │
│ 5インチの重ねたケーキをその段ボードの上にケーキスタンドに置きます。                                                                                                         │
│ ケーキのトップと側面に3/4カップのフロスティングを最初のコートとして広げます。                                                                                               │
│ ケーキを冷蔵します。                                                                                                                                                                   │
│ 最初のフロスティングのコートがセットされるまで、すべてのケーキを冷蔵します。約1時間。                                                                                               │
│ （この時点までケーキを最大1日まで作成できます。覆って冷蔵してください。）                                                                                                        │
│ フロスティングの2回目のバッチを準備し、残りのフロスティング材料を使用し、最初のバッチの指示に従います。                                                                │
│ 小さな星型の口金を付けたパイプバッグに2カップのフロスティングをスプーンで入れます。                                                                                        │
│ 12インチケーキをその段ボードの上に大きな平らな皿に置きます。                                                                                                                  │
│ 皿をケーキスタンドの上に置きます。                                                                                                                                                  │
│ アイスリングスパトラを使用して、ケーキの上と側面に2 1/2カップのフロスティングを塗り、上部を滑らかにします。                                                                  │
│ 満たされたパイプバッグを使用して、ケーキの上端に装飾の境界を絞ります。                                                                                                    │
│ ケーキを皿の上で冷蔵します。                                                                                                                                                       │
│ 8インチのケーキをその段ボードの上にケーキスタンドに置きます。                                                                                                                 │
│ アイスリングスパトラを使用して、ケーキの上と側面に1 1/2カップのフロスティングを塗り、上部を滑らかにします。                                                                  │
│ パイプバッグを使用して、ケーキの上端に装飾の境界を絞ります。                                                                                                                │
│ ケーキを段ボードの上で冷蔵します。                                                                                                                                                 │
│ 5インチのケーキをその段ボードの上にケーキスタンドに置きます。                                                                                                                 │
│ アイスリングスパトラを使用して、ケーキの上と側面に3/4カップのフロスティングを塗り、上部を滑らかにします。                                                    │
│ パイプバッグを使用して、必要に応じて再度フロスティングを包んで、ケーキの上端に装飾を絞り出します。                                                                                     │
│ ケーキを段ボードの上で冷蔵します。                                                                                                                                                 │
│ フロスティングがセットされるまで、すべてのケーキを冷やしておきます。約2時間。                                                                                                   │
│ （最大2日前に準備できます。                                                                                                                                                      │
│ ゆるく覆って冷蔵します。）                                                                                                                                                      │
│ 12インチのケーキを作業面の皿の上に置きます。                                                                                                                                  │
│ 木のダウエルを真っ直ぐ下に押し込み、ケーキの中央を完全に貫通します。                                                                                       │
│ ダウエルをフロスティングの上から1/4インチの位置にマークします。                                                                                                          │
│ ダウエルを取り外し、マークした点で鋸の刃を使用して切ります。                                                                                                                    │
│ さらに4本のダウエルを同じ長さに切ります。                                                                                                                                         │
│ 1本の切ったダウエルをケーキの中央に押し込みます。                                                                                                                                  │
│ 残りの4本の切ったダウエルをケーキに押し込み、ケーキの端から3 1/2インチ内側に配置し、均等に間隔をおきます。                                                           │
│ 8インチのケーキをその段ボードの上に作業面に置きます。                                                                                                                         │
│ 1本のダウエルを真っ直ぐ下に押し込み、ケーキの中心を完全に貫通させます。                                                                                                         │
│ ダウエルをフロスティングの上から1/4インチの位置にマークします。                                                                                                          │
│ ダウエルを取り外し、マークした点で鋸の刃を使用して切ります。                                                                                                                    │
│ さらに3本のダウエルを同じ長さに切ります。                                                                                                                                         │
│ 1本の切ったダウエルをケーキの中央に押し込みます。                                                                                                                                  │
│ 残りの3本の切ったダウエルをケーキに押し込み、端から2 1/2インチ内側に配置し、均等に間隔をおきます。                                                                      │
│ 大きな金属スパトラを補助として使用し、8インチのケーキを12インチのケーキのダウエルの上に段ボードで注意深く乗せます。                                                │
│ 5インチのケーキを8インチのケーキのダウエルの上に段ボードで注意深く乗せます。                                                                                                 │
│ シトラスストリッパーを使用して、オレンジの皮から長いストリップを切り取ります。                                                                                               │
│ ストリップを長いセグメントに切ります。                                                                                                                                              │
│ オレンジの皮のコイルを作るために、皮のセグメントを木のスプーンのハンドルに巻きつけます; ハンドルから皮を優しく滑らせて外し、皮が巻きついた形を保つようにします。                                   │
│ ケーキをオレンジの皮のコイル、アイビーまたはミントの茎、いくつかのベリーで飾ります。                                                                                            │
│ （組み立てられたケーキは最大8時間前に作成できます。                                                                                                                         │
│ 冷やした状態で置いておきます。）                                                                                                                                                      │
│ 上部と中間のケーキのティアを取り外します。                                                                                                                                         │
│ ケーキからダウエルを取り外します。                                                                                                                                                   │
│ 上部と中間のケーキをスライスします。                                                                                                                                                  │
│ 12インチケーキを切る: エッジから3インチ内側を開始し、ナイフを真っ直ぐ下に入れ、上から下まで切り、ケーキの中心に直径6インチの円を作ります。                                         │
│ ケーキの外側部分をスライスし、内部部分をスライスしてストロベリーと一緒に提供します。                                                                                              │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

126 行がセットされています。経過時間: 0.011 秒。処理された行数: 8.19千行, 5.34 MB (737.75千行/秒., 480.59 MB/s.)
```

### オンラインプレイグラウンド {#online-playground}

データセットは、 [オンラインプレイグラウンド](https://sql.clickhouse.com?query_id=HQXNQZE26Z1QWYP9KC76ML) でも利用可能です。
