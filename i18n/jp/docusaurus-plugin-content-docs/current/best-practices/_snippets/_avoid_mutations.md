
---
title: 'ClickHouseにおけるミューテーション'
sidebar_label: 'ミューテーション'
keywords: ['ClickHouse', 'ミューテーション', 'データ操作', 'テーブル管理']
description: 'ClickHouseのミューテーションは、テーブル内の既存データを修正または削除する操作を指します。'
---

ClickHouseでは、**ミューテーション**はテーブル内の既存データを修正または削除する操作を指します - 通常は `ALTER TABLE ... DELETE` や `ALTER TABLE ... UPDATE` を使用します。これらのステートメントは標準SQL操作に似ているように見えますが、内部的には根本的に異なります。

行をその場で修正するのではなく、ClickHouseにおけるミューテーションは、変更の影響を受ける全ての[データパーツ](/parts)を再書き込みする非同期のバックグラウンドプロセスです。このアプローチは、ClickHouseの列指向で不変のストレージモデルに必要ですが、大きなI/Oやリソースの使用につながる可能性があります。

ミューテーションが発行されると、ClickHouseは新しい**ミューテーションパーツ**の作成をスケジュールし、元のパーツは新しいものが準備できるまで触れられません。準備が整うと、ミューテーションパーツは元のものを原子的に置き換えます。しかし、操作がパーツ全体を再書き込むため、たとえ小さな変更（例えば単一行の更新）であっても、大規模な再書き込みや過剰な書き込み増幅を引き起こす可能性があります。

大規模なデータセットの場合、これによりディスクI/Oが大幅に増加し、全体のクラスタ性能が低下する可能性があります。他のマージとは異なり、ミューテーションは一度提出されるとロールバックできず、明示的にキャンセルされない限りサーバの再起動後も実行され続けます - [`KILL MUTATION`](/sql-reference/statements/kill#kill-mutation)を参照してください。

ミューテーションは**完全に順序付けられています**：それはミューテーションが発行される前に挿入されたデータに適用され、新しいデータには影響を与えません。挿入をブロックすることはありませんが、他の進行中のクエリと重複する可能性があります。ミューテーション中に実行されるSELECTは、ミューテーションされたパーツとミューテーションされていないパーツの混合を読み取る可能性があり、実行中にデータの不整合なビューを引き起こすことがあります。ClickHouseは各パーツごとにミューテーションを並行して実行するため、特に複雑なサブクエリ（例えば x IN (SELECT ...)）が含まれる場合、メモリとCPUの使用がさらに増加することがあります。

一般的に、**頻繁または大規模なミューテーションは避けてください**、特に高ボリュームのテーブルに対しては。代わりに、クエリ時またはマージ時にデータの修正をより効率的に処理するよう設計された[ReplacingMergeTree](/guides/replacing-merge-tree)や[CollapsingMergeTree](/engines/table-engines/mergetree-family/collapsingmergetree)などの代替テーブルエンジンを使用することをお勧めします。ミューテーションが絶対に必要な場合は、system.mutationsテーブルを使用して注意深く監視し、プロセスがスタックしたり誤動作している場合は `KILL MUTATION` を使用してください。ミューテーションを誤用すると、パフォーマンスの低下、過剰なストレージの消費、サービスの不安定さを引き起こす可能性がありますので、慎重に使用し、希少に適用してください。

データを削除するために、ユーザーは[Lightweight deletes](/guides/developer/lightweight-delete)や、効率的に全パーツを[dropped efficiently](/sql-reference/statements/alter/partition#drop-partitionpart)できる[パーティション](/best-practices/choosing-a-partitioning-key)の管理を考慮することもできます。
```
