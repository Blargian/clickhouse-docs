---
slug: /whats-new/changelog/24.2-fast-release
title: 'v24.2 Changelog'
description: 'Быстрый релиз журнала изменений для v24.2'
keywords: ['changelog']
---
### ClickHouse release tag: 24.2.2.15987 {#clickhouse-release-tag-242215987}
#### Backward Incompatible Change {#backward-incompatible-change}
* Проверка подозрительных/экспериментальных типов в вложенных типах. Ранее мы не проверяли такие типы (кроме JSON) во вложенных типах, таких как Array/Tuple/Map. [#59385](https://github.com/ClickHouse/ClickHouse/pull/59385) ([Kruglov Pavel](https://github.com/Avogar)).
* Условия сортировки `ORDER BY ALL` (введенные в v23.12) заменены на `ORDER BY *`. Предыдущий синтаксис был слишком подвержен ошибкам для таблиц с колонкой `all`. [#59450](https://github.com/ClickHouse/ClickHouse/pull/59450) ([Robert Schulze](https://github.com/rschu1ze)).
* Добавлена проверка на количество потоков и размеры блоков. [#60138](https://github.com/ClickHouse/ClickHouse/pull/60138) ([Raúl Marín](https://github.com/Algunenano)).
* Отклонять входящие запросы INSERT в случае, если настройки уровня запроса `async_insert` и `deduplicate_blocks_in_dependent_materialized_views` одновременно включены. Это поведение контролируется настройкой `throw_if_deduplication_in_dependent_materialized_views_enabled_with_async_insert` и включено по умолчанию. Это продолжение [#59699](https://github.com/ClickHouse/ClickHouse/pull/59699), необходимо для разблокировки [#59915](https://github.com/ClickHouse/ClickHouse/pull/59915). [#60888](https://github.com/ClickHouse/ClickHouse/pull/60888) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Утилита `clickhouse-copier` перемещена в отдельный репозиторий на GitHub: https://github.com/ClickHouse/copier. Она больше не включена в пакет, но все еще доступна как отдельная загрузка. Это закрывает: [#60734](https://github.com/ClickHouse/ClickHouse/issues/60734) Это закрывает: [#60540](https://github.com/ClickHouse/ClickHouse/issues/60540) Это закрывает: [#60250](https://github.com/ClickHouse/ClickHouse/issues/60250) Это закрывает: [#52917](https://github.com/ClickHouse/ClickHouse/issues/52917) Это закрывает: [#51140](https://github.com/ClickHouse/ClickHouse/issues/51140) Это закрывает: [#47517](https://github.com/ClickHouse/ClickHouse/issues/47517) Это закрывает: [#47189](https://github.com/ClickHouse/ClickHouse/issues/47189) Это закрывает: [#46598](https://github.com/ClickHouse/ClickHouse/issues/46598) Это закрывает: [#40257](https://github.com/ClickHouse/ClickHouse/issues/40257) Это закрывает: [#36504](https://github.com/ClickHouse/ClickHouse/issues/36504) Это закрывает: [#35485](https://github.com/ClickHouse/ClickHouse/issues/35485) Это закрывает: [#33702](https://github.com/ClickHouse/ClickHouse/issues/33702) Это закрывает: [#26702](https://github.com/ClickHouse/ClickHouse/issues/26702) ### Запись документации для изменений, касающихся пользователей. [#61058](https://github.com/ClickHouse/ClickHouse/pull/61058) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Чтобы повысить совместимость с MySQL, функция `locate` теперь принимает аргументы `(needle, haystack[, start_pos])` по умолчанию. Предыдущее поведение `(haystack, needle, [, start_pos])` можно восстановить, установив `function_locate_has_mysql_compatible_argument_order = 0`. [#61092](https://github.com/ClickHouse/ClickHouse/pull/61092) ([Robert Schulze](https://github.com/rschu1ze)).
* Устаревшие части данных в оперативной памяти были объявлены устаревшими с версии 23.5 и не поддерживались с версии 23.10. Теперь оставшийся код удален. Это продолжение [#55186](https://github.com/ClickHouse/ClickHouse/issues/55186) и [#45409](https://github.com/ClickHouse/ClickHouse/issues/45409). Вероятно, вы не использовали части данных в оперативной памяти, так как они были доступны только до версии 23.5 и только при ручном включении соответствующих НАСТРОЕК для таблицы MergeTree. Чтобы проверить, есть ли у вас части данных в оперативной памяти, выполните следующий запрос: `SELECT part_type, count() FROM system.parts GROUP BY part_type ORDER BY part_type`. Чтобы отключить использование частей данных в оперативной памяти, выполните `ALTER TABLE ... MODIFY SETTING min_bytes_for_compact_part = DEFAULT, min_rows_for_compact_part = DEFAULT`. Перед обновлением с более ранних релизов ClickHouse сначала убедитесь, что у вас нет частей данных в оперативной памяти. Если они есть, сначала отключите их, затем дождитесь, пока не останется частей данных в оперативной памяти, и продолжите обновление. [#61127](https://github.com/ClickHouse/ClickHouse/pull/61127) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Запретить `SimpleAggregateFunction` в `ORDER BY` таблиц `MergeTree` (так же, как `AggregateFunction` запрещен, но они запрещены, потому что их нельзя сравнить) по умолчанию (используйте `allow_suspicious_primary_key`, чтобы разрешить их). [#61399](https://github.com/ClickHouse/ClickHouse/pull/61399) ([Azat Khuzhin](https://github.com/azat)).
* ClickHouse разрешает произвольные бинарные данные в типе данных String, который обычно является UTF-8. Parquet/ORC/Arrow Strings поддерживают только UTF-8. Поэтому вы можете выбрать, какой тип данных Arrow использовать для типа данных ClickHouse String - String или Binary. Это контролируется настройками `output_format_parquet_string_as_string`, `output_format_orc_string_as_string`, `output_format_arrow_string_as_string`. Хотя Binary был бы более корректным и совместимым, использование String по умолчанию будет соответствовать ожиданиям пользователей в большинстве случаев. Parquet/ORC/Arrow поддерживают множество методов сжатия, включая lz4 и zstd. ClickHouse поддерживает все методы сжатия. Некоторые устаревшие инструменты не поддерживают более быстрый метод сжатия `lz4`, поэтому мы устанавливаем по умолчанию `zstd`. Это контролируется настройками `output_format_parquet_compression_method`, `output_format_orc_compression_method` и `output_format_arrow_compression_method`. Мы изменили значение по умолчанию на `zstd` для Parquet и ORC, но не для Arrow (это подчеркивается для низкоуровневого использования). [#61817](https://github.com/ClickHouse/ClickHouse/pull/61817) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправление проблемы безопасности представления, которое позволяло пользователю вставлять данные в таблицу без необходимых прав на это. Исправление проверяет, есть ли у пользователя разрешение на вставку не только в материализованное представление, но также и во все сопутствующие таблицы. Это означает, что некоторые запросы, которые ранее работали, теперь могут завершиться с ошибкой "Недостаточно прав". Для решения этой проблемы в релизе вводится новая функция SQL-безопасности для представлений [https://clickhouse.com/docs/sql-reference/statements/create/view#sql_security](/sql-reference/statements/create/view#sql_security). [#54901](https://github.com/ClickHouse/ClickHouse/pull/54901) ([pufit](https://github.com/pufit))
#### New Feature {#new-feature}
* Режим поддержки Topk/topkweighed, который возвращает количество значений и его ошибку. [#54508](https://github.com/ClickHouse/ClickHouse/pull/54508) ([UnamedRus](https://github.com/UnamedRus)).
* Добавлен новый синтаксис, который позволяет указать пользователя-определителя в View/Materialized View. Это позволяет выполнять выборки/вставки из представлений без явного разрешения на сопутствующие таблицы. [#54901](https://github.com/ClickHouse/ClickHouse/pull/54901) ([pufit](https://github.com/pufit)).
* Реализована автоматическая конверсия таблиц merge tree различных видов в реплицированный движок. Создайте пустой файл `convert_to_replicated` в каталоге данных таблицы (`/clickhouse/store/xxx/xxxyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy/`), и эта таблица будет автоматически конвертирована при следующем запуске сервера. [#57798](https://github.com/ClickHouse/ClickHouse/pull/57798) ([Kirill](https://github.com/kirillgarbar)).
* Добавлена табличная функция `mergeTreeIndex`. Она представляет собой содержимое индекса и файлов меток таблиц `MergeTree`. Она может использоваться для интроспекции. Синтаксис: `mergeTreeIndex(database, table, [with_marks = true])`, где `database.table` - это существующая таблица с движком `MergeTree`. [#58140](https://github.com/ClickHouse/ClickHouse/pull/58140) ([Anton Popov](https://github.com/CurtizJ)).
* Попробуйте автоматически определить формат файла во время вывода схемы, если он неизвестен в движках `file/s3/hdfs/url/azureBlobStorage`. Закрывает [#50576](https://github.com/ClickHouse/ClickHouse/issues/50576). [#59092](https://github.com/ClickHouse/ClickHouse/pull/59092) ([Kruglov Pavel](https://github.com/Avogar)).
* Добавьте функцию generate_series как табличную функцию. Эта функция генерирует таблицу с арифметической прогрессией с натуральными числами. [#59390](https://github.com/ClickHouse/ClickHouse/pull/59390) ([divanik](https://github.com/divanik)).
* Добавлен запрос `ALTER TABLE table FORGET PARTITION partition`, который удаляет узлы ZooKeeper, связанные с пустым разделом. [#59507](https://github.com/ClickHouse/ClickHouse/pull/59507) ([Sergei Trifonov](https://github.com/serxa)).
* Поддержка чтения и записи резервных копий в виде архивов tar. [#59535](https://github.com/ClickHouse/ClickHouse/pull/59535) ([josh-hildred](https://github.com/josh-hildred)).
* Предоставляет новую агрегатную функцию ‘groupArrayIntersect’. Продолжение: [#49862](https://github.com/ClickHouse/ClickHouse/issues/49862). [#59598](https://github.com/ClickHouse/ClickHouse/pull/59598) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Реализована таблица system.dns_cache, которая может быть полезна для отладки проблем с DNS. [#59856](https://github.com/ClickHouse/ClickHouse/pull/59856) ([Kirill Nikiforov](https://github.com/allmazz)).
* Реализована поддержка бакетов S3Express. [#59965](https://github.com/ClickHouse/ClickHouse/pull/59965) ([Nikita Taranov](https://github.com/nickitat)).
* Кодек `LZ4HC` получит новый уровень 2, который быстрее, чем предыдущий минимальный уровень 3, за счет меньшего сжатия. В предыдущих версиях `LZ4HC(2)` и ниже были такими же, как `LZ4HC(3)`. Автор: [Cyan4973](https://github.com/Cyan4973). [#60090](https://github.com/ClickHouse/ClickHouse/pull/60090) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Реализована таблица system.dns_cache, которая может быть полезна для отладки проблем с DNS. Новая серверная настройка dns_cache_max_size. [#60257](https://github.com/ClickHouse/ClickHouse/pull/60257) ([Kirill Nikiforov](https://github.com/allmazz)).
* Добавлена функция `toMillisecond`, которая возвращает компонент миллисекунд для значений типа`DateTime` или `DateTime64`. [#60281](https://github.com/ClickHouse/ClickHouse/pull/60281) ([Shaun Struwig](https://github.com/Blargian)).
* Поддержка однозначного аргумента для табличной функции merge, как `merge(['db_name', ] 'tables_regexp')`. [#60372](https://github.com/ClickHouse/ClickHouse/pull/60372) ([豪肥肥](https://github.com/HowePa)).
* Сделать все имена форматов нечувствительными к регистру, такими как Tsv, или TSV, или tsv, или даже rowbinary. [#60420](https://github.com/ClickHouse/ClickHouse/pull/60420) ([豪肥肥](https://github.com/HowePa)).
* Добавлен новый синтаксис, который позволяет указать пользователя-определителя в View/Materialized View. Это позволяет выполнять выборки/вставки из представлений без явного разрешения на сопутствующие таблицы. [#60439](https://github.com/ClickHouse/ClickHouse/pull/60439) ([pufit](https://github.com/pufit)).
* Добавьте четыре свойства к `StorageMemory` (память-движок) `min_bytes_to_keep, max_bytes_to_keep, min_rows_to_keep` и `max_rows_to_keep` - Добавьте тесты, чтобы отразить новые изменения - Обновите документацию `memory.md` - Добавьте свойство `context` таблицы к `MemorySink`, чтобы обеспечить доступ к пределам параметров таблицы. [#60612](https://github.com/ClickHouse/ClickHouse/pull/60612) ([Jake Bamrah](https://github.com/JakeBamrah)).
* Добавлена функция `toMillisecond`, которая возвращает компонент миллисекунд для значений типа`DateTime` или `DateTime64`. [#60649](https://github.com/ClickHouse/ClickHouse/pull/60649) ([Robert Schulze](https://github.com/rschu1ze)).
* Отдельные лимиты на количество ожидающих и выполняемых запросов. Добавлена новая серверная настройка `max_waiting_queries`, которая ограничивает количество запросов, ожидающих из-за `async_load_databases`. Существующие лимиты на количество выполняемых запросов больше не учитывают ожидающие запросы. [#61053](https://github.com/ClickHouse/ClickHouse/pull/61053) ([Sergei Trifonov](https://github.com/serxa)).
* Добавить поддержку `ATTACH PARTITION ALL`. [#61107](https://github.com/ClickHouse/ClickHouse/pull/61107) ([Kirill Nikiforov](https://github.com/allmazz)).
#### Performance Improvement {#performance-improvement}
* Устранение агрегаторов min/max/any/anyLast для ключей GROUP BY в разделе SELECT. [#52230](https://github.com/ClickHouse/ClickHouse/pull/52230) ([JackyWoo](https://github.com/JackyWoo)).
* Улучшение производительности сериализованного метода агрегации при задействовании нескольких [nullable] колонок. Это общая версия [#51399](https://github.com/ClickHouse/ClickHouse/issues/51399), которая не ущербна с точки зрения абстрактной целостности. [#55809](https://github.com/ClickHouse/ClickHouse/pull/55809) ([Amos Bird](https://github.com/amosbird)).
* Ленивая сборка выходных данных соединения для повышения производительности ALL join. [#58278](https://github.com/ClickHouse/ClickHouse/pull/58278) ([LiuNeng](https://github.com/liuneng1994)).
* Улучшения агрегатных функций ArgMin / ArgMax / any / anyLast / anyHeavy, а также запросов `ORDER BY {u8/u16/u32/u64/i8/i16/u32/i64) LIMIT 1`. [#58640](https://github.com/ClickHouse/ClickHouse/pull/58640) ([Raúl Marín](https://github.com/Algunenano)).
* Оптимизация производительности sum/avg условно для типов bigint и big decimal путем уменьшения пропуска веток. [#59504](https://github.com/ClickHouse/ClickHouse/pull/59504) ([李扬](https://github.com/taiyang-li)).
* Улучшение производительности SELECT с активными мутациями. [#59531](https://github.com/ClickHouse/ClickHouse/pull/59531) ([Azat Khuzhin](https://github.com/azat)).
* Тривиальная оптимизация по фильтру колонок. Избегайте тех фильтров колонок, у которых основной тип данных не число, отфильтровываемого с `result_size_hint = -1`. Пиковая память может быть уменьшена до 44% изначальной в некоторых случаях. [#59698](https://github.com/ClickHouse/ClickHouse/pull/59698) ([李扬](https://github.com/taiyang-li)).
* Первичный ключ будет использовать меньше объема памяти. [#60049](https://github.com/ClickHouse/ClickHouse/pull/60049) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Улучшение использования памяти для первичного ключа и некоторых других операций. [#60050](https://github.com/ClickHouse/ClickHouse/pull/60050) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Первичные ключи таблиц будут загружаться в память лениво при первом доступе. Это контролируется новой настройкой MergeTree `primary_key_lazy_load`, которая включена по умолчанию. Это дает несколько преимуществ: - она не будет загружена для таблиц, которые не используются; - если недостаточно памяти, исключение будет выброшено при первом использовании вместо на старте сервера. Это дает несколько недостатков: - задержка загрузки первичного ключа будет оплачена при первом запросе, а не до принятия соединений; это теоретически может вызвать проблему "громового стада". Это закрывает [#11188](https://github.com/ClickHouse/ClickHouse/issues/11188). [#60093](https://github.com/ClickHouse/ClickHouse/pull/60093) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Векторизованная функция `dotProduct`, которая полезна для векторного поиска. [#60202](https://github.com/ClickHouse/ClickHouse/pull/60202) ([Robert Schulze](https://github.com/rschu1ze)).
* Если первичный ключ таблицы содержит в основном бесполезные колонки, не сохраняйте их в памяти. Это контролируется новой настройкой `primary_key_ratio_of_unique_prefix_values_to_skip_suffix_columns` со значением `0.9` по умолчанию, что означает: для составного первичного ключа, если колонка изменяет свое значение как минимум в 0.9 всех случаев, следующие колонки после нее не будут загружены. [#60255](https://github.com/ClickHouse/ClickHouse/pull/60255) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Выполните функцию multiIf колоннами, когда тип результата - число. [#60384](https://github.com/ClickHouse/ClickHouse/pull/60384) ([李扬](https://github.com/taiyang-li)).
* Как показано на рисунке 1, замена "&&" на "&" может сгенерировать код SIMD. ![image](https://github.com/ClickHouse/ClickHouse/assets/26588299/a5a72ac4-6dc6-4d52-835a-4f512e55f0b9) Рисунок 1. Код, скомпилированный из '&&' (слева) и '&' (справа). [#60498](https://github.com/ClickHouse/ClickHouse/pull/60498) ([Zhiguo Zhou](https://github.com/ZhiguoZh)).
* Ускорены (почти в 2 раза) мьютексы (были медленнее из-за ThreadFuzzer). [#60823](https://github.com/ClickHouse/ClickHouse/pull/60823) ([Azat Khuzhin](https://github.com/azat)).
* Переместить слив соединений из подготовки в работу и дренировать несколько соединений параллельно. [#60845](https://github.com/ClickHouse/ClickHouse/pull/60845) ([lizhuoyu5](https://github.com/lzydmxy)).
* Оптимизировать insertManyFrom для nullable number или nullable string. [#60846](https://github.com/ClickHouse/ClickHouse/pull/60846) ([李扬](https://github.com/taiyang-li)).
* Оптимизирована функция `dotProduct`, чтобы избежать ненужных и дорогостоящих копий памяти. [#60928](https://github.com/ClickHouse/ClickHouse/pull/60928) ([Robert Schulze](https://github.com/rschu1ze)).
* Операции с файловым кэшем будут меньше страдать от конфликтов блокировок. [#61066](https://github.com/ClickHouse/ClickHouse/pull/61066) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Оптимизируйте ColumnString::replicate и предотвратите оптимизацию memcpySmallAllowReadWriteOverflow15Impl до встроенной memcpy. Закрыть [#61074](https://github.com/ClickHouse/ClickHouse/issues/61074). ColumnString::replicate ускорена в 2.46 раз на x86-64. [#61075](https://github.com/ClickHouse/ClickHouse/pull/61075) ([李扬](https://github.com/taiyang-li)).
* 30x быстрее вывод для 256-битных целых чисел. [#61100](https://github.com/ClickHouse/ClickHouse/pull/61100) ([Raúl Marín](https://github.com/Algunenano)).
* Если запрос с синтаксической ошибкой содержал сопоставитель COLUMNS с регулярным выражением, регулярное выражение компилировалось каждый раз во время обратного отслеживания парсера, а не компилировалось один раз. Это была основная ошибка. Скомпилированный regexp помещался в AST. Но буква A в AST означает "абстрактный", что означает, что он не должен содержать громоздких объектов. Части AST могут создаваться и уничтожаться во время парсинга, включая большое количество обратных отслеживаний. Это приводит к медлительности на стороне парсинга и, следовательно, позволяет провести DoS пользователем только для чтения. Но главная проблема заключается в том, что это препятствует прогрессу в фуззерах. [#61543](https://github.com/ClickHouse/ClickHouse/pull/61543) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
```yaml
title: 'Улучшение'
sidebar_label: 'Улучшение'
keywords: ['ClickHouse', 'обновление', 'улучшение']
description: 'Обновления и улучшения в ClickHouse.'
```

#### Improvement {#improvement}
* При выполнении запроса MODIFY COLUMN для материализованных представлений проверьте структуру внутренней таблицы, чтобы убедиться, что каждый столбец существует. [#47427](https://github.com/ClickHouse/ClickHouse/pull/47427) ([sunny](https://github.com/sunny19930321)).
* Добавлена таблица `system.keywords`, которая содержит все ключевые слова из парсера. В основном нужна и будет использована для улучшения фуззинга и подсветки синтаксиса. [#51808](https://github.com/ClickHouse/ClickHouse/pull/51808) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Добавлена поддержка параметризованного представления с анализатором, чтобы не анализировать создание параметризованного представления. Реорганизована существующая логика параметризованного представления, чтобы не анализировать создание параметризованного представления. [#54211](https://github.com/ClickHouse/ClickHouse/pull/54211) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* Обычный движок базы данных считается устаревшим. Вы получите предупреждение в clickhouse-client, если ваш сервер его использует. Это закрывает [#52229](https://github.com/ClickHouse/ClickHouse/issues/52229). [#56942](https://github.com/ClickHouse/ClickHouse/pull/56942) ([shabroo](https://github.com/shabroo)).
* Все блокировки нулевой копии, связанные с таблицей, должны быть удалены, когда таблица удаляется. Директория, содержащая эти блокировки, также должна быть удалена. [#57575](https://github.com/ClickHouse/ClickHouse/pull/57575) ([Sema Checherinda](https://github.com/CheSema)).
* Добавлена возможность короткого замыкания для функции `dictGetOrDefault`. Закрывает [#52098](https://github.com/ClickHouse/ClickHouse/issues/52098). [#57767](https://github.com/ClickHouse/ClickHouse/pull/57767) ([jsc0218](https://github.com/jsc0218)).
* Разрешено объявление enum в структуре внешней таблицы. [#57857](https://github.com/ClickHouse/ClickHouse/pull/57857) ([Duc Canh Le](https://github.com/canhld94)).
* Запуск `ALTER COLUMN MATERIALIZE` на столбце с выражением `DEFAULT` или `MATERIALIZED` теперь записывает правильные значения: значение по умолчанию для существующих частей с значением по умолчанию или незначение по умолчанию для существующих частей с незначением по умолчанию. Ранее значение по умолчанию записывалось для всех существующих частей. [#58023](https://github.com/ClickHouse/ClickHouse/pull/58023) ([Duc Canh Le](https://github.com/canhld94)).
* Включена логика задержки (например, экспоненциальная). Это обеспечит возможность снижения использования CPU, использования памяти и размеров файлов журнала. [#58036](https://github.com/ClickHouse/ClickHouse/pull/58036) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* Учитывайте легковесные удаленные строки при выборе частей для слияния. [#58223](https://github.com/ClickHouse/ClickHouse/pull/58223) ([Zhuo Qiu](https://github.com/jewelzqiu)).
* Разрешить определить `volume_priority` в `storage_configuration`. [#58533](https://github.com/ClickHouse/ClickHouse/pull/58533) ([Andrey Zvonov](https://github.com/zvonand)).
* Добавлена поддержка типа Date32 в кодеке T64. [#58738](https://github.com/ClickHouse/ClickHouse/pull/58738) ([Hongbin Ma](https://github.com/binmahone)).
* Этот PR делает http/https соединения повторно используемыми для всех случаев использования. Даже когда ответ 3xx или 4xx. [#58845](https://github.com/ClickHouse/ClickHouse/pull/58845) ([Sema Checherinda](https://github.com/CheSema)).
* Добавлены комментарии к столбцам для большего количества системных таблиц. Продолжение https://github.com/ClickHouse/ClickHouse/pull/58356. [#59016](https://github.com/ClickHouse/ClickHouse/pull/59016) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Теперь мы можем использовать виртуальные столбцы в PREWHERE. Это полезно для неконстантных виртуальных столбцов, таких как `_part_offset`. [#59033](https://github.com/ClickHouse/ClickHouse/pull/59033) ([Amos Bird](https://github.com/amosbird)).
* Настройки для движка распределенной таблицы теперь можно указать в файле конфигурации сервера (аналогично настройкам MergeTree), например, ``` <distributed> <flush_on_detach>false</flush_on_detach> </distributed> ```. [#59291](https://github.com/ClickHouse/ClickHouse/pull/59291) ([Azat Khuzhin](https://github.com/azat)).
* Улучшение в Keeper: кэшировать только определенное количество журналов в памяти, контролируемое `latest_logs_cache_size_threshold` и `commit_logs_cache_size_threshold`. [#59460](https://github.com/ClickHouse/ClickHouse/pull/59460) ([Antonio Andelic](https://github.com/antonio2368)).
* Вместо использования постоянного ключа теперь объектное хранилище генерирует ключ для определения возможности удаления объектов. [#59495](https://github.com/ClickHouse/ClickHouse/pull/59495) ([Sema Checherinda](https://github.com/CheSema)).
* Не выводить числа с плавающей запятой в экспоненциальной записи по умолчанию. Добавьте настройку `input_format_try_infer_exponent_floats`, которая восстановит предыдущее поведение (отключена по умолчанию). Закрывает [#59476](https://github.com/ClickHouse/ClickHouse/issues/59476). [#59500](https://github.com/ClickHouse/ClickHouse/pull/59500) ([Kruglov Pavel](https://github.com/Avogar)).
* Разрешить операции ALTER окружать скобками. Эмиссию скобок можно контролировать с помощью конфигурации `format_alter_operations_with_parentheses`. По умолчанию в отформатированных запросах скобки эмитируются, поскольку мы храним отформатированные операции ALTER в некоторых местах как метаданные (например, мутации). Новый синтаксис разъясняет некоторые из запросов, где операции ALTER заканчиваются в списке. Например, `ALTER TABLE x MODIFY TTL date GROUP BY a, b, DROP COLUMN c` не может быть правильно проанализирован с помощью старого синтаксиса. В новом синтаксисе запрос `ALTER TABLE x (MODIFY TTL date GROUP BY a, b), (DROP COLUMN c)` очевиден. Более старые версии не могут обработать новый синтаксис, поэтому использование нового синтаксиса может привести к проблемам, если новые и старые версии ClickHouse смешаны в одном кластере. [#59532](https://github.com/ClickHouse/ClickHouse/pull/59532) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* Обновлен Intel QPL (используется кодеком `DEFLATE_QPL`) с v1.3.1 до v1.4.0. Также исправлен сбой механизма тайм-аута опроса, как мы наблюдали в тех же случаях тайм-аут может не сработать правильно, если произойдет тайм-аут, IAA и CPU могут одновременно обрабатывать буфер. На данный момент, лучше всего убедиться, что статус кодека IAA не QPL_STS_BEING_PROCESSED, затем вернуться к SW кодеку. [#59551](https://github.com/ClickHouse/ClickHouse/pull/59551) ([jasperzhu](https://github.com/jinjunzh)).
* Добавить позиционное чтение в libhdfs3. Если вы хотите вызвать позиционное чтение в libhdfs3, используйте функцию hdfsPread в hdfs.h следующим образом. `tSize hdfsPread(hdfsFS fs, hdfsFile file, void * buffer, tSize length, tOffset position);`. [#59624](https://github.com/ClickHouse/ClickHouse/pull/59624) ([M1eyu](https://github.com/M1eyu2018)).
* Проверьте переполнение стека в парсерах даже если пользователь неправильно настроил настройку `max_parser_depth` на слишком высокое значение. Это закрывает [#59622](https://github.com/ClickHouse/ClickHouse/issues/59622). [#59697](https://github.com/ClickHouse/ClickHouse/pull/59697) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Упорядочите поведение именованных коллекций, созданных xml и sql в хранилище kafka. [#59710](https://github.com/ClickHouse/ClickHouse/pull/59710) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* Позвольте uuid в replica_path, если CREATE TABLE явно его указал. [#59908](https://github.com/ClickHouse/ClickHouse/pull/59908) ([Azat Khuzhin](https://github.com/azat)).
* Добавлен столбец `metadata_version` таблицы ReplicatedMergeTree в системной таблице `system.tables`. [#59942](https://github.com/ClickHouse/ClickHouse/pull/59942) ([Maksim Kita](https://github.com/kitaisreal)).
* Улучшение в Keeper: добавление повторов при сбоях для операций, связанных с диском. [#59980](https://github.com/ClickHouse/ClickHouse/pull/59980) ([Antonio Andelic](https://github.com/antonio2368)).
* Добавлен новый параметр конфигурации `backups.remove_backup_files_after_failure`: ``` <clickhouse> <backups> <remove_backup_files_after_failure>true</remove_backup_files_after_failure> </backups> </clickhouse> ```. [#60002](https://github.com/ClickHouse/ClickHouse/pull/60002) ([Vitaly Baranov](https://github.com/vitlibar)).
* Используйте несколько потоков при чтении метаданных таблиц из резервной копии при выполнении команды RESTORE. [#60040](https://github.com/ClickHouse/ClickHouse/pull/60040) ([Vitaly Baranov](https://github.com/vitlibar)).
* Теперь, если `StorageBuffer` имеет более 1 шардов (`num_layers` > 1), фоновое сбрасываение будет происходить одновременно для всех шардов в нескольких потоках. [#60111](https://github.com/ClickHouse/ClickHouse/pull/60111) ([alesapin](https://github.com/alesapin)).
* Поддержка указания пользователей для конкретных настроек S3 в конфигурации с помощью ключа `user`. [#60144](https://github.com/ClickHouse/ClickHouse/pull/60144) ([Antonio Andelic](https://github.com/antonio2368)).
* Копия файла S3 GCP резервируется для буферной копии в случае, если GCP вернул `Internal Error` с кодом HTTP `GATEWAY_TIMEOUT`. [#60164](https://github.com/ClickHouse/ClickHouse/pull/60164) ([Maksim Kita](https://github.com/kitaisreal)).
* Разрешите "local" как тип объектного хранилища вместо "local_blob_storage". [#60165](https://github.com/ClickHouse/ClickHouse/pull/60165) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Реализуйте оператор сравнения для значений Variant и правильное вставление Field в столбец Variant. Не разрешайте создавать тип `Variant` с похожими типами вариантов по умолчанию (разрешить под настройкой `allow_suspicious_variant_types`) Закрывает [#59996](https://github.com/ClickHouse/ClickHouse/issues/59996). Закрывает [#59850](https://github.com/ClickHouse/ClickHouse/issues/59850). [#60198](https://github.com/ClickHouse/ClickHouse/pull/60198) ([Kruglov Pavel](https://github.com/Avogar)).
* Улучшена общая удобство использования виртуальных столбцов. Теперь разрешено использовать виртуальные столбцы в `PREWHERE` (это полезно для не-константных виртуальных столбцов, таких как `_part_offset`). Теперь доступна встроенная документация для виртуальных столбцов в виде комментария к столбцу в запросе `DESCRIBE` с включенной настройкой `describe_include_virtual_columns`. [#60205](https://github.com/ClickHouse/ClickHouse/pull/60205) ([Anton Popov](https://github.com/CurtizJ)).
* Короткая замыкание выполнения для `ULIDStringToDateTime`. [#60211](https://github.com/ClickHouse/ClickHouse/pull/60211) ([Juan Madurga](https://github.com/jlmadurga)).
* Добавлен столбец `query_id` для таблиц `system.backups` и `system.backup_log`. Добавлен стек ошибок в столбце `error`. [#60220](https://github.com/ClickHouse/ClickHouse/pull/60220) ([Maksim Kita](https://github.com/kitaisreal)).
* Параллельное сбрасывание ожидающих блоков INSERT движка Distributed на `DETACH`/выключение сервера и `SYSTEM FLUSH DISTRIBUTED` (параллелизм будет работать только если у вас есть политика многодискового хранения для таблицы (как все в движке Distributed в настоящее время)). [#60225](https://github.com/ClickHouse/ClickHouse/pull/60225) ([Azat Khuzhin](https://github.com/azat)).
* Настройка фильтра некорректна в `joinRightColumnsSwitchNullability`, разрешить [#59625](https://github.com/ClickHouse/ClickHouse/issues/59625). [#60259](https://github.com/ClickHouse/ClickHouse/pull/60259) ([lgbo](https://github.com/lgbo-ustc)).
* Добавьте настройку для принудительного чтения через кеш для слияний. [#60308](https://github.com/ClickHouse/ClickHouse/pull/60308) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Проблема [#57598](https://github.com/ClickHouse/ClickHouse/issues/57598) упоминает вариативное поведение в отношении обработки транзакций. Выпущенный COMMIT/ROLLBACK, когда никакая транзакция не активна, регистрируется как ошибка, в отличие от поведения MySQL. [#60338](https://github.com/ClickHouse/ClickHouse/pull/60338) ([PapaToemmsn](https://github.com/PapaToemmsn)).
* Добавлен режим `none_only_active` для настройки `distributed_ddl_output_mode`. [#60340](https://github.com/ClickHouse/ClickHouse/pull/60340) ([Alexander Tokmakov](https://github.com/tavplubix)).
* Соединения через MySQL порт теперь автоматически выполняются с настройкой `prefer_column_name_to_alias = 1`, чтобы поддерживать QuickSight из коробки. Также настройки `mysql_map_string_to_text_in_show_columns` и `mysql_map_fixed_string_to_text_in_show_columns` теперь включены по умолчанию, что также влияет только на соединения MySQL. Это увеличивает совместимость с большим количеством BI инструментов. [#60365](https://github.com/ClickHouse/ClickHouse/pull/60365) ([Robert Schulze](https://github.com/rschu1ze)).
* Когда формат вывода является форматом Pretty, а блок состоит из единственного числового значения, которое превышает один миллион, читаемое число будет отображаться справа от таблицы. например ``` ┌──────count()─┐ │ 233765663884 │ -- 233.77 миллиардов └──────────────┘ ```. [#60379](https://github.com/ClickHouse/ClickHouse/pull/60379) ([rogeryk](https://github.com/rogeryk)).
* Разрешите настраивать обработчики HTTP переадресации для clickhouse-server. Например, вы можете сделать так, чтобы `/` перенаправляло на Play UI. [#60390](https://github.com/ClickHouse/ClickHouse/pull/60390) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* У продвинутой панели управления теперь немного лучше цвета для многократных графиков. [#60391](https://github.com/ClickHouse/ClickHouse/pull/60391) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлена ошибка гонки в коде JavaScript, что приводило к дублированию графиков друг на друге. [#60392](https://github.com/ClickHouse/ClickHouse/pull/60392) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Проверьте переполнение стека в парсерах, даже если пользователь неправильно настроил настройку `max_parser_depth` на слишком высокое значение. Это закрывает [#59622](https://github.com/ClickHouse/ClickHouse/issues/59622). [#60434](https://github.com/ClickHouse/ClickHouse/pull/60434) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Функция `substring` теперь имеет новый псевдоним `byteSlice`. [#60494](https://github.com/ClickHouse/ClickHouse/pull/60494) ([Robert Schulze](https://github.com/rschu1ze)).
* Параметр сервера `dns_cache_max_size` переименован в `dns_cache_max_entries`, чтобы уменьшить неоднозначность. [#60500](https://github.com/ClickHouse/ClickHouse/pull/60500) ([Kirill Nikiforov](https://github.com/allmazz)).
* `SHOW INDEX | INDEXES | INDICES | KEYS` больше не сортирует по первичным ключевым столбцам (что было неинтуитивно). [#60514](https://github.com/ClickHouse/ClickHouse/pull/60514) ([Robert Schulze](https://github.com/rschu1ze)).
* Улучшение в Keeper: прерывать во время старта, если обнаружен недопустимый снимок, чтобы избежать потери данных. [#60537](https://github.com/ClickHouse/ClickHouse/pull/60537) ([Antonio Andelic](https://github.com/antonio2368)).
* Добавлены диапазоны чтения MergeTree в пересекающиеся и непересекающиеся сбои с использованием параметра `merge_tree_read_split_ranges_into_intersecting_and_non_intersecting_fault_probability`. [#60548](https://github.com/ClickHouse/ClickHouse/pull/60548) ([Maksim Kita](https://github.com/kitaisreal)).
* У продвинутой панели управления теперь элементы управления всегда видны при прокрутке. Это позволяет добавить новый график без прокрутки вверх. [#60692](https://github.com/ClickHouse/ClickHouse/pull/60692) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Строковые типы и Enums могут использоваться в одном и том же контексте, такие как: массивы, запросы UNION, условные выражения. Это закрывает [#60726](https://github.com/ClickHouse/ClickHouse/issues/60726). [#60727](https://github.com/ClickHouse/ClickHouse/pull/60727) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Обновите tzdata до 2024a. [#60768](https://github.com/ClickHouse/ClickHouse/pull/60768) ([Raúl Marín](https://github.com/Algunenano)).
* Поддержка файлов без расширения формата в файловой системе базы данных. [#60795](https://github.com/ClickHouse/ClickHouse/pull/60795) ([Kruglov Pavel](https://github.com/Avogar)).
* Улучшение в Keeper: поддержка `leadership_expiry_ms` в настройках Keeper. [#60806](https://github.com/ClickHouse/ClickHouse/pull/60806) ([Brokenice0415](https://github.com/Brokenice0415)).
* Всегда задавайте экспоненциальные числа в форматах JSON независимо от настройки `input_format_try_infer_exponent_floats`. Добавьте параметр `input_format_json_use_string_type_for_ambiguous_paths_in_named_tuples_inference_from_objects`, который разрешает использовать строковый тип для неоднозначных путей, а не исключение во время анализа именованных кортежей из JSON-объектов. [#60808](https://github.com/ClickHouse/ClickHouse/pull/60808) ([Kruglov Pavel](https://github.com/Avogar)).
* Добавьте флаг для SMJ, чтобы рассматривать null как наибольшее/наименьшее. Таким образом, поведение может быть совместимо с другими SQL системами, как Apache Spark. [#60896](https://github.com/ClickHouse/ClickHouse/pull/60896) ([loudongfeng](https://github.com/loudongfeng)).
* Версия Clickhouse была добавлена в метаданные docker. Закрывает [#54224](https://github.com/ClickHouse/ClickHouse/issues/54224). [#60949](https://github.com/ClickHouse/ClickHouse/pull/60949) ([Nikolay Monkov](https://github.com/nikmonkov)).
* Добавлен параметр `parallel_replicas_allow_in_with_subquery = 1`, который позволяет подзапросам для IN работать с параллельными репликами. [#60950](https://github.com/ClickHouse/ClickHouse/pull/60950) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* DNSResolver перемешивает набор разрешенных IP-адресов. [#60965](https://github.com/ClickHouse/ClickHouse/pull/60965) ([Sema Checherinda](https://github.com/CheSema)).
* Поддержка определения формата вывода по расширению файла в `clickhouse-client` и `clickhouse-local`. [#61036](https://github.com/ClickHouse/ClickHouse/pull/61036) ([豪肥肥](https://github.com/HowePa)).
* Проверьте периодическое обновление ограничения памяти. [#61049](https://github.com/ClickHouse/ClickHouse/pull/61049) ([Han Fei](https://github.com/hanfei1991)).
* Включите профилирование процессов (время затрачиваемое на входные и выходные байты для сортировки, агрегации и т. д.) по умолчанию. [#61096](https://github.com/ClickHouse/ClickHouse/pull/61096) ([Azat Khuzhin](https://github.com/azat)).
* Добавить функцию `toUInt128OrZero`, которая была пропущена по ошибке (ошибка связана с https://github.com/ClickHouse/ClickHouse/pull/945). Совместимые алиасы `FROM_UNIXTIME` и `DATE_FORMAT` (они не являются родными для ClickHouse и существуют только для совместимости с MySQL) были сделаны нечувствительными к регистру, как ожидается для SQL-совместимых алиасов. [#61114](https://github.com/ClickHouse/ClickHouse/pull/61114) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Улучшения для проверок доступа, позволяющие аннулировать непринадлежащие права в случае, если целевой пользователь не имеет прав на аннулирование. Пример: ```sql GRANT SELECT ON *.* TO user1; REVOKE SELECT ON system.* FROM user1;. [#61115](https://github.com/ClickHouse/ClickHouse/pull/61115) ([pufit](https://github.com/pufit)).
* Исправление ошибки в предыдущем опте: https://github.com/ClickHouse/ClickHouse/pull/59698: удалите разрыв, чтобы убедиться, что первый отфильтрованный столбец имеет минимальный размер cc @jsc0218. [#61145](https://github.com/ClickHouse/ClickHouse/pull/61145) ([李扬](https://github.com/taiyang-li)).
* Исправлена проблема с функцией `has()` с `Nullable` столбцом (исправляет [#60214](https://github.com/ClickHouse/ClickHouse/issues/60214)). [#61249](https://github.com/ClickHouse/ClickHouse/pull/61249) ([Mikhail Koviazin](https://github.com/mkmkme)).
* Теперь можно указать атрибут `merge="true"` в конфигурационных подстановках для поддеревьев `<include from_zk="/path" merge="true">`. В случае, если этот атрибут указан, ClickHouse объединит поддерево с существующей конфигурацией, в противном случае поведение по умолчанию — добавить новый контент к конфигурации. [#61299](https://github.com/ClickHouse/ClickHouse/pull/61299) ([alesapin](https://github.com/alesapin)).
* Добавить асинхронные метрики для виртуальных отображений памяти: VMMaxMapCount и VMNumMaps. Закрывает [#60662](https://github.com/ClickHouse/ClickHouse/issues/60662). [#61354](https://github.com/ClickHouse/ClickHouse/pull/61354) ([Tuan Pham Anh](https://github.com/tuanpavn)).
* Используйте настройку `temporary_files_codec` во всех местах, где мы создаем временные данные, например, для внешней сортировки в памяти и внешней GROUP BY. Ранее это работало только в алгоритме JOIN с частичным слиянием. [#61456](https://github.com/ClickHouse/ClickHouse/pull/61456) ([Maksim Kita](https://github.com/kitaisreal)).
* Удалите дубликаты проверки `containing_part.empty()`, она уже проверяется здесь: https://github.com/ClickHouse/ClickHouse/blob/1296dac3c7e47670872c15e3f5e58f869e0bd2f2/src/Storages/MergeTree/MergeTreeData.cpp#L6141. [#61467](https://github.com/ClickHouse/ClickHouse/pull/61467) ([William Schoeffel](https://github.com/wiledusc)).
* Добавлена новая настройка `max_parser_backtracks`, которая позволяет ограничить сложность разбора запросов. [#61502](https://github.com/ClickHouse/ClickHouse/pull/61502) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Меньше конфликтов во время динамического изменения размера кэша файловой системы. [#61524](https://github.com/ClickHouse/ClickHouse/pull/61524) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Запретить шардированный режим очереди StorageS3, так как он будет переписан. [#61537](https://github.com/ClickHouse/ClickHouse/pull/61537) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Исправлена опечатка: с `use_leagcy_max_level` на `use_legacy_max_level`. [#61545](https://github.com/ClickHouse/ClickHouse/pull/61545) ([William Schoeffel](https://github.com/wiledusc)).
* Удалить некоторые дублирующиеся записи в blob_storage_log. [#61622](https://github.com/ClickHouse/ClickHouse/pull/61622) ([YenchangChan](https://github.com/YenchangChan)).
* Добавлена функция `current_user` как совместимый псевдоним для MySQL. [#61770](https://github.com/ClickHouse/ClickHouse/pull/61770) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Используйте управляемую идентичность для IO резервного копирования при использовании Azure Blob Storage. Добавьте параметр, чтобы предотвратить попытки ClickHouse создать несуществующий контейнер, который требует разрешений на уровне учетной записи хранилища. [#61785](https://github.com/ClickHouse/ClickHouse/pull/61785) ([Daniel Pozo Escalona](https://github.com/danipozo)).
* В предыдущей версии некоторые числа в формате Pretty не были достаточно аккуратными. [#61794](https://github.com/ClickHouse/ClickHouse/pull/61794) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Долгое значение в форматах Pretty не будет обрезано, если оно является единственным значением в наборе результата, например, в результате запроса `SHOW CREATE TABLE`. [#61795](https://github.com/ClickHouse/ClickHouse/pull/61795) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Аналогично `clickhouse-local`, `clickhouse-client` будет принимать параметр `--output-format` как синоним параметра `--format`. Это закрывает [#59848](https://github.com/ClickHouse/ClickHouse/issues/59848). [#61797](https://github.com/ClickHouse/ClickHouse/pull/61797) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Если stdout является терминалом, и формат вывода не указан, `clickhouse-client` и аналогичные инструменты будут использовать `PrettyCompact` по умолчанию, аналогично интерактивному режиму. `clickhouse-client` и `clickhouse-local` будут обрабатывать аргументы командной строки для входных и выходных форматов единообразно. Это закрывает [#61272](https://github.com/ClickHouse/ClickHouse/issues/61272). [#61800](https://github.com/ClickHouse/ClickHouse/pull/61800) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Группы цифр с подчеркиванием в форматах Pretty для лучшей читаемости. Это контролируется новой настройкой `output_format_pretty_highlight_digit_groups`. [#61802](https://github.com/ClickHouse/ClickHouse/pull/61802) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
#### Исправление ошибок (неправильное поведение на стороне пользователя в официальном стабильном релизе) {#bug-fix-user-visible-misbehavior-in-an-official-stable-release}

* Исправлена ошибка с `intDiv` для десятичных аргументов [#59243](https://github.com/ClickHouse/ClickHouse/pull/59243) ([Ярик Брюховецкий](https://github.com/yariks5s)).
* Исправление_kql_вопроса_найденного_by_wingfuzz [#59626](https://github.com/ClickHouse/ClickHouse/pull/59626) ([Йонг Ванг](https://github.com/kashwy)).
* Исправлена ошибка "Чтение за пределами последнего смещения" для AsynchronousBoundedReadBuffer [#59630](https://github.com/ClickHouse/ClickHouse/pull/59630) ([Виталий Баранов](https://github.com/vitlibar)).
* rabbitmq: исправлено отсутствие подтвержденных и неподтвержденных сообщений [#59775](https://github.com/ClickHouse/ClickHouse/pull/59775) ([Ксения Сумарокова](https://github.com/kssenii)).
* Исправлена функция выполнения для const и LowCardinality с GROUP BY const для анализатора [#59986](https://github.com/ClickHouse/ClickHouse/pull/59986) ([Азат Хузин](https://github.com/azat)).
* Исправлено преобразование масштаба для DateTime64 [#60004](https://github.com/ClickHouse/ClickHouse/pull/60004) ([Ярик Брюховецкий](https://github.com/yariks5s)).
* Исправлено INSERT в SQLite с одинарной кавычкой (с экранированием одинарных кавычек с помощью кавычки вместо обратной косой) [#60015](https://github.com/ClickHouse/ClickHouse/pull/60015) ([Азат Хузин](https://github.com/azat)).
* Исправлено оптимизация_уникальных_значений_в_количество, удаляющая псевдоним столбца [#60026](https://github.com/ClickHouse/ClickHouse/pull/60026) ([Рауль Марин](https://github.com/Algunenano)).
* Исправлено finished_mutations_to_keep=0 для MergeTree (как указано в документации, 0 — это сохранить всё) [#60031](https://github.com/ClickHouse/ClickHouse/pull/60031) ([Азат Хузин](https://github.com/azat)).
* Исправлена возможная ошибка при использовании таблицы s3queue при удалении [#60036](https://github.com/ClickHouse/ClickHouse/pull/60036) ([Ксения Сумарокова](https://github.com/kssenii)).
* PartsSplitter недопустимые диапазоны для одной и той же части [#60041](https://github.com/ClickHouse/ClickHouse/pull/60041) ([Максим Кита](https://github.com/kitaisreal)).
* Использовать max_query_size из контекста в DDLLogEntry вместо жестко закодированного 4096 [#60083](https://github.com/ClickHouse/ClickHouse/pull/60083) ([Круглов Павел](https://github.com/Avogar)).
* Исправлено несоответствующее форматирование запросов [#60095](https://github.com/ClickHouse/ClickHouse/pull/60095) ([Алексей Милоидов](https://github.com/alexey-milovidov)).
* Исправлено несоответствующее форматирование explain в подзапросах [#60102](https://github.com/ClickHouse/ClickHouse/pull/60102) ([Алексей Милоидов](https://github.com/alexey-milovidov)).
* Исправлен крах cosineDistance с Nullable [#60150](https://github.com/ClickHouse/ClickHouse/pull/60150) ([Рауль Марин](https://github.com/Algunenano)).
* Разрешить преобразование логических значений в строковом представлении в истинные логические значения [#60160](https://github.com/ClickHouse/ClickHouse/pull/60160) ([Роберт Шульце](https://github.com/rschu1ze)).
* Исправлен system.s3queue_log [#60166](https://github.com/ClickHouse/ClickHouse/pull/60166) ([Ксения Сумарокова](https://github.com/kssenii)).
* Исправлено arrayReduce с именем агрегатной функции, допускающей null [#60188](https://github.com/ClickHouse/ClickHouse/pull/60188) ([Рауль Марин](https://github.com/Algunenano)).
* Исправлены действия выполнения во время предварительной фильтрации (PK, питание партиций) [#60196](https://github.com/ClickHouse/ClickHouse/pull/60196) ([Азат Хузин](https://github.com/azat)).
* Скрыть конфиденциальную информацию для s3queue [#60233](https://github.com/ClickHouse/ClickHouse/pull/60233) ([Ксения Сумарокова](https://github.com/kssenii)).
* Отменить "Заменить `ORDER BY ALL` на `ORDER BY *`" [#60248](https://github.com/ClickHouse/ClickHouse/pull/60248) ([Роберт Шульце](https://github.com/rschu1ze)).
* Azure Blob Storage : Исправить проблемы с конечной точкой и префиксом [#60251](https://github.com/ClickHouse/ClickHouse/pull/60251) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* Исправлены коды исключений http. [#60252](https://github.com/ClickHouse/ClickHouse/pull/60252) ([Остин Котиг](https://github.com/kothiga)).
* Исправить ошибку кэша LRUResource (кэш Hive) [#60262](https://github.com/ClickHouse/ClickHouse/pull/60262) ([shanfengp](https://github.com/Aed-p)).
* s3queue: исправлена ошибка (также исправляет ненадежный тест_storage_s3_queue/test.py::test_shards_distributed) [#60282](https://github.com/ClickHouse/ClickHouse/pull/60282) ([Ксения Сумарокова](https://github.com/kssenii)).
* Исправлено использование неинициализированного значения и неверный результат в хеширующих функциях с IPv6 [#60359](https://github.com/ClickHouse/ClickHouse/pull/60359) ([Круглов Павел](https://github.com/Avogar)).
* Принудительный повторный анализ, если изменились параллельные реплики [#60362](https://github.com/ClickHouse/ClickHouse/pull/60362) ([Рауль Марин](https://github.com/Algunenano)).
* Исправлено использование примитивного типа метаданных с новой опцией конфигурации дисков [#60396](https://github.com/ClickHouse/ClickHouse/pull/60396) ([Ксения Сумарокова](https://github.com/kssenii)).
* Не разрешать устанавливать max_parallel_replicas в 0, так как это не имеет смысла [#60430](https://github.com/ClickHouse/ClickHouse/pull/60430) ([Круглов Павел](https://github.com/Avogar)).
* Попытка исправить логическую ошибку 'Невозможно захватить столбец, потому что он имеет несовместимый тип' в mapContainsKeyLike [#60451](https://github.com/ClickHouse/ClickHouse/pull/60451) ([Круглов Павел](https://github.com/Avogar)).
* Исправлено OptimizeDateOrDateTimeConverterWithPreimageVisitor с null аргументами [#60453](https://github.com/ClickHouse/ClickHouse/pull/60453) ([Рауль Марин](https://github.com/Algunenano)).
* Попытка избежать вычисления скалярных подзапросов для CREATE TABLE. [#60464](https://github.com/ClickHouse/ClickHouse/pull/60464) ([Николай Кочетов](https://github.com/KochetovNicolai)).
* Слияние [#59674](https://github.com/ClickHouse/ClickHouse/issues/59674). [#60470](https://github.com/ClickHouse/ClickHouse/pull/60470) ([Алексей Милоидов](https://github.com/alexey-milovidov)).
* Корректно проверять ключи в s3Cluster [#60477](https://github.com/ClickHouse/ClickHouse/pull/60477) ([Антонио Анделич](https://github.com/antonio2368)).
* Исправить взаимную блокировку в параллельном парсинге, когда много строк пропускаются из-за ошибок [#60516](https://github.com/ClickHouse/ClickHouse/pull/60516) ([Круглов Павел](https://github.com/Avogar)).
* Исправить_max_query_size_for_kql_compound_operator: [#60534](https://github.com/ClickHouse/ClickHouse/pull/60534) ([Йонг Ванг](https://github.com/kashwy)).
* Исправление Keeper: добавить тайм-ауты при ожидании журналов подтверждения [#60544](https://github.com/ClickHouse/ClickHouse/pull/60544) ([Антонио Анделич](https://github.com/antonio2368)).
* Уменьшить количество читаемых строк из `system.numbers` [#60546](https://github.com/ClickHouse/ClickHouse/pull/60546) ([Джэки Ву](https://github.com/JackyWoo)).
* Не выводить советы по числам для типов даты [#60577](https://github.com/ClickHouse/ClickHouse/pull/60577) ([Рауль Марин](https://github.com/Algunenano)).
* Исправлено чтение из MergeTree с недетерминированными функциями в фильтре [#60586](https://github.com/ClickHouse/ClickHouse/pull/60586) ([Круглов Павел](https://github.com/Avogar)).
* Исправлена логическая ошибка при неверном значении типа настройки совместимости [#60596](https://github.com/ClickHouse/ClickHouse/pull/60596) ([Круглов Павел](https://github.com/Avogar)).
* Исправлено несоответствующее состояние агрегатной функции в смешанных кластерах x86-64 / ARM [#60610](https://github.com/ClickHouse/ClickHouse/pull/60610) ([Гарри Ли](https://github.com/HarryLeeIBM)).
* fix(prql): Надежный обработчик паники [#60615](https://github.com/ClickHouse/ClickHouse/pull/60615) ([Максимилиан Роос](https://github.com/max-sixty)).
* Исправлено `intDiv` для десятичных и датных аргументов [#60672](https://github.com/ClickHouse/ClickHouse/pull/60672) ([Ярик Брюховецкий](https://github.com/yariks5s)).
* Исправлено: развернуть CTE в запросе alter modify [#60682](https://github.com/ClickHouse/ClickHouse/pull/60682) ([Яков Ольховский](https://github.com/yakov-olkhovskiy)).
* Исправлен system.parts для движка базы данных, не использующего Atomic/Ordinary (т.е. Memory) [#60689](https://github.com/ClickHouse/ClickHouse/pull/60689) ([Азат Хузин](https://github.com/azat)).
* Исправлено "Недопустимое определение хранилища в файле метаданных" для параметризованных представлений [#60708](https://github.com/ClickHouse/ClickHouse/pull/60708) ([Азат Хузин](https://github.com/azat)).
* Исправлен переполнение буфера в CompressionCodecMultiple [#60731](https://github.com/ClickHouse/ClickHouse/pull/60731) ([Алексей Милоидов](https://github.com/alexey-milovidov)).
* Удалено бессмысленное из SQL/JSON [#60738](https://github.com/ClickHouse/ClickHouse/pull/60738) ([Алексей Милоидов](https://github.com/alexey-milovidov)).
* Удалено неправильная проверка очистки в агрегатной функции quantileGK [#60740](https://github.com/ClickHouse/ClickHouse/pull/60740) ([李扬](https://github.com/taiyang-li)).
* Исправлен bug insert-select + insert_deduplication_token, установив потоки в 1 [#60745](https://github.com/ClickHouse/ClickHouse/pull/60745) ([Хорди Вильяр](https://github.com/jrdi)).
* Предотвратить установку пользовательских заголовков метаданных при неподдерживаемых операциях многокомпонентной загрузки [#60748](https://github.com/ClickHouse/ClickHouse/pull/60748) ([Франсиско Юрадо Морон](https://github.com/Beetelbrox)).
* Исправлено toStartOfInterval [#60763](https://github.com/ClickHouse/ClickHouse/pull/60763) ([Андрей Звонов](https://github.com/zvonand)).
* Исправлен крах в arrayEnumerateRanked [#60764](https://github.com/ClickHouse/ClickHouse/pull/60764) ([Рауль Марин](https://github.com/Algunenano)).
* Исправлен крах при использовании input() в INSERT SELECT JOIN [#60765](https://github.com/ClickHouse/ClickHouse/pull/60765) ([Круглов Павел](https://github.com/Avogar)).
* Исправлен крах с различным значением allow_experimental_analyzer в подзапросах [#60770](https://github.com/ClickHouse/ClickHouse/pull/60770) ([Дмитрий Новик](https://github.com/novikd)).
* Удалена рекурсия при чтении из S3 [#60849](https://github.com/ClickHouse/ClickHouse/pull/60849) ([Антонио Анделич](https://github.com/antonio2368)).
* Исправлена возможная зависание при ошибке в HashedDictionaryParallelLoader [#60926](https://github.com/ClickHouse/ClickHouse/pull/60926) ([vdimir](https://github.com/vdimir)).
* Исправлен асинхронный RESTORE с Replicated базой данных [#60934](https://github.com/ClickHouse/ClickHouse/pull/60934) ([Антонио Анделич](https://github.com/antonio2368)).
* Исправлена взаимная блокировка при асинхронных вставках в таблицы `Log` через нативный протокол [#61055](https://github.com/ClickHouse/ClickHouse/pull/61055) ([Антон Попов](https://github.com/CurtizJ)).
* Исправлено ленивое выполнение аргумента по умолчанию в dictGetOrDefault для RangeHashedDictionary [#61196](https://github.com/ClickHouse/ClickHouse/pull/61196) ([Круглов Павел](https://github.com/Avogar)).
* Исправлено несколько ошибок в groupArraySorted [#61203](https://github.com/ClickHouse/ClickHouse/pull/61203) ([Рауль Марин](https://github.com/Algunenano)).
* Исправлено reconfig Keeper для автономного бинарного файла [#61233](https://github.com/ClickHouse/ClickHouse/pull/61233) ([Антонио Анделич](https://github.com/antonio2368)).
* Исправлено использование session_token в движке S3 [#61234](https://github.com/ClickHouse/ClickHouse/pull/61234) ([Круглов Павел](https://github.com/Avogar)).
* Исправлен возможный неправильный результат агрегатной функции `uniqExact` [#61257](https://github.com/ClickHouse/ClickHouse/pull/61257) ([Антон Попов](https://github.com/CurtizJ)).
* Исправлены ошибки в show database [#61269](https://github.com/ClickHouse/ClickHouse/pull/61269) ([Рауль Марин](https://github.com/Algunenano)).
* Исправлена логическая ошибка в RabbitMQ хранилище с MATERIАLIZED колонками [#61320](https://github.com/ClickHouse/ClickHouse/pull/61320) ([vdimir](https://github.com/vdimir)).
* Исправлено CREATE OR REPLACE DICTIONARY [#61356](https://github.com/ClickHouse/ClickHouse/pull/61356) ([Виталий Баранов](https://github.com/vitlibar)).
* Исправлен ATTACH запрос с внешним ON CLUSTER [#61365](https://github.com/ClickHouse/ClickHouse/pull/61365) ([Николай Дегтяринский](https://github.com/evillique)).
* Исправлена проблема разделения действий DAG [#61458](https://github.com/ClickHouse/ClickHouse/pull/61458) ([Рауль Марин](https://github.com/Algunenano)).
* Исправлено завершение неудачного RESTORE [#61466](https://github.com/ClickHouse/ClickHouse/pull/61466) ([Виталий Баранов](https://github.com/vitlibar)).
* Исправлено отключение async_insert_use_adaptive_busy_timeout правильно с настройками совместимости [#61468](https://github.com/ClickHouse/ClickHouse/pull/61468) ([Рауль Марин](https://github.com/Algunenano)).
* Разрешить очередь в пуле восстановления [#61475](https://github.com/ClickHouse/ClickHouse/pull/61475) ([Никита Таранов](https://github.com/nickitat)).
* Исправлена ошибка при чтении system.parts с использованием UUID (вопрос 61220). [#61479](https://github.com/ClickHouse/ClickHouse/pull/61479) ([Дан У](https://github.com/wudanzy)).
* Исправлен крах в оконном представлении [#61526](https://github.com/ClickHouse/ClickHouse/pull/61526) ([Алексей Милоидов](https://github.com/alexey-milovidov)).
* Исправлено `repeat` с ненативными целыми числами [#61527](https://github.com/ClickHouse/ClickHouse/pull/61527) ([Антонио Анделич](https://github.com/antonio2368)).
* Исправлен клиент `-s` аргумент [#61530](https://github.com/ClickHouse/ClickHouse/pull/61530) ([Михаил ф. Ширяев](https://github.com/Felixoid)).
* Исправлен крах в arrayPartialReverseSort [#61539](https://github.com/ClickHouse/ClickHouse/pull/61539) ([Рауль Марин](https://github.com/Algunenano)).
* Исправлено строковое поиск с постоянной позицией [#61547](https://github.com/ClickHouse/ClickHouse/pull/61547) ([Антонио Анделич](https://github.com/antonio2368)).
* Исправлено addDays, вызывающее ошибку при использовании datetime64 [#61561](https://github.com/ClickHouse/ClickHouse/pull/61561) ([Шуи Ли](https://github.com/loneylee)).
* Исправлен `system.part_log` для асинхронной вставки с дедупликацией [#61620](https://github.com/ClickHouse/ClickHouse/pull/61620) ([Антонио Анделич](https://github.com/antonio2368)).
* Исправлен Ненастроенный набор для system.parts. [#61666](https://github.com/ClickHouse/ClickHouse/pull/61666) ([Николай Кочетов](https://github.com/KochetovNicolai)).
