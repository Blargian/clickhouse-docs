---
alias: []
description: 'Документация для формата DWARF'
input_format: true
keywords: ['DWARF']
output_format: false
slug: /interfaces/formats/DWARF
title: 'DWARF'
---

| Входные данные | Выходные данные  | Псевдоним |
|----------------|------------------|-----------|
| ✔              | ✗                |           |

## Описание {#description}

Формат `DWARF` разбирает символы отладки DWARF из ELF файла (исполняемый файл, библиотека или объектный файл). 
Он аналогичен `dwarfdump`, но гораздо быстрее (сотни МБ/с) и поддерживает SQL. 
Он производит одну строку для каждого элемента отладочной информации (DIE) в разделе `.debug_info` 
и включает "нулевые" записи, которые кодировка DWARF использует для завершения списков дочерних элементов в дереве.

:::info
`.debug_info` состоит из *единиц*, которые соответствуют единицам компиляции: 
- Каждая единица представляет собой дерево *DIE*, с `compile_unit` DIE в качестве корня. 
- Каждый DIE имеет *тег* и список *атрибутов*. 
- Каждый атрибут имеет *имя* и *значение* (а также *форму*, которая указывает, как значение закодировано).

DIE представляют вещи из исходного кода, и их *тег* указывает, что это за вещь. Например, там есть:

- функции (тег = `subprogram`)
- классы/структуры/перечисления (`class_type`/`structure_type`/`enumeration_type`)
- переменные (`variable`)
- аргументы функции (`formal_parameter`).

Структура дерева отражает соответствующий исходный код. Например, `class_type` DIE может содержать `subprogram` DIE, представляющие методы класса.
:::

Формат `DWARF` выводит следующие столбцы:

- `offset` - позиция DIE в разделе `.debug_info`
- `size` - количество байт в закодированном DIE (включая атрибуты)
- `tag` - тип DIE; обычный префикс "DW_TAG_" опущен
- `unit_name` - имя единицы компиляции, содержащей этот DIE
- `unit_offset` - позиция единицы компиляции, содержащей этот DIE, в разделе `.debug_info`
- `ancestor_tags` - массив тегов предков текущего DIE в дереве, в порядке от самого внутреннего к самому внешнему
- `ancestor_offsets` - смещения предков, параллельно `ancestor_tags`
- несколько общих атрибутов, дублируемых из массива атрибутов для удобства:
    - `name`
    - `linkage_name` - искаженное полное квалифицированное имя; обычно только функции имеют его (но не все функции)
    - `decl_file` - имя файла исходного кода, где этот элемент был объявлен
    - `decl_line` - номер строки в исходном коде, где этот элемент был объявлен
- параллельные массивы, описывающие атрибуты:
    - `attr_name` - имя атрибута; обычный префикс "DW_AT_" опущен
    - `attr_form` - как атрибут кодируется и интерпретируется; обычный префикс DW_FORM_ опущен
    - `attr_int` - целочисленное значение атрибута; 0, если атрибут не имеет числового значения
    - `attr_str` - строковое значение атрибута; пусто, если атрибут не имеет строкового значения

## Пример использования {#example-usage}

Формат `DWARF` можно использовать для поиска единиц компиляции, которые содержат наибольшее количество определений функций (включая инстанциации шаблонов и функции из включенных заголовочных файлов):

```sql title="Запрос"
SELECT
    unit_name,
    count() AS c
FROM file('programs/clickhouse', DWARF)
WHERE tag = 'subprogram' AND NOT has(attr_name, 'declaration')
GROUP BY unit_name
ORDER BY c DESC
LIMIT 3
```
```text title="Ответ"
┌─unit_name──────────────────────────────────────────────────┬─────c─┐
│ ./src/Core/Settings.cpp                                    │ 28939 │
│ ./src/AggregateFunctions/AggregateFunctionSumMap.cpp       │ 23327 │
│ ./src/AggregateFunctions/AggregateFunctionUniqCombined.cpp │ 22649 │
└────────────────────────────────────────────────────────────┴───────┘

3 строки в наборе. Время выполнения: 1.487 сек. Обработано 139.76 миллионов строк, 1.12 ГБ (93.97 миллиона строк/с., 752.77 МБ/с.)
Максимальное использование памяти: 271.92 MiB.
```

## Настройки формата {#format-settings}
