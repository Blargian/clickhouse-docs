---
slug: /operations/utilities/clickhouse-obfuscator
title: clickhouse-obfuscator 
---

テーブルデータのオブfuscation用のシンプルなツールです。

入力テーブルを読み込み、入力のいくつかの特性を保持しつつ異なるデータを含む出力テーブルを生成します。
これはベンチマークで使用するために、ほぼ実際のプロダクションデータを公開することを可能にします。

データの以下の特性を保持するように設計されています：
- 各カラムおよび各カラムのタプルに対する値の基数（異なる値の数）；
- 条件付き基数：別のカラムの値に対する条件下での一つのカラムの異なる値の数；
- 整数の絶対値の確率分布；符号付き整数の符号；浮動小数点数の指数と符号；
- 文字列の長さの確率分布；
- 数値のゼロ値、空文字列および配列、`NULL`の確率；

- LZ77およびエントロピー系コーデックで圧縮した際のデータ圧縮率；
- テーブル全体の時間値の連続性（差の大きさ）；浮動小数点値の連続性；
- `DateTime`値の日付成分；

- 文字列値のUTF-8の有効性；
- 文字列値は自然に見える。

上記のほとんどの特性はパフォーマンステストに適しています：

データの読み取り、フィルタリング、集約、およびソートは、保存された基数、差の大きさ、圧縮率などのおかげで、元のデータとほぼ同じ速度で動作します。

これは決定論的に動作します：シード値を定義し、変換は入力データとシードによって決まります。
一部の変換は一対一であり、逆にすることができるため、大きなシードを持ち、秘密にしておく必要があります。

データを変換するためにいくつかの暗号化プリミティブを使用しますが、暗号的な観点から見ると、それを正しく行っていないため、別の理由がない限り、結果を安全とは見なさないでください。結果には、公開したくないデータが含まれている可能性があります。

常に0、1、-1の数値、日付、配列の長さ、およびnullフラグは、元のデータと同じように保たれます。
例えば、テーブルに`IsMobile`というカラムがあり、値が0と1である場合、変換されたデータでも同じ値を持ちます。

したがって、ユーザーはモバイルトラフィックの正確な比率を数えることができます。

別の例を挙げましょう。テーブルにユーザーのメールアドレスのようなプライベートデータがあり、単一のメールアドレスを公開したくない場合です。
テーブルが十分に大きく、複数の異なるメールアドレスを含み、他のメールアドレスよりも非常に高頻度のメールアドレスがない場合、すべてのデータが匿名化されます。しかし、カラムに異なる値が少ない場合、それらのいくつかを再現することができます。
このツールの動作アルゴリズムを見て、そのコマンドラインパラメータを微調整する必要があります。

このツールは、少なくとも中程度の量のデータ（少なくとも1000行以上）でのみ正常に動作します。
