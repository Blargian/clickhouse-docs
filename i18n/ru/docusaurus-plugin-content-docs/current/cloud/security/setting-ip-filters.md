---
sidebar_label: 'Настройка IP-фильтров'
slug: /cloud/security/setting-ip-filters
title: 'Настройка IP-фильтров'
description: 'Эта страница объясняет, как настроить IP-фильтры в ClickHouse Cloud для управления доступом к службам ClickHouse.'
---

import Image from '@theme/IdealImage';
import ip_filtering_after_provisioning from '@site/static/images/cloud/security/ip-filtering-after-provisioning.png';
import ip_filter_add_single_ip from '@site/static/images/cloud/security/ip-filter-add-single-ip.png';

## Настройка IP-фильтров {#setting-ip-filters}

IP-списки доступа фильтруют трафик к вашим службам ClickHouse, указывая, какие исходные адреса имеют право подключаться к вашей службе ClickHouse. Списки настраиваются для каждой службы. Списки можно настроить во время развертывания службы или позже. Если вы не настраиваете IP-список доступа во время подготовки, или если хотите внести изменения в ваш первоначальный список, вы можете сделать это, выбрав службу, а затем вкладку **Безопасность**.

:::important
Если вы пропустите создание IP-списка доступа для службы ClickHouse Cloud, то никакой трафик не будет разрешен к этой службе.
:::

## Подготовка {#prepare}
Прежде чем начать, соберите IP-адреса или диапазоны, которые должны быть добавлены в список доступа. Учитывайте удаленных сотрудников, места дежурства, VPN и т.д. Интерфейс пользователя IP-списка доступа принимает отдельные адреса и нотацию CIDR.

Нотация безклассовой междоменной маршрутизации (CIDR) позволяет указывать диапазоны IP-адресов, меньшие, чем традиционные размеры маски подсети классов A, B или C (8, 6 или 24). [ARIN](https://account.arin.net/public/cidrCalculator) и несколько других организаций предоставляют калькуляторы CIDR, если вам это нужно, и если вы хотите получить больше информации о нотации CIDR, пожалуйста, смотрите [Безклассовая междоменная маршрутизация (CIDR)](https://www.rfc-editor.org/rfc/rfc4632.html) RFC.

## Создание или изменение IP-списка доступа {#create-or-modify-an-ip-access-list}

Из списка служб ClickHouse Cloud выберите службу, а затем выберите **Настройки**. В разделе **Безопасность** вы найдете IP-список доступа. Нажмите на гиперссылку, где написано: *Вы можете подключаться к этой службе из* **(откуда угодно | x конкретные места)**

Появится боковая панель с вариантами конфигурации:

- Разрешить входящий трафик с любого места к службе
- Разрешить доступ из конкретных мест к службе
- Запретить доступ ко всей службе

Этот снимок экрана показывает список доступа, который позволяет трафик из диапазона IP-адресов, описанный как "Диапазон офиса NY":

<Image img={ip_filtering_after_provisioning} size="md" alt="Существующий список доступа в ClickHouse Cloud" border/>

### Возможные действия {#possible-actions}

1. Чтобы добавить дополнительную запись, вы можете использовать **+ Добавить новый IP**

   В этом примере добавляется один IP-адрес с описанием `Лондонский сервер`:

<Image img={ip_filter_add_single_ip} size="md" alt="Добавление одного IP в список доступа в ClickHouse Cloud" border/>

1. Удалить существующую запись

   Нажатие на крестик (x) может удалить запись

1. Изменить существующую запись

   Прямое изменение записи

1. Переключиться на доступ из **Любого места**

   Это не рекомендуется, но это разрешено. Мы рекомендуем вам открывать приложение, построенное на основе ClickHouse, для публики и ограничивать доступ к службе ClickHouse Cloud на стороне бэкенда.

Чтобы применить изменения, которые вы внесли, вы должны нажать **Сохранить**.

## Проверка {#verification}

После создания фильтра подтвердите возможность подключения из указанного диапазона и убедитесь, что подключения извне разрешенного диапазона отклоняются. Простая команда `curl` может быть использована для проверки:
```bash title="Попытка отклонена из-за отсутствия в списке разрешенных"
curl https://<HOSTNAME>.clickhouse.cloud:8443
```
```response
curl: (35) error:02FFF036:system library:func(4095):Connection reset by peer
```
или
```response
curl: (35) LibreSSL SSL_connect: SSL_ERROR_SYSCALL in connection to HOSTNAME.clickhouse.cloud:8443
```

```bash title="Попытка разрешена из списка разрешенных"
curl https://<HOSTNAME>.clickhouse.cloud:8443
```
```response
Ok.
```

## Ограничения {#limitations}

- В настоящее время IP-списки доступа поддерживают только IPv4
