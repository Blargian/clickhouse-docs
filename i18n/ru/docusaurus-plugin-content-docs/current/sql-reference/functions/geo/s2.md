--- 
slug: /sql-reference/functions/geo/s2
sidebar_label: 'S2 Геометрия'
title: 'Функции для работы с S2 индексом'
description: 'Документация для функций работы с S2 индексами'
---


# Функции для работы с S2 индексом

## S2Index {#s2index}

[S2](https://s2geometry.io/) — это система географической индексации, в которой все географические данные представлены на сфере (подобно глобусу).

В библиотеке S2 точки представлены как S2 индекс — конкретное число, которое внутренне кодирует точку на поверхности единичной сферы, в отличие от традиционных (широта, долгота) пар. Чтобы получить S2 индекс точки для данной точки, указанной в формате (широта, долгота), используйте функцию [geoToS2](#geotos2). Также вы можете использовать функцию [s2ToGeo](#s2togeo) для получения географических координат, соответствующих указанному S2 индексу точки.

## geoToS2 {#geotos2}

Возвращает [S2](#s2index) индекс точки, соответствующий предоставленным координатам `(долгота, широта)`.

**Синтаксис**

```sql
geoToS2(lon, lat)
```

**Аргументы**

- `lon` — Долгота. [Float64](../../data-types/float.md).
- `lat` — Широта. [Float64](../../data-types/float.md).

**Возвращаемые значения**

- S2 индекс точки. [UInt64](../../data-types/int-uint.md).

**Пример**

Запрос:

```sql
SELECT geoToS2(37.79506683, 55.71290588) AS s2Index;
```

Результат:

```text
┌─────────────s2Index─┐
│ 4704772434919038107 │
└─────────────────────┘
```

## s2ToGeo {#s2togeo}

Возвращает гео координаты `(долгота, широта)`, соответствующие предоставленному [S2](#s2index) индексу точки.

**Синтаксис**

```sql
s2ToGeo(s2index)
```

**Аргументы**

- `s2index` — S2 индекс. [UInt64](../../data-types/int-uint.md).

**Возвращаемые значения**

- Кортеж [tuple](../../data-types/tuple.md), состоящий из двух значений: 
    - `lon`. [Float64](../../data-types/float.md).
    - `lat`. [Float64](../../data-types/float.md).

**Пример**

Запрос:

```sql
SELECT s2ToGeo(4704772434919038107) AS s2Coodrinates;
```

Результат:

```text
┌─s2Coodrinates────────────────────────┐
│ (37.79506681471008,55.7129059052841) │
└──────────────────────────────────────┘
```

## s2GetNeighbors {#s2getneighbors}

Возвращает S2 соседние индексы, соответствующие предоставленному [S2](#s2index). Каждая ячейка в системе S2 является четырехугольником, ограниченным четырьмя геодезическими линиями. Таким образом, каждая ячейка имеет 4 соседа.

**Синтаксис**

```sql
s2GetNeighbors(s2index)
```

**Аргументы**

- `s2index` — S2 индекс. [UInt64](../../data-types/int-uint.md).

**Возвращаемое значение**

- Массив, состоящий из 4 соседних индексов: `array[s2index1, s2index3, s2index2, s2index4]`. [Array](../../data-types/array.md)([UInt64](../../data-types/int-uint.md)).

**Пример**

Запрос:

```sql
SELECT s2GetNeighbors(5074766849661468672) AS s2Neighbors;
```

Результат:

```text
┌─s2Neighbors───────────────────────────────────────────────────────────────────────┐
│ [5074766987100422144,5074766712222515200,5074767536856236032,5074767261978329088] │
└───────────────────────────────────────────────────────────────────────────────────┘
```

## s2CellsIntersect {#s2cellsintersect}

Определяет, пересекаются ли две предоставленные [S2](#s2index) ячейки или нет.

**Синтаксис**

```sql
s2CellsIntersect(s2index1, s2index2)
```

**Аргументы**

- `s2index1`, `s2index2` — S2 индекс. [UInt64](../../data-types/int-uint.md).

**Возвращаемое значение**

- `1` — Если ячейки пересекаются. [UInt8](../../data-types/int-uint.md).
- `0` — Если ячейки не пересекаются. [UInt8](../../data-types/int-uint.md).

**Пример**

Запрос:

```sql
SELECT s2CellsIntersect(9926595209846587392, 9926594385212866560) AS intersect;
```

Результат:

```text
┌─intersect─┐
│         1 │
└───────────┘
```

## s2CapContains {#s2capcontains}

Определяет, содержит ли кап S2 точку. Кап представляет собой часть сферы, которая была отрезана плоскостью. Он определяется точкой на сфере и радиусом в градусах.

**Синтаксис**

```sql
s2CapContains(center, degrees, point)
```

**Аргументы**

- `center` — S2 индекс точки, соответствующий капу. [UInt64](../../data-types/int-uint.md).
- `degrees` — Радиус капа в градусах. [Float64](../../data-types/float.md).
- `point` — S2 индекс точки. [UInt64](../../data-types/int-uint.md).

**Возвращаемое значение**

- `1` — Если кап содержит S2 индекс точки. [UInt8](../../data-types/int-uint.md).
- `0` — Если кап не содержит S2 индекс точки. [UInt8](../../data-types/int-uint.md).

**Пример**

Запрос:

```sql
SELECT s2CapContains(1157339245694594829, 1.0, 1157347770437378819) AS capContains;
```

Результат:

```text
┌─capContains─┐
│           1 │
└─────────────┘
```

## s2CapUnion {#s2capunion}

Определяет наименьший кап, который содержит два заданных капа. Кап представляет собой часть сферы, которая была отрезана плоскостью. Он определяется точкой на сфере и радиусом в градусах.

**Синтаксис**

```sql
s2CapUnion(center1, radius1, center2, radius2)
```

**Аргументы**

- `center1`, `center2` — S2 индексы точек, соответствующие двум входным капам. [UInt64](../../data-types/int-uint.md).
- `radius1`, `radius2` — Радиусы двух входных капов в градусах. [Float64](../../data-types/float.md).

**Возвращаемые значения**

- `center` — S2 индекс точки, соответствующий центру наименьшего капа, содержащего два входных капа. [UInt64](../../data-types/int-uint.md).
- `radius` — Радиус наименьшего капа, содержащего два входных капа. [Float64](../../data-types/float.md).

**Пример**

Запрос:

```sql
SELECT s2CapUnion(3814912406305146967, 1.0, 1157347770437378819, 1.0) AS capUnion;
```

Результат:

```text
┌─capUnion───────────────────────────────┐
│ (4534655147792050737,60.2088283994957) │
└────────────────────────────────────────┘
```

## s2RectAdd {#s2rectadd}

Увеличивает размер ограничивающего прямоугольника, чтобы включить заданную S2 точку. В системе S2 прямоугольник представлен типом S2Region, называемым `S2LatLngRect`, который представляет прямоугольник в пространстве широты-долготы.

**Синтаксис**

```sql
s2RectAdd(s2pointLow, s2pointHigh, s2Point)
```

**Аргументы**

- `s2PointLow` — Низкий S2 индекс точки, соответствующий прямоугольнику. [UInt64](../../data-types/int-uint.md).
- `s2PointHigh` — Высокий S2 индекс точки, соответствующий прямоугольнику. [UInt64](../../data-types/int-uint.md).
- `s2Point` — Целевой S2 индекс точки, который следует увеличить, чтобы включить его в ограничивающий прямоугольник. [UInt64](../../data-types/int-uint.md).

**Возвращаемые значения**

- `s2PointLow` — Низкий S2 индекс ячейки, соответствующий расширенному прямоугольнику. [UInt64](../../data-types/int-uint.md).
- `s2PointHigh` — Высокий S2 индекс ячейки, соответствующий расширенному прямоугольнику. [UInt64](../../data-types/float.md).

**Пример**

Запрос:

```sql
SELECT s2RectAdd(5178914411069187297, 5177056748191934217, 5179056748191934217) AS rectAdd;
```

Результат:

```text
┌─rectAdd───────────────────────────────────┐
│ (5179062030687166815,5177056748191934217) │
└───────────────────────────────────────────┘
```

## s2RectContains {#s2rectcontains}

Определяет, содержит ли данный прямоугольник S2 точку. В системе S2 прямоугольник представлен типом S2Region, называемым `S2LatLngRect`, который представляет прямоугольник в пространстве широты-долготы.

**Синтаксис**

```sql
s2RectContains(s2PointLow, s2PointHi, s2Point)
```

**Аргументы**

- `s2PointLow` — Низкий S2 индекс точки, соответствующий прямоугольнику. [UInt64](../../data-types/int-uint.md).
- `s2PointHigh` — Высокий S2 индекс точки, соответствующий прямоугольнику. [UInt64](../../data-types/int-uint.md).
- `s2Point` — Целевой S2 индекс точки. [UInt64](../../data-types/int-uint.md).

**Возвращаемое значение**

- `1` — Если прямоугольник содержит данную S2 точку.
- `0` — Если прямоугольник не содержит данную S2 точку.

**Пример**

Запрос:

```sql
SELECT s2RectContains(5179062030687166815, 5177056748191934217, 5177914411069187297) AS rectContains;
```

Результат:

```text
┌─rectContains─┐
│            0 │
└──────────────┘
```

## s2RectUnion {#s2rectunion}

Возвращает наименьший прямоугольник, содержащий объединение этого прямоугольника и заданного прямоугольника. В системе S2 прямоугольник представлен типом S2Region, называемым `S2LatLngRect`, который представляет прямоугольник в пространстве широты-долготы.

**Синтаксис**

```sql
s2RectUnion(s2Rect1PointLow, s2Rect1PointHi, s2Rect2PointLow, s2Rect2PointHi)
```

**Аргументы**

- `s2Rect1PointLow`, `s2Rect1PointHi` — Низкие и высокие S2 индексы точек, соответствующие первому прямоугольнику. [UInt64](../../data-types/int-uint.md).
- `s2Rect2PointLow`, `s2Rect2PointHi` — Низкие и высокие S2 индексы точек, соответствующие второму прямоугольнику. [UInt64](../../data-types/int-uint.md).

**Возвращаемые значения**

- `s2UnionRect2PointLow` — Низкий S2 индекс ячейки, соответствующий объединенному прямоугольнику. [UInt64](../../data-types/int-uint.md).
- `s2UnionRect2PointHi` — Высокий S2 индекс ячейки, соответствующий объединенному прямоугольнику. [UInt64](../../data-types/int-uint.md).

**Пример**

Запрос:

```sql
SELECT s2RectUnion(5178914411069187297, 5177056748191934217, 5179062030687166815, 5177056748191934217) AS rectUnion;
```

Результат:

```text
┌─rectUnion─────────────────────────────────┐
│ (5179062030687166815,5177056748191934217) │
└───────────────────────────────────────────┘
```

## s2RectIntersection {#s2rectintersection}

Возвращает наименьший прямоугольник, содержащий пересечение этого прямоугольника и заданного прямоугольника. В системе S2 прямоугольник представлен типом S2Region, называемым `S2LatLngRect`, который представляет прямоугольник в пространстве широты-долготы.

**Синтаксис**

```sql
s2RectIntersection(s2Rect1PointLow, s2Rect1PointHi, s2Rect2PointLow, s2Rect2PointHi)
```

**Аргументы**

- `s2Rect1PointLow`, `s2Rect1PointHi` — Низкие и высокие S2 индексы точек, соответствующие первому прямоугольнику. [UInt64](../../data-types/int-uint.md).
- `s2Rect2PointLow`, `s2Rect2PointHi` — Низкие и высокие S2 индексы точек, соответствующие второму прямоугольнику. [UInt64](../../data-types/int-uint.md).

**Возвращаемые значения**

- `s2UnionRect2PointLow` — Низкий S2 индекс ячейки, соответствующий прямоугольнику, содержащему пересечение заданных прямоугольников. [UInt64](../../data-types/int-uint.md).
- `s2UnionRect2PointHi` — Высокий S2 индекс ячейки, соответствующий прямоугольнику, содержащему пересечение заданных прямоугольников. [UInt64](../../data-types/int-uint.md).

**Пример**

Запрос:

```sql
SELECT s2RectIntersection(5178914411069187297, 5177056748191934217, 5179062030687166815, 5177056748191934217) AS rectIntersection;
```

Результат:

```text
┌─rectIntersection──────────────────────────┐
│ (5178914411069187297,5177056748191934217) │
└───────────────────────────────────────────┘
```
