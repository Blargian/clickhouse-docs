---
slug: /about-us/history
sidebar_label: ClickHouseの歴史
sidebar_position: 40
description: ClickHouseの開発の歴史
tags: ['歴史', '開発', 'Metrica']
---

# ClickHouseの歴史 {#clickhouse-history}

ClickHouseは、[Yandex.Metrica](https://metrica.yandex.com/)のために最初に開発されました。これは、[世界で二番目に大きなウェブ解析プラットフォーム](http://w3techs.com/technologies/overview/traffic_analysis/all)であり、現在もそのコアコンポーネントとして機能しています。データベース内に13兆件以上のレコードがあり、日々200億件以上のイベントが発生する中で、ClickHouseは非集約データから即座にカスタムレポートを生成することを可能にしています。この記事では、ClickHouseの初期段階における目標を簡単に説明します。

Yandex.Metricaは、ユーザーが定義した任意のセグメントに基づいて、ヒット数やセッションに基づくカスタマイズされたレポートをリアルタイムで構築します。これにはしばしば、ユニークユーザー数のような複雑な集約を構築することが必要となり、レポート生成のための新しいデータがリアルタイムで到着します。

2014年4月の時点で、Yandex.Metricaは日々約120億件のイベント（ページビューやクリック）を追跡していました。これらのイベントはすべてカスタムレポートを作成するために保存される必要がありました。単一のクエリでは、数百万行をわずか数百ミリ秒でスキャンする必要があったり、数億行を数秒でスキャンする必要があったりすることもありました。

## Yandex.Metricaおよび他のYandexサービスにおける利用 {#usage-in-yandex-metrica-and-other-yandex-services}

ClickHouseはYandex.Metrica内で複数の目的に使用されています。
その主なタスクは、非集約データを使用してオンラインモードでレポートを構築することです。ClickHouseは374台のサーバークラスターを使用しており、データベースに20.3兆行以上を保存しています。圧縮データのボリュームは約2PBで、重複やレプリカを考慮していません。非圧縮データ（TSV形式）のボリュームは約17PBになります。

ClickHouseは以下のプロセスでも重要な役割を果たしています：

- Yandex.Metricaからのセッションリプレイのためのデータの保存。
- 中間データの処理。
- Analyticsを使用したグローバルレポートの構築。
- Yandex.Metricaエンジンのデバッグのためのクエリの実行。
- APIやユーザーインターフェースからのログの分析。

現在、Yandexの他のサービスや部門でも数十件のClickHouseインストールが存在します：検索縦パート、eコマース、広告、ビジネス分析、モバイル開発、個人サービスなど。

## 集約データと非集約データ {#aggregated-and-non-aggregated-data}

統計を効果的に計算するにはデータを集約する必要があるという広くある意見があります。これはデータ量を減少させるからです。

しかし、データ集約には多くの制限があります：

- 必要なレポートの事前定義されたリストが必要です。
- ユーザーはカスタムレポートを作成できません。
- 大量の異なるキーで集約する際には、データ量はほとんど減少しないため、集約は無意味です。
- 多くのレポートに対しては、集約のバリエーションが多すぎます（組合せ爆発）。
- 高いカーディナリティのキー（URLなど）で集約する場合、データ量はあまり減少しません（2倍未満）。
- そのため、集約によるデータ量は減るどころか増える可能性があります。
- ユーザーは私たちが生成するすべてのレポートを見ているわけではありません。その計算の大部分は無駄です。
- 様々な集約によってデータの論理的一貫性が違反される可能性があります。

もし何も集約せず非集約データを扱う場合、計算のボリュームを減らすことができます。

しかし、集約を行うことで作業の大部分がオフラインに移され、比較的穏やかに実行されます。一方、オンライン計算では結果を待つユーザーのために、できるだけ早く計算を行う必要があります。

Yandex.Metricaは、ほとんどのレポートに使用されるデータ集約用の専門システム「Metrage」を持っています。
2009年以降、Yandex.Metricaは、レポートビルダーで以前に使用されていた非集約データ用のOLAPデータベース「OLAPServer」をも使用していました。
OLAPServerは非集約データには適していましたが、すべてのレポートに望ましいようには使用できない多くの制限がありました。これには、データ型のサポートが不十分（数値のみ）で、リアルタイムでデータを段階的に更新できない（毎日データを書き換えることでしかできない）という制限がありました。OLAPServerはDBMSではなく専門的なデータベースです。

ClickHouseの初期の目標は、OLAPServerの制限を取り除き、すべてのレポート用の非集約データを扱う問題を解決することでしたが、年月が経つにつれて、あらゆる種類の分析タスクに適した汎用的なデータベース管理システムに成長しました。
