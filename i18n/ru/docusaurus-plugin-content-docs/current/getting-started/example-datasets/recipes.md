---
description: 'Набор данных RecipeNLG, содержащий 2,2 миллиона рецептов'
sidebar_label: 'Набор данных рецептов'
slug: /getting-started/example-datasets/recipes
title: 'Набор данных рецептов'
---

Набор данных RecipeNLG доступен для загрузки [здесь](https://recipenlg.cs.put.poznan.pl/dataset). Он содержит 2,2 миллиона рецептов. Размер составляет чуть меньше 1 ГБ.
## Загрузите и распакуйте набор данных {#download-and-unpack-the-dataset}

1. Перейдите на страницу загрузки [https://recipenlg.cs.put.poznan.pl/dataset](https://recipenlg.cs.put.poznan.pl/dataset).
2. Примите Условия и положения и загрузите zip-файл.
3. Опционально: Используйте команду `md5sum dataset.zip`, чтобы проверить целостность zip-файла; он должен совпадать со значением `3a168dfd0912bb034225619b3586ce76`.
4. Распакуйте zip-файл с помощью `unzip dataset.zip`. Вы получите файл `full_dataset.csv` в каталоге `dataset`.
## Создайте таблицу {#create-a-table}

Запустите clickhouse-client и выполните следующий запрос CREATE:

```sql
CREATE TABLE recipes
(
    title String,
    ingredients Array(String),
    directions Array(String),
    link String,
    source LowCardinality(String),
    NER Array(String)
) ENGINE = MergeTree ORDER BY title;
```
## Вставьте данные {#insert-the-data}

Запустите следующую команду:

```bash
clickhouse-client --query "
    INSERT INTO recipes
    SELECT
        title,
        JSONExtract(ingredients, 'Array(String)'),
        JSONExtract(directions, 'Array(String)'),
        link,
        source,
        JSONExtract(NER, 'Array(String)')
    FROM input('num UInt32, title String, ingredients String, directions String, link String, source LowCardinality(String), NER String')
    FORMAT CSVWithNames
" --input_format_with_names_use_header 0 --format_csv_allow_single_quote 0 --input_format_allow_errors_num 10 < full_dataset.csv
```

Это демонстрация того, как разобрать пользовательский CSV, так как это требует нескольких параметров.

Объяснение:
- Набор данных в формате CSV, но требует некоторой предобработки перед вставкой; мы используем табличную функцию [input](../../sql-reference/table-functions/input.md) для выполнения предобработки;
- Структура CSV файла указана в аргументе табличной функции `input`;
- Поле `num` (номер строки) не нужно - мы разбираем его из файла и игнорируем;
- Мы используем `FORMAT CSVWithNames`, но заголовок в CSV будет проигнорирован (из-за параметра командной строки `--input_format_with_names_use_header 0`), поскольку заголовок не содержит имени для первого поля;
- Файл использует только двойные кавычки для обрамления строк CSV; некоторые строки не обрамлены двойными кавычками, и одинарная кавычка не должна быть интерпретирована как обрамление строки - поэтому мы также добавляем параметр `--format_csv_allow_single_quote 0`;
- Некоторые строки из CSV невозможно разобрать, поскольку они содержат последовательность `\M/` в начале значения; единственное значение, начинающееся со слэш, в CSV может быть `\N`, которое интерпретируется как SQL NULL. Мы добавляем параметр `--input_format_allow_errors_num 10`, и до десяти поврежденных записей могут быть пропущены;
- Для ингредиентов, направлений и полей NER используются массивы; эти массивы представлены в необычной форме: они сериализованы в строку как JSON и затем помещены в CSV - мы разбираем их как String и затем используем функцию [JSONExtract](../../sql-reference/functions/json-functions.md), чтобы преобразовать их в Array.
## Проверьте вставленные данные {#validate-the-inserted-data}

Проверив количество строк:

Запрос:

```sql
SELECT count() FROM recipes;
```

Результат:

```text
┌─count()─┐
│ 2231142 │
└─────────┘
```
## Примеры запросов {#example-queries}
### Топ компонентов по количеству рецептов: {#top-components-by-the-number-of-recipes}

В этом примере мы узнаем, как использовать функцию [arrayJoin](../../sql-reference/functions/array-join.md) для расширения массива в набор строк.

Запрос:

```sql
SELECT
    arrayJoin(NER) AS k,
    count() AS c
FROM recipes
GROUP BY k
ORDER BY c DESC
LIMIT 50
```

Результат:

```text
┌─k────────────────────┬──────c─┐
│ salt                 │ 890741 │
│ sugar                │ 620027 │
│ butter               │ 493823 │
│ flour                │ 466110 │
│ eggs                 │ 401276 │
│ onion                │ 372469 │
│ garlic               │ 358364 │
│ milk                 │ 346769 │
│ water                │ 326092 │
│ vanilla              │ 270381 │
│ olive oil            │ 197877 │
│ pepper               │ 179305 │
│ brown sugar          │ 174447 │
│ tomatoes             │ 163933 │
│ egg                  │ 160507 │
│ baking powder        │ 148277 │
│ lemon juice          │ 146414 │
│ Salt                 │ 122558 │
│ cinnamon             │ 117927 │
│ sour cream           │ 116682 │
│ cream cheese         │ 114423 │
│ margarine            │ 112742 │
│ celery               │ 112676 │
│ baking soda          │ 110690 │
│ parsley              │ 102151 │
│ chicken              │ 101505 │
│ onions               │  98903 │
│ vegetable oil        │  91395 │
│ oil                  │  85600 │
│ mayonnaise           │  84822 │
│ pecans               │  79741 │
│ nuts                 │  78471 │
│ potatoes             │  75820 │
│ carrots              │  75458 │
│ pineapple            │  74345 │
│ soy sauce            │  70355 │
│ black pepper         │  69064 │
│ thyme                │  68429 │
│ mustard              │  65948 │
│ chicken broth        │  65112 │
│ bacon                │  64956 │
│ honey                │  64626 │
│ oregano              │  64077 │
│ ground beef          │  64068 │
│ unsalted butter      │  63848 │
│ mushrooms            │  61465 │
│ Worcestershire sauce │  59328 │
│ cornstarch           │  58476 │
│ green pepper         │  58388 │
│ Cheddar cheese       │  58354 │
└──────────────────────┴────────┘

50 строк в наборе. Время выполнения: 0.112 сек. Обработано 2.23 миллиона строк, 361.57 МБ (19.99 миллиона строк/с., 3.24 ГБ/с.)
```
### Самые Сложные Рецепты с Клубникой {#the-most-complex-recipes-with-strawberry}

```sql
SELECT
    title,
    length(NER),
    length(directions)
FROM recipes
WHERE has(NER, 'strawberry')
ORDER BY length(directions) DESC
LIMIT 10
```

Результат:

```text
┌─title────────────────────────────────────────────────────────────┬─length(NER)─┬─length(directions)─┐
│ Шоколадно-Клубнично-Апельсиновый свадебный торт                │          24 │                126 │
│ Клубничный торт с творожным кремом и крошкой                  │          19 │                 47 │
│ Мороженое в стиле Шарлотты                                     │          11 │                 45 │
│ Греховно вкусный многослойный шоколадный торт с клубникой      │          31 │                 45 │
│ Сладкие ягоды с шербертом из базилика                         │          24 │                 44 │
│ Шоколадно-Клубничный муссовый торт                            │          15 │                 42 │
│ Ревеневый Шарлотт с клубникой и ромом                          │          20 │                 42 │
│ Клубничный ванильный тарт шефа Джои                           │           7 │                 37 │
│ Ванильный торт с мороженым по-старинному                      │          17 │                 37 │
│ Торт из арбуза                                               │          16 │                 36 │
└──────────────────────────────────────────────────────────────────┴─────────────┴────────────────────┘

10 строк в наборе. Время выполнения: 0.215 сек. Обработано 2.23 миллиона строк, 1.48 ГБ (10.35 миллиона строк/с., 6.86 ГБ/с.)
```

В этом примере мы используем функцию [has](../../sql-reference/functions/array-functions.md#hasarr-elem) для фильтрации по элементам массива и сортировки по количеству шагов.

Существует свадебный торт, для которого требуется целых 126 шагов для его приготовления! Показать эти шаги:

Запрос:

```sql
SELECT arrayJoin(directions)
FROM recipes
WHERE title = 'Шоколадно-Клубнично-Апельсиновый свадебный торт'
```

Результат:

```text
┌─arrayJoin(directions)───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ Разместите одну решетку в центре и одну решетку в нижней трети духовки и разогрейте до 350F.                                                                                           │
│ Смажьте один торт диаметром 5 дюймов и высотой 2 дюйма, один торт диаметром 8 дюймов и высотой 2 дюйма и один торт диаметром 12 дюймов и высотой 2 дюйма.   │
│ Посыпьте формы мукой; застелите дно пергаментом.                                                                                                                          │
│ Смешайте 1/3 стакана апельсинового сока и 2 унции несладкого шоколада в тяжелой маленькой кастрюле.                                                                                    │
│ Нагревайте смесь на среднем огне, пока шоколад не растает.                                                                                                                    │
│ Снимите с огня.                                                                                                                                                           │
│ Постепенно добавляйте 1 2/3 стакана апельсинового сока.                                                                                                                                   │
│ Просейте 3 стакана муки, 2/3 стакана какао, 2 чайные ложки разрыхлителя, 1 чайную ложку соли и 1/2 чайной ложки пищевой соды в среднюю миску.                                                 │
│ С помощью электрического миксера взбейте 1 стакан (2 палочки) масла и 3 стакана сахара в большой миске до однородности (смесь будет выглядеть зернистой).                                                 │
│ Добавьте 4 яйца, по одному, взбивая после каждого.                                                                                                                       │
│ Вмешайте 1 столовую ложку апельсиновой цедры и 1 столовую ложку ванильного экстракта.                                                                                                          │
│ Добавляйте сухие ингредиенты чередуя с апельсиновой смесью в 3 добавления, хорошо взбивая после каждого добавления.                                                            │
│ Добавьте 1 стакан шоколадных чипсов.                                                                                                                                               │
│ Переложите 1 стакан плюс 2 столовые ложки теста в подготовленную 5-дюймовую форму, 3 стакана теста в подготовленную 8-дюймовую форму и оставшееся тесто (примерно 6 стаканов) в 12-дюймовую форму.                   │
│ Поместите формы диаметром 5 и 8 дюймов на центральную решетку духовки.                                                                                                                        │
│ Поместите 12-дюймовую форму на нижнюю решетку духовки.                                                                                                                                    │
│ Выпекайте торты, пока проверочная шпажка, вставленная в центр, не выйдет чистой, около 35 минут.                                                                                             │
│ Переложите торты в формах на решетки и дайте полностью остыть.                                                                                                                        │
│ Нанесите круг диаметром 4 дюйма на одном круге картона диаметром 6 дюймов.                                                                                                    │
│ Вырежьте отмеченный круг.                                                                                                                                                      │
│ Нанесите круг диаметром 7 дюймов на одном круге картона диаметром 8 дюймов.                                                                                                    │
│ Вырежьте отмеченный круг.                                                                                                                                                      │
│ Нанесите круг диаметром 11 дюймов на одном круге картона диаметром 12 дюймов.                                                                                                  │
│ Вырежьте отмеченный круг.                                                                                                                                                      │
│ Проведите ножом по бокам 5-дюймового торта, чтобы освободить.                                                                                                                                  │
│ Поместите 4-дюймовый картон поверх формы.                                                                                                                                            │
│ Удерживайте картон и форму вместе; переверните торт на картон.                                                                                                              │
│ Снимите пергамент. Замотайте торты в фольгу.                                                                                                                     │
│ Повторите процесс переворачивания, снятия пергамента и заворачивания тортов в фольгу, используя 7-дюймовый картон для 8-дюймового торта и 11-дюймовый картон для 12-дюймового торта.                        │
│ Используя оставшиеся ингредиенты, приготовьте еще одну партию теста и выпекайте 3 дополнительных слоя торта, как указано выше.                                                               │
│ Охлаждайте торты в формах.                                                                                                                                                         │
│ Плотно накройте торты в формах фольгой.                                                                                                                                      │
│ (Можно приготовить заранее.                                                                                                                                                     │
│ Оставьте при комнатной температуре на срок до 1 дня или заверните все слои торта в два слоя и заморозьте на срок до 1 недели.                                                                           │
│ Дайте слоям торта достичь комнатной температуры перед использованием.)                                                                                                                        │
│ Поместите первый 12-дюймовый торт на его картон на рабочей поверхности.                                                                                                                  │
│ Распределите 2 3/4 стакана ганаша по верхней части торта и по краям.                                                                                                         │
│ Распределите 2/3 стакана варенья по ганашу, оставляя 1/2 дюйма шоколадной границы по краям.                                                                                                 │
│ Положите 1 3/4 стакана белого шоколадного крема ложками на варенье.                                                                                                             │
│ Осторожно распределите крем по варенью, оставляя 1/2 дюйма шоколадной границы по краям.                                                                                                 │
│ Протрите немного какао по второму 12-дюймовому картону.                                                                                                                        │
│ Проведите ножом по бокам второго 12-дюймового торта, чтобы освободить.                                                                                                                          │
│ Поместите картон, какао стороной вниз, поверх формы.                                                                                                                                 │
│ Переверните торт на картон.                                                                                                                                               │
│ Снимите пергамент.                                                                                                                                                         │
│ Осторожно переместите торт с картона на начинку первого 12-дюймового торта.                                                                                                  │
│ Охлаждайте.                                                                                                                                                                │
│ Поместите первый 8-дюймовый торт на его картон на рабочей поверхности.                                                                                                                   │
│ Распределите 1 стакан ганаша по верхней части, доходя до краев.                                                                                                                          │
│ Распределите 1/4 стакана варенья, оставляя 1/2 дюйма шоколадной границы по краям.                                                                                                         │
│ Положите 1 стакан белого шоколадного крема ложками на варенье.                                                                                                                  │
│ Осторожно распределите крем по варенью, оставляя 1/2 дюйма шоколадной границы по краям.                                                                                                 │
│ Протрите немного какао по второму 8-дюймовому картону.                                                                                                                                │
│ Проведите ножом по бокам второго 8-дюймового торта, чтобы освободить.                                                                                                                           │
│ Поместите картон, какао стороной вниз, поверх формы.                                                                                                                                 │
│ Переверните торт на картон.                                                                                                                                               │
│ Снимите пергамент.                                                                                                                                                         │
│ Переместите торт с картона на начинку первого 8-дюймового торта.                                                                                                             │
│ Охлаждайте.                                                                                                                                                                │
│ Поместите первый 5-дюймовый торт на его картон на рабочей поверхности.                                                                                                                   │
│ Распределите 1/2 стакана ганаша по верхней части торта и по краям.                                                                                                            │
│ Распределите 2 столовые ложки варенья, оставляя 1/2 дюйма шоколадной границы по краям.                                                                                                   │
│ Положите 1/3 стакана белого шоколадного крема ложками на варенье.                                                                                                                │
│ Осторожно распределите крем по варенью, оставляя 1/2 дюйма шоколадной границы по краям.                                                                                                 │
│ Протрите какао по второму 6-дюймовому картону.                                                                                                                                     │
│ Проведите ножом по бокам второго 5-дюймового торта, чтобы освободить.                                                                                                                           │
│ Поместите картон, какао стороной вниз, поверх формы.                                                                                                                                 │
│ Переверните торт на картон.                                                                                                                                               │
│ Снимите пергамент.                                                                                                                                                         │
│ Переместите торт с картона на начинку первого 5-дюймового торта.                                                                                                             │
│ Охлаждайте все торты в течение 1 часа, чтобы начинка застыла.                                                                                                                                      │
│ Поместите 12-дюймовый многоярусный торт на его картон на вращающемся подставке для тортов.                                                                                                         │
│ Распределите 2 2/3 стакана крема по верхней и боковым сторонам торта в качестве первого слоя.                                                                                                      │
│ Охлаждайте торт.                                                                                                                                                           │
│ Поместите 8-дюймовый многоярусный торт на его картон на подставке для тортов.                                                                                                                    │
│ Распределите 1 1/4 стакана крема по верхней и боковым сторонам торта в качестве первого слоя.                                                                                                      │
│ Охлаждайте торт.                                                                                                                                                           │
│ Поместите 5-дюймовый многоярусный торт на его картон на подставке для тортов.                                                                                                                    │
│ Распределите 3/4 стакана крема по верхней и боковым сторонам торта в качестве первого слоя.                                                                                                         │
│ Охлаждайте все торты, пока первый слой крема не застынет, около 1 часа.                                                                                                      │
│ (Торты можно приготовить до этого момента за 1 день; накройте и держите в холодильнике.)                                                                                            │
│ Подготовьте вторую партию крема, используя оставшиеся ингредиенты для крема и следуя инструкциям для первой партии.                                                            │
│ Наполните 2 стакана крема в кондитерский мешок с маленькой звездной насадкой.                                                                                                           │
│ Поместите 12-дюймовый торт на его картон на большой плоской тарелке.                                                                                                                  │
│ Поместите тарелку на подставке для тортов.                                                                                                                                                │
│ С помощью лопатки распределите 2 1/2 стакана крема по верхней и боковым сторонам торта; выровняйте верх.                                                                                     │
│ Используя полный кондитерский мешок, оформите декоративный бордюр вокруг верхнего края торта.                                                                                                    │
│ Охлаждайте торт на тарелке.                                                                                                                                                │
│ Поместите 8-дюймовый торт на его картон на подставке для тортов.                                                                                                                           │
│ С помощью лопатки распределите 1 1/2 стакана крема по верхней и боковым сторонам торта; выровняйте верх.                                                                                     │
│ Используя кондитерский мешок, оформите декоративный бордюр вокруг верхнего края торта.                                                                                                           │
│ Охлаждайте торт на его картоне.                                                                                                                                          │
│ Поместите 5-дюймовый торт на его картон на подставке для тортов.                                                                                                                           │
│ С помощью лопатки распределите 3/4 стакана крема по верхней и боковым сторонам торта; выровняйте верх.                                                                                        │
│ Используя кондитерский мешок, оформите декоративный бордюр вокруг верхнего края торта, если необходимо, добавляя крем в мешок.                                                             │
│ Охлаждайте торт на его картоне.                                                                                                                                          │
│ Держите все торты в холодильнике до тех пор, пока крем не застынет, около 2 часов.                                                                                                             │
│ (Можно приготовить за 2 дня заранее.                                                                                                                                              │
│ Накройте не слишком плотно; держите в холодильнике.)                                                                                                                                          │
│ Поместите 12-дюймовый торт на тарелку на рабочей поверхности.                                                                                                                              │
│ Вставьте 1 деревянный штырев в центр торта прямо вниз до полного прохождения.                                                                                              │
│ Отметьте штырь на 1/4 дюйма выше верхнего уровня крема.                                                                                                                                  │
│ Удалите штырь и отрежьте его с помощью зазубренного ножа по отмеченной точке.                                                                                                                   │
│ Обрежьте еще 4 штыря до той же длины.                                                                                                                                           │
│ Вставьте 1 обрезанный штырь обратно в центр торта.                                                                                                                                 │
│ Вставьте оставшиеся 4 обрезанных штыря в торт, расположив их на расстоянии 3 1/2 дюйма от краев торта и равномерно распределив.                                                                 │
│ Поместите 8-дюймовый торт на его картон на рабочей поверхности.                                                                                                                         │
│ Вставьте 1 штырь прямо вниз в центр торта.                                                                                                     │
│ Отметьте штырь на 1/4 дюйма выше верхнего уровня крема.                                                                                                                                  │
│ Удалите штырь и отрежьте его с помощью зазубренного ножа по отмеченной точке.                                                                                                                   │
│ Обрежьте 3 обрезанных штыря до той же длины.                                                                                                                                           │
│ Вставьте 1 обрезанный штырь обратно в центр торта.                                                                                                                                 │
│ Вставьте оставшиеся 3 обрезанных штыря в торт, расположив их на расстоянии 2 1/2 дюйма от краев и равномерно распределив.                                                                      │
│ Используя большую металлическую лопатку в качестве помощи, поместите 8-дюймовый торт на его картон сверху на штырях в 12-дюймовом торте, аккуратно центрируя.                                                      │
│ Осторожно положите 5-дюймовый торт на его картон сверху на штырях в 8-дюймовом торте, аккуратно центрируя.                                                                                  │
│ Используя цедру цитрусовых, нарежьте длинные полоски апельсиновой цедры с апельсинов.                                                                                                         │
│ Нарежьте полоски на длинные сегменты.                                                                                                                                              │
│ Для создания спиралей из апельсиновой цедры оберните сегмент цедры вокруг ручки деревянной ложки; осторожно снимите цедру с ручки, чтобы сохранить завиток.                                   │
│ Украсить торт спиралями из апельсиновой цедры, лозой или веточками мяты и несколькими ягодами.                                                                                                  │
│ (Собранный торт можно сделать за 8 часов заранее.                                                                                                                            │
│ Дайте постоять при холодной комнатной температуре.)                                                                                                                                        │
│ Удалите верхние и средние уровни тортов.                                                                                                                                           │
│ Удалите штыри из тортов.                                                                                                                                                   │
│ Нарежьте верхние и средние торты на куски.                                                                                                                                       │
│ Чтобы нарезать 12-дюймовый торт: начните за 3 дюйма от края и вставив нож прямо вниз, нарежьте от верхней до нижней части, чтобы создать круг диаметром 6 дюймов в центре торта. │
│ Нарежьте внешнюю часть торта на куски; нарежьте внутреннюю часть на куски и подавайте с клубникой.                                                                           │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

126 строк в наборе. Время выполнения: 0.011 сек. Обработано 8.19 тысячи строк, 5.34 МБ (737.75 тысячи строк/с., 480.59 МБ/с.)
```
### Онлайн Площадка {#online-playground}

Набор данных также доступен в [Онлайн Площадке](https://sql.clickhouse.com?query_id=HQXNQZE26Z1QWYP9KC76ML).
