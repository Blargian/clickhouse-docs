---
slug: /operations/quotas
sidebar_position: 51
sidebar_label: クォータ
title: クォータ
---

クォータは、一定期間にわたるリソース使用量を制限したり、リソースの使用状況を追跡したりすることを可能にします。
クォータは通常、'users.xml'というユーザー設定ファイルに設定されます。

システムには、単一のクエリの複雑さを制限する機能もあります。[クエリの複雑さに関する制限](../operations/settings/query-complexity.md)のセクションを参照してください。

クエリの複雑さに関する制限とは異なり、クォータは以下のことを行います：

- 単一のクエリを制限する代わりに、一定期間内に実行できるクエリのセットに制限を設けます。
- 分散クエリ処理のために、すべてのリモートサーバーで消費されたリソースを考慮に入れます。

ここでは、クォータを定義する'users.xml'ファイルのセクションを見てみましょう。

``` xml
<!-- クォータ -->
<quotas>
    <!-- クォータ名。 -->
    <default>
        <!-- 時間の制限。異なる制限のために多くのインターバルを設定できます。 -->
        <interval>
            <!-- インターバルの長さ。 -->
            <duration>3600</duration>

            <!-- 無制限。指定された時間インターバルのためにデータを収集するだけです。 -->
            <queries>0</queries>
            <query_selects>0</query_selects>
            <query_inserts>0</query_inserts>
            <errors>0</errors>
            <result_rows>0</result_rows>
            <read_rows>0</read_rows>
            <execution_time>0</execution_time>
        </interval>
    </default>
```

デフォルトでは、クォータは使用制限なしで、毎時間のリソース消費を追跡します。
各インターバルで計算されたリソース消費は、各リクエストの後にサーバーログに出力されます。

``` xml
<statbox>
    <!-- 時間の制限。異なる制限のために多くのインターバルを設定できます。 -->
    <interval>
        <!-- インターバルの長さ。 -->
        <duration>3600</duration>

        <queries>1000</queries>
        <query_selects>100</query_selects>
        <query_inserts>100</query_inserts>
        <errors>100</errors>
        <result_rows>1000000000</result_rows>
        <read_rows>100000000000</read_rows>
        <execution_time>900</execution_time>
    </interval>

    <interval>
        <duration>86400</duration>

        <queries>10000</queries>
        <query_selects>10000</query_selects>
        <query_inserts>10000</query_inserts>
        <errors>1000</errors>
        <result_rows>5000000000</result_rows>
        <read_rows>500000000000</read_rows>
        <execution_time>7200</execution_time>
    </interval>
</statbox>
```

'statbox'クォータでは、毎時間と24時間（86,400秒）ごとに制限が設定されています。時間のインターバルは、実装定義の固定した瞬間からカウントされます。言い換えれば、24時間のインターバルは必ずしも真夜中から始まるわけではありません。

インターバルが終了すると、収集されたすべての値はクリアされます。次の時間のために、クォータの計算は最初から始まります。

制限される量は次のとおりです：

`queries` – リクエストの総数。

`query_selects` – セレクトリクエストの総数。

`query_inserts` – インサートリクエストの総数。

`errors` – 例外をスローしたクエリの数。

`result_rows` – 結果として返された行の総数。

`read_rows` – すべてのリモートサーバーでクエリを実行するためにテーブルから読み取られたソース行の総数。

`execution_time` – クエリの総実行時間（秒単位、ウォールタイム）。

制限が1つのインターバルでも超過した場合、どの制限がいつ超過したか、次の新しいインターバルがいつ始まるか（再びクエリを送信できる時期）についてのテキストとともに例外がスローされます。

クォータは "クォータキー" 機能を使用して、複数のキーのリソースを独立して報告できます。以下はその例です：

``` xml
<!-- グローバルレポートデザイナー用。 -->
<web_global>
    <!-- keyed – クォータキー "key" がクエリパラメータに渡され、
            各キーの値に対してクォータが別々に追跡されます。
        たとえば、ユーザー名をキーとして渡すことで、
            各ユーザー名ごとにクォータが別々にカウントされます。
        キーを使用することは、クォータキーがプログラムによって渡される場合にのみ意味があります。
        ユーザーによって渡される場合は意味がありません。

        また、<keyed_by_ip /> を記述することで、IPアドレスをクォータキーとして使用できます。
        （ただし、ユーザーは比較的簡単にIPv6アドレスを変更できることに注意してください。）
    -->
    <keyed />
```

クォータは設定の'users'セクションでユーザーに割り当てられます。「アクセス権」セクションを参照してください。

分散クエリ処理の場合、蓄積された量はリクエスト元のサーバーに保存されます。したがって、ユーザーが別のサーバーに移動すると、そちらではクォータが「最初から始まります」。

サーバーが再起動されると、クォータはリセットされます。
