---
sidebar_label: 'ローカルファイルの挿入'
sidebar_position: 2
title: 'ローカルファイルの挿入'
slug: /integrations/data-ingestion/insert-local-files
description: 'ローカルファイルの挿入について学ぶ'
---


# ローカルファイルの挿入

`clickhouse-client`を使用して、ローカルファイルをClickHouseサービスにストリーミングすることができます。これにより、多くの強力で便利なClickHouse関数を使用してデータを前処理することが可能になります。例を見てみましょう...

1. `comments.tsv`という名前のTSVファイルがあり、Hacker Newsのコメントが含まれていて、ヘッダー行にはカラム名が含まれています。データを挿入する際には、[入力フォーマット](/interfaces/formats)を指定する必要があり、私たちの場合は`TabSeparatedWithNames`です：

```text
id      type    author  timestamp       comment children
19464423        comment adrianmonk      2019-03-22 16:58:19     "最初にリンゴとオレンジの比較です。刑務所の人口に関連するセキュリティ費用が必要です。囚人の行動を管理（喧嘩を防ぐ等）し、逃げないようにするためには、スタッフ、施設、設備などが必要です。この2つは異なる目的を持っているため、異なるコストがかかります。<p>冷蔵庫が電子レンジより高いと言っているようなものです。それは何も意味しません、なぜならそれぞれ異なることをするからです。"   []
19464461        comment sneakernets     2019-03-22 17:01:10     "科学は非常に確固たるもので、今や死に体の馬を叩いているだけです。<p>しかし、反ワクチン派に対しては、あなたが持っている赤いリンゴが赤いと言っても、相手はそれが緑だと言い張るようなものです。このような人たちと「メリット」を議論することはできません。" [19464582]
19465288        comment derefr  2019-03-22 18:15:21     "私たちは、バックエンド展開＋運用用語の「ウェブサイト」と「ウェブアプリ」の厳密な意味を話していますが、一般的な使用法ではありません。カラムの言葉には、異なる分野で意味が異なる正確な専門用語の意味があります。これが運用担当者が境界線を引くところです：ウェブ<i>サイト</i>は、例えばS3バケットに展開でき、完全に機能しますが、そのために維持しなければならない他の依存関係はありません。<i>ウェブアプリ</i>は、そのような依存関係を設定し維持する必要があるものです—例えば、データベースレイヤーです。<p>それを無視しても、私は「ウェブ」という接頭辞のために、このように定義しています。ウェブアプリは「ウェブ上のアプリ」ではなく、「ウェブによって動かされるアプリ」です。完全オフラインのJavaScript SPAが< i>ウェブ経由で提供されているだけでは、<i>ウェブアプリ</i>ではありません。それは単にブラウザで動作するプログラムに過ぎず、FlashやActiveXやJavaアプレットがブラウザで動作するプログラムです。（Flashゲームは「ウェブゲーム」でしょうか？通常は<i>ブラウザゲーム</i>と見なされますが、それは同じことではありません。）<p>私たちはすでに{Flash, ActiveX, Java}アプレットのための用語を持っています：アプリです。オフラインのJavaScript SPAもアプリです。接頭辞「ウェブ」を追加する必要はありません；ここでは無意味です。その場合、同じプログラムを取り、それをドメインフロンテンドのS3バケットではなくElectronラッパーに押し込んだ場合、それはどんな意味でも「ウェブアプリ」ではありません。そのSPAは単に「ブラウザDOMをグラフィックツールキットとして使用するJavaScriptの<i>アプリ</i>」です。さて、それはElectronラッパーに入れる前からも同じことが言えます。<p>したがって、「ウェブアプリ」は、単に「アプリ」を超えた特定の意味を持ちます。何か追加のものが必要です。その追加のものはバックエンドであり、あなたのブラウザは—アプリのロジックによって駆動され—<i>ウェブを介して</i>相互作用します。これがアプリを「ウェブアプリ」とするものです。（この定義は意図的にサーバー生成の動的HTMLとクライアント生成のJavaScript SPAアプリの両方を含みます。フロントエンドの<i>アプリ</i>は必要ありません；ただ何かと相互作用する<i>ウェブバックエンド</i>が必要です。その「何か」は、リンクをクリックしたり、フォームを送信したりすることによって直接ブラウザであったり、またはAJAXを使用するJavaScriptフロントエンドであったりします。）<p>そのため、「ウェブサイト」は「アプリ」部分を持たない「ウェブアプリ」です。それが上記の定義で「アプリ」が何であるか、そして「ウェブアプリ」が何であるかが明確であれば、1つを他から引いて「ウェブ非アプリ」の定義を導き出すことができます。それがウェブサイトであり：ウェブバックエンドによって動かされていますが、アプリのことは何もしません。「アプリのこと」が基本的に「状態を保存すること」であるならば、「サイト」は「状態を持たないアプリ」です。<p>そして、「ウェブ」がここでバックエンドに関する定義であるため、「ウェブアプリ」と「ウェブサイト」（ウェブ非アプリ）との違いは、バックエンドの状態を保存する能力のプロパティによって定義される可能性があります。したがって、「ウェブサイト」は、バックエンドがアプリのことを何もしない—すなわち、状態を保存しない「ウェブアプリ」です。"       []
19465534        comment bduerst 2019-03-22 18:36:40     "Appleを含む： <a href=""https:&#x2F;&#x2F;www.theguardian.com&#x2F;commentisfree&#x2F;2018&#x2F;mar&#x2F;04&#x2F;apple-users-icloud-services-personal-data-china-cybersecurity-law-privacy"" rel=""nofollow"">https:&#x2F;&#x2F;www.theguardian.com&#x2F;commentisfree&#x2F;2018&#x2F;mar&#x2F;04&#x2F;apple-...</a>"        []
19466269        comment CalChris        2019-03-22 19:55:13     "&gt; 同じA12 CPU ... 3 GBのRAMを持つ<i>システムオンチップ</i><p>実際それは<i>パッケージオンパッケージ</i>です。LPDDR4X DRAMは、A12 Bionicの背面に接着され（実際にはリフローはんだ付けされます）、<p><a href=""https:&#x2F;&#x2F;www.techinsights.com&#x2F;about-techinsights&#x2F;overview&#x2F;blog&#x2F;apple-iphone-xs-teardown&#x2F;"" rel=""nofollow"">https:&#x2F;&#x2F;www.techinsights.com&#x2F;about-techinsights&#x2F;overview&#x2F;blo...</a><p><a href=""https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Package_on_package"" rel=""nofollow"">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Package_on_package</a>"       [19468341]
19466980        comment onetimemanytime 2019-03-22 21:07:25     "&gt;&gt;<i>ここでの狂気は、モーターホームがある土地を取り、その上にスタジオを建てることができないということです。</i><p>リンゴとオレンジ。スタジオを建てるための許可は、その建物を永続的に正当化します。モーターホームは、新しい法律で追い出されるか、既存の法律を施行することによって追い出されるかもしれません。"      []
19467048        comment karambahh       2019-03-22 21:15:41     "あなたはここでリンゴとオレンジを比較していると思います。<p>駐車スペースを別の用途（家族の住居を建てる、または動物シェルターのために）に返還する場合、あなたは車から何かを奪っていない、ただの高価で大きな金属の塊であり、意識を持っていません。<p>次に、あなたは車の所有者から、どこにでも車を駐車するという実用性を奪っていると言うでしょう。私は、この便利さを車の所有者から奪うことに完全にかまいません。これは、人間が屋根の下に住むことを許可するためです。（私は直接の経験から、ほんの数分前に家から1km離れた場所に車を駐車しなければならず、現在都市は住宅を建設しており、近くの駐車スペースが制限されています）<p>次に、ある人たちは「人間が苦しんでいるときに動物を助けることを恥じるべきだ」と主張するかもしれません。それは「私たちはさらなる移民を受け入れることができない、私たちの『自分の』ホームレスを世話しなければならない」という同じ考え方です。<p>これは偽の二項対立です。西洋社会の不平等はますます大きくなっています。私が自分の役割を果たそうとしても、それは微々たるものです。人間や動物のために寄付することは、私たちが住んでいる不平等の山に対する小さな傷です。私たちが集まって行動することで、寄付し、投票し、私たちが住んでいる世界について目を開くことによって、私たちは違いを生み出します...<p>最後に、完全に逸話的な視点です：私は、極端に貧しい人々が動物や人々への連帯を示すためにわざわざ行くのを何度も目にしました。豊かすぎる個人が、ただそこにいるだけで自分たちを困らせる貧しい人々に不平を訴えるのも目にしました。その豊かさは、彼らの先祖が同じ貧しい人々を搾取した結果です。"      [19467512]
```

2. Hacker Newsデータ用のテーブルを作成します：

```sql
CREATE TABLE hackernews (
    id UInt32,
    type String,
    author String,
    timestamp DateTime,
    comment String,
    children Array(UInt32),
    tokens Array(String)
)
ENGINE = MergeTree
ORDER BY toYYYYMMDD(timestamp)
```

3. `author`カラムを小文字に変換したいと思います。これは、[`lower`関数](/sql-reference/functions/string-functions#lower)を使用して簡単に行えます。また、`comment`文字列をトークンに分割して、結果を`tokens`カラムに保存したいと思います。これは[`extractAll`関数](/sql-reference/functions/string-search-functions#extractall)を使用して行えます。これらすべてを1つの`clickhouse-client`コマンドで行います。`comments.tsv`ファイルが`<`演算子を使用して`clickhouse-client`にパイプされていることに注目してください：

```bash
clickhouse-client \
    --host avw5r4qs3y.us-east-2.aws.clickhouse.cloud \
    --secure \
    --port 9440 \
    --password Myp@ssw0rd \
    --query "
    INSERT INTO hackernews
    SELECT
        id,
                type,
                lower(author),
                timestamp,
                comment,
                children,
                extractAll(comment, '\\w+') as tokens
    FROM input('id UInt32, type String, author String, timestamp DateTime, comment String, children Array(UInt32)')
    FORMAT TabSeparatedWithNames
" < comments.tsv
```

:::note
`input`関数は、データを`hackernews`テーブルに挿入するときに変換を可能にするため、ここで便利です。`input`への引数は、到着する生データの形式であり、他の多くのテーブル関数（到着するデータのスキーマを指定するところ）でこれを見ることができます。
:::

4. それで終わりです！データはClickHouseにアップされています：

```sql
SELECT *
FROM hackernews
LIMIT 7
```

結果は次のとおりです：

```response

│  488 │ comment │ mynameishere │ 2007-02-22 14:48:18 │ "残念ながら、ブラウザ内のJavascriptとAjaxは、プログラマにすべての恥ずべき事を強いる厄介なハックです。そして結果は--おかしなhtmlトリックです。Javaは、その欠点を除けば、アプレット環境で実行されるときはかなりクリーンです。 JITBAJAXよりも優れた点を持っていますが、インストールの問題と重たい読み込みプロセスを除いてです。Yahooゲームは、事実上唯一のアプレットの成功物語のようです。もちろん、昔は、非自明なアプレットが人々が持っていたダイアルアップアカウントにはあまりにも大きすぎることがありました。少なくともそれは変わりました。" │ [454927] │ ['それ','は','あまり','良くない','Javascript','が','ブラウザで','あり','Ajax','も','厄介な','ハック','で','プログラマ','を','強いる','恥ず','べき','事','と思','います','こと','の','結果','は','おかしな','html','トリック','です','Java','は','その','欠点','を','除けば','アプレット','環境で','実行される','とき','は','かなり','クリーン','です','それ','は','すでに','優れた','点','を','持って','います','が','インストール','問題','と','重たい','読み込み','プロセス','を','除く','となります','Yahoo','ゲーム','は','唯一の','アプレット','成功物語の','ようです','事実上','もちろん','昔','は','非自明な','アプレットが','人々','が','ダイアル','アップ','アカウント','にはあまりにも','大きすぎる','こと','が','ありました','少なくとも','それは','変わりました'] │
│  575 │ comment │ leoc         │ 2007-02-23 00:09:49 │ "今、参照が見つからなくて残念ですが、私は*思う*ことが、Apolloアプレットのインストールプロセスは「アプリケーションをインストールしますか？」確認ダイアログと30秒程度のダウンロードを伴うでしょう。そうであれば、Apolloは私が期待していたよりも少し期待外れです。そのインストール手法は、デスクトップアプリの標準では低摩擦かもしれませんが、ブラウザベースのAJAXまたはFlashアプリケーションを開始するのと同じような簡単さはありません。（初めてmaps.google.comを使うことの簡単さを考えてみてください。）<p>おそらく、Apolloアプリケーションは、信頼されていない状態でデフォルトで実行され、既にインストールされたアプリは、ダウンロードしたURLをブラウザで訪れるたびに自動的に開始されるでしょうか？" │ [455071] │ ['今','参照','が','見つからなくて','残念','ですが','私','は','思う','こと','が','Apolloアプレット','の','インストール段階','は','アプリケーション','を','インストールしますか','確認ダイアログ','と','30秒','程度の','ダウンロードを伴う','でしょう','そう','であれば','Apollo','は','私が','期待していた','よりも','少し',['期待外れ']となる','その','インストール手法','は','デスクトップ','アプリ','の','標準では','低摩擦かもしれない','が','ブラウザ','ベースの','AJAX','または','Flashアプリケーション','を','始める','のと同じような','簡単さ','は','ありません','初めて','maps.google.com','を','使うことの','簡単さ','を','考えてみてください','おそらく','Apolloアプリケーション','は','信頼','されていない','状態で','デフォルトで','実行','され','既に','インストール','された','アプリは','ダウンロード','した','URL','を','ブラウザて','訪れる','たびに','自動的に','開始','される','でしょう','か','」'] │
│ 3110 │ comment │ davidw       │ 2007-03-09 09:19:58 │ "このtsumobiのことが非常に興味深いです、なぜならそれは基本的にHeclと同じものであるからです（ http://www.hecl.org）。直接的にお金を稼ぐためのアイデアとしては、私はそれをあきらめていたようです、しかし、アプリケーションをより早く開発できるという利点があると考えました。たとえば、私はそれでShopList（ http://shoplist.dedasys.com）を数分でプロトタイプ化できました。<p>編集：ところで、私はTsumobiの人々とおしゃべりすることに確かに興味があります。それは良いアイデアです—おそらくHeclから再利用される要素がいくつかあり、非常に自由なライセンスの下でオープンソースとして開発されているため、「商業」アプリに含めることができる意味があります。<p>そのような空間での「共通の」ビットは、自由かオープンソースで成り立たなければならないと思います（ブラウザ、HTML、JavaScript、Javaアプレットなどを考えれば、それはお金がどこにあるのかということではありません）。" │ [3147]   │ ['この','tsumobi','の','こと','が','非常に','興味深い','です','なぜなら','それは','基本的に','Hecl','と','同じ','ものであるからです','http','www','hecl','org','私は','それを','あきらめていた','ようです','直接的に','お金を稼ぐ','ための','アイデア','としては','ただ','優位性は','アプリケーションを','より','早く','開発できること','だ','と','思いました','私は','それで','ShopList','http','shoplist','dedasys','com','を','数分','で','プロトタイプ化できました','編集','ところで','私は','Tsumobi','の','人々','と','おしゃべりすることに','確かに','興味があります','それは','良い','アイデアです','おそらく','Heclから','再利用','される','要素','が','いくつかあり','非常に','自由な','ライセンスの下で','オープンソースとして','開発されているため','商業','アプリに','含めることができる','ことを意味します','そのような空間での','共通の','ビットは','自由か','オープンソースで','成り立たなければならない','んじゃないか','と思います','ブラウザ','HTML','JavaScript','Javaアプレット','などを','考えれば','それは','お金が','どこに','あるのか','ということではありません'] │
│ 4016 │ comment │ mynameishere │ 2007-03-13 22:56:53 │ "http://www.tigerdirect.com/applications/SearchTools/item-details.asp?EdpNo=2853515&CatId=2511<p>と<p>http://store.apple.com/1-800-MY-APPLE/WebObjects/AppleStore?family=MacBookPro<p>これらは比較可能なシステムですが、Appleは、私が言ったように、大体800ドルのプレミアムがあります。実際には、最も安いmacbook proは高級Toshibaと同じ価格です。もしあなたが良いお金を稼ぐなら、それは大したことではありません。しかし、カフェで女の子が最低賃金に合ったコンピュータを提案してくると、私は基本的にAppleを推奨するのは屑のような存在です。" │ []       │ ['http','www','tigerdirect','com','applications','SearchTools','item','details','asp','EdpNo','2853515','CatId','2511','と','http','store','apple','com','1','800','MY','APPLE','WebObjects','AppleStore','family','MacBookPro','これら','は','比較可能','な','システムですが','Apple','は','私が','言った','ように','大体','800ドル','の','プレミアム','があります','実際には','最も','安い','macbook','pro','は','高級Toshiba','と','同じ價値','です','もしあなたが','良い','お金を','稼ぐなら','それは大したことではありません','しかし','カフェで','女の子が','最低賃金に','合った','コンピュータを','提案してくる日','に','私は基本的に','Appleを','推奨するのは','屑の','ような','存在です'] │
│ 4568 │ comment │ jwecker      │ 2007-03-16 13:08:04 │ "気持ちがわかります。この感触は、まだ人々がjavaアプレットを作っていた頃の気持ちです。でも、普通のユーザーはそれを感じないかもしれない-ブラウザの間に大きなレイヤーが動いているというすりこまれたプログラマであれば。 " │ []       │ ['気持ち','わかる','私は','感じん','この','感触は','確かに','わかる','人々','が','まだ','javaアプレットを','作っていた頃の','気持ちです','でも','普通','の','ユーザー','は','それを','感じないかもしれない','ブラウザの','間に','大きな','レイヤー','が','動いている','という','ではなく','その','プログラマ','であれば'] │
│ 4900 │ comment │ lupin_sansei │ 2007-03-19 00:26:30 │ "Ajaxの本質は、Javascriptがサーバーと通信することができることです。そのため、ページを再読み込みせずに。XmlHttpRequestが最も便利ですが、XmlHttpRequestの前に、1ピクセルの画像を読み込んで画像のクッキーにデータを送り込む方法や、XMLまたはjavasciptデータを含む小さなフレームを使用してサーバーのデータを読み込む方法、さらにJavascriptの代わりにデータを取得するためにjavaアプレットを使用するなど、他にもいくつかの方法がありました。" │ []       │ ['Ajax','の','本質は','Javascript','が','サーバーと','通信すること','すべての','ページを','再読み込みせずに','XmlHttpRequest','が','最も','便利','ですが','XmlHttpRequestの','前に','1ピクセル','の','画像を','読み込んで','画像の','クッキーに','データを送り込む手法','など','を','考え','れば','これら','は','方法','でして','その後','Javascript']['の','代わりに','データを取得するために','java','applets','など','を','考え','た方が良い場合','だと思います。'] │
│ 5102 │ comment │ staunch      │ 2007-03-20 02:42:47 │ "さて、これは本当に明らかなことではありません。あなたが裕福になると、あなたが生きていかなくてはならない新しい一群のルールが存在するようです。ここでみんながそれが恥ずかしいことだと思っているのは残念です。これは少しの悪いリンゴが嫉妬をコントロールできるせいでみんな自分で再学習しなければならないことです。<p>あなたのエッセイのキューの中にそれが存在するのを聞いてとてもうれしいです。私があなたがそれを書こうとする前に裕福にならないようにしますので、何を期待すべきかのアイデアがあります:-)" │ []       │ ['さて','これは','本当に','明らかな','ことでは','ない','あなた','が','裕福','に','なると','新しい','一群の','ルール','が','存在する','ようです','ここ'] │

```

5. 別のオプションとして、`cat`のようなツールを使用してファイルを`clickhouse-client`にストリーミングにすることができます。たとえば、次のコマンドは、`<`演算子を使用するのと同じ結果を持ちます：

```bash
cat comments.tsv | clickhouse-client \
    --host avw5r4qs3y.us-east-2.aws.clickhouse.cloud \
    --secure \
    --port 9440 \
    --password Myp@ssw0rd \
    --query "
    INSERT INTO hackernews
    SELECT
        id,
                type,
                lower(author),
                timestamp,
                comment,
                children,
                extractAll(comment, '\\w+') as tokens
    FROM input('id UInt32, type String, author String, timestamp DateTime, comment String, children Array(UInt32)')
    FORMAT TabSeparatedWithNames
"
```

[clickhouse-client](/interfaces/cli)に関する詳細は、あなたのローカルオペレーティングシステムに`clickhouse-client`をインストールする方法に関するドキュメントページを訪問してください。

## 関連コンテンツ {#related-content}

- ブログ: [ClickHouseへのデータの取り込み - パート1](https://clickhouse.com/blog/getting-data-into-clickhouse-part-1)
- ブログ: [大規模な実世界のデータセットを探索する：ClickHouseにおける100年以上の気象記録](https://clickhouse.com/blog/real-world-data-noaa-climate-data)
