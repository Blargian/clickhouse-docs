---
slug: /faq/use-cases/key-value
title: 'ClickHouseをキー-バリューストレージとして使用できますか？'
toc_hidden: true
toc_priority: 101
description: 'ClickHouseがキー-バリューストレージとして使用できるかについてのよくある質問に答えます。'
---


# ClickHouseをキー-バリューストレージとして使用できますか？ {#can-i-use-clickhouse-as-a-key-value-storage}

短い回答は**「いいえ」**です。キー-バリューワークロードは、ClickHouseを使用すべきでないケースのリストの中で上位に位置しています。結局のところ、ClickHouseは[OLAP](../../faq/general/olap.md)システムであり、優れたキー-バリューストレージシステムは多く存在しています。

しかし、キー-バリューに似たクエリのためにClickHouseを使用することが理にかなう状況もあるかもしれません。通常は、主要なワークロードが分析的性質を持ち、ClickHouseに適している低コスト製品であり、副次的なプロセスがキー-バリューのパターンを必要とする場合です。この際には、要求スループットがそれほど高くなく、厳しいレイテンシ要件がないことが前提です。無制限の予算があれば、この副次的なワークロードのために別のキー-バリューデータベースを導入していたでしょうが、実際には、もう1つのストレージシステムの維持（監視、バックアップなど）には追加のコストがかかるため、これを避けたい場合があります。

推奨事項に反してClickHouseに対してキー-バリューに似たクエリを実行することを決定した場合、以下のヒントを参考にしてください：

- ClickHouseにおけるポイントクエリが高コストである主な理由は、主な[MergeTreeテーブルエンジンファミリー](../..//engines/table-engines/mergetree-family/mergetree.md)のスパース主キーインデックスです。このインデックスは特定の行のデータを指し示すことができず、代わりに各N番目の行を指し、システムは隣接するN番目の行から目的の行にスキャンしながら、過剰なデータを読み込む必要があります。キー-バリューシナリオでは、`index_granularity`設定を使用してNの値を減少させることが有用かもしれません。
- ClickHouseは各カラムを別々のファイルセットに保持しているため、完全な行を構成するにはこれらのファイルをすべて通過する必要があります。カラムの数は線形に増加するため、キー-バリューシナリオでは、多くのカラムを使用するのを避け、すべてのペイロードをJSON、Protobuf、または意味のある他のシリアライズ形式でエンコードされた単一の`String`カラムに配置することが推奨されます。
- 代替のアプローチとして、通常の`MergeTree`テーブルの代わりに[Join](../../engines/table-engines/special/join.md)テーブルエンジンを使用し、データを取得するために[joinGet](../../sql-reference/functions/other-functions.md#joinget)関数を使用する方法があります。これによりクエリパフォーマンスが向上する可能性がありますが、使いやすさや信頼性の問題が発生する可能性があります。こちらに[使用例](https://github.com/ClickHouse/ClickHouse/blob/master/tests/queries/0_stateless/00800_versatile_storage_join.sql#L49-L51)があります。
