description: 'ClickHouse のサードパーティ使用法とサードパーティライブラリの追加および維持方法についてのページ。'
sidebar_label: 'サードパーティライブラリ'
sidebar_position: 60
slug: /development/contrib
title: 'サードパーティライブラリ'
```


# サードパーティライブラリ

ClickHouse は、他のデータベースに接続するため、ディスクからのロード/セーブ時にデータをデコード/エンコードするため、または特定の専門的な SQL 関数を実装するために、さまざまな目的でサードパーティライブラリを利用しています。ターゲットシステムで利用可能なライブラリに依存しないようにするため、各サードパーティライブラリは ClickHouse のソースツリーに Git サブモジュールとしてインポートされ、ClickHouse と共にコンパイルおよびリンクされます。サードパーティライブラリとそのライセンスの一覧は、次のクエリによって取得できます:

```sql
SELECT library_name, license_type, license_path FROM system.licenses ORDER BY library_name COLLATE 'en';
```

リストにあるライブラリは、ClickHouse リポジトリの `contrib/` ディレクトリにあるものです。ビルドオプションに応じて、一部のライブラリはコンパイルされていない可能性があり、その結果、実行時にその機能が利用できない場合があります。

[例](https://sql.clickhouse.com?query_id=478GCPU7LRTSZJBNY3EJT3)

## サードパーティライブラリの追加と維持 {#adding-and-maintaining-third-party-libraries}

各サードパーティライブラリは、ClickHouse リポジトリの `contrib/` ディレクトリ内の専用ディレクトリに存在する必要があります。ライブラリディレクトリに外部コードのコピーをダンプするのは避けてください。代わりに、外部のアップストリームリポジトリからサードパーティコードを引き込むために Git サブモジュールを作成してください。

ClickHouse が使用するすべてのサブモジュールは、`.gitmodule` ファイルにリストされています。
- ライブラリがそのまま使用できる場合（デフォルトケース）、アップストリームリポジトリを直接参照できます。
- ライブラリにパッチを適用する必要がある場合は、[ClickHouse 組織の GitHub](https://github.com/ClickHouse) にアップストリームリポジトリのフォークを作成します。

後者の場合、カスタムパッチをアップストリームのコミットからできるだけ隔離することを目指します。そのため、統合したいブランチまたはタグから `ClickHouse/` プレフィックスを持つブランチを作成します。例えば、ブランチ `2024_2` の場合は `ClickHouse/2024_2`、タグ `release/vX.Y.Z` の場合は `ClickHouse/release/vX.Y.Z` です。アップストリームの開発ブランチ `master` / `main` / `dev`（すなわち、フォークリポジトリ内のブランチ `ClickHouse/master` / `ClickHouse/main` / `ClickHouse/dev`）を避けてください。このようなブランチは移動ターゲットであり、適切なバージョニングを困難にします。「プレフィックスブランチ」は、フォーク内のカスタム `ClickHouse/` ブランチがアップストリームリポジトリからのプルによって影響を受けずに済むことを保証します。`contrib/` 内のサブモジュールは、フォークされたサードパーティリポジトリの `ClickHouse/` ブランチのみを追跡しなければなりません。

パッチは、外部ライブラリの `ClickHouse/` ブランチにのみ適用されます。

これを行う方法は2つあります：
- 例えばサニタイザの修正など、フォークされたリポジトリの `ClickHouse/` プレフィックスブランチに対して新しい修正を行いたい場合、その修正を `ClickHouse/` プレフィックスを持つブランチとしてプッシュします。例えば `ClickHouse/fix-sanitizer-disaster` です。次に、新しいブランチからカスタムトラッキングブランチに対する PR を作成します。例えば `ClickHouse/2024_2 <-- ClickHouse/fix-sanitizer-disaster` です。そして PR をマージします。
- サブモジュールを更新し、以前のパッチを再適用する必要がある場合、古い PR を再作成するのは過剰です。その代わりに、単に古いコミットを新しい `ClickHouse/` ブランチ（新しいバージョンに対応）にチェリーピックします。複数のコミットを持つ PR のコミットをスクワッシュしても構いません。最良のケースでは、カスタムパッチをアップストリームに戻すことができ、新しいバージョンではパッチを省略できます。

サブモジュールが更新されたら、フォーク内の新しいハッシュを指すように ClickHouse でサブモジュールを更新してください。

サードパーティライブラリのパッチは、公式リポジトリを考慮に入れて作成し、そのパッチをアップストリームリポジトリに寄付することを検討してください。これにより、他の人もパッチの恩恵を受け、ClickHouse チームの維持負担が軽減されます。

