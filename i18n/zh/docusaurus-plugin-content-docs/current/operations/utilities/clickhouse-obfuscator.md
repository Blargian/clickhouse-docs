---
'description': 'Clickhouse Obfuscator 的文档'
'slug': '/operations/utilities/clickhouse-obfuscator'
'title': 'clickhouse-obfuscator'
---

一个用于表数据混淆的简单工具。

它读取一个输入表并生成一个输出表，保留输入的一些属性，但包含不同的数据。
它允许发布几乎真实的生产数据用于基准测试。

它设计用来保留数据的以下属性：
- 每列和每组列的值的基数（不同值的数量）；
- 条件基数：在一个列的值条件下另一个列的不同值数量；
- 整数绝对值的概率分布；有符号整数的符号；浮点数的指数和符号；
- 字符串长度的概率分布；
- 数字的零值概率；空字符串和数组，`NULL`s；

- 使用 LZ77 和熵类编码器压缩时的数据压缩比；
- 表中时间值的连续性（差异幅度）；浮点值的连续性；
- `DateTime` 值的日期组件；

- 字符串值的 UTF-8 有效性；
- 字符串值看起来自然。

上述大多数属性都适合性能测试：

读取数据、过滤、聚合和排序的速度几乎与原始数据相同，因为基数、差异幅度、压缩比等得到了保存。

它以确定性的方式工作：您定义一个种子值，转换由输入数据和种子决定。
某些转换是一对一的，可以逆转，因此您需要一个大的种子并将其保密。

它使用一些密码学原语来转换数据，但从密码学的角度来看，它没有正确执行，因此您不应视结果为安全，除非您有其他理由。结果可能保留一些您不想发布的数据。

它总是将 0、1、-1 数字、日期、数组的长度和 null 标志完全保留为源数据中的样子。
例如，您有一个名为 `IsMobile` 的列，值为 0 和 1。在转换后的数据中，它将有相同的值。

因此，用户将能够准确计算移动流量的比例。

再给一个例子。当您在表中有一些私密数据，例如用户电子邮件，而您不想发布任何单个电子邮件地址。
如果您的表足够大，并且包含多个不同的电子邮件，且没有电子邮件的频率非常高于其他电子邮件，那么它将对所有数据进行匿名化。但是如果您在某列中只有少量不同的值，它可能会重复其中的一些。
您应该查看此工具的工作算法，并微调其命令行参数。

此工具仅在数据量适中时（至少 1000 行）运行良好。
