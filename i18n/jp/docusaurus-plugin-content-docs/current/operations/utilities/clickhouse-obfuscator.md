---
description: 'Clickhouse Obfuscatorのドキュメント'
slug: /operations/utilities/clickhouse-obfuscator
title: 'clickhouse-obfuscator'
---

テーブルデータの秘匿化のためのシンプルなツールです。

入力テーブルを読み込み、いくつかの特性を保持しながら異なるデータを含む出力テーブルを生成します。
これにより、ベンチマークで使用するためにほぼ本物のプロダクションデータを公開することができます。

データの以下の特性を保持するように設計されています：
- 各カラムおよびカラムのタプルごとの値のカーディナリティ（異なる値の数）;
- 条件付きカーディナリティ：別のカラムの値に基づくあるカラムの異なる値の数;
- 整数の絶対値の確率分布；符号付き整数の符号；浮動小数点数の指数と符号;
- 文字列の長さの確率分布;
- 数値のゼロ値の確率；空文字列および配列、`NULL`値;

- LZ77とエントロピー系のコーデックで圧縮した際のデータ圧縮比;
- テーブル全体の時刻値の連続性（差の大きさ）；浮動小数点数の連続性;
- `DateTime`値の日時コンポーネント;

- 文字列値のUTF-8有効性;
- 文字列値が自然に見える。

上記の特性のほとんどはパフォーマンステストに対して有効です：

データの読み込み、フィルタリング、集計、並べ替えは、保存されたカーディナリティ、差の大きさ、圧縮比などのおかげで、オリジナルデータとほぼ同じ速度で動作します。

このツールは決定論的に動作します：シード値を定義すると、変換は入力データとシードによって決まります。
一部の変換は一対一であり、逆にすることができますので、大きなシードを保持し、それを秘密にする必要があります。

データを変換するためにいくつかの暗号的なプリミティブを使用しますが、暗号的な観点から正しく行われていないため、安全な結果と見なすべきではありません。他の理由がない限り、結果には公開したくないデータが含まれる可能性があります。

常に0、1、-1の数値、日付、配列の長さ、およびnullフラグをソースデータとまったく同じに保ちます。
たとえば、テーブルに値が0と1の`IsMobile`カラムがある場合、変換されたデータでも同じ値になります。

したがって、ユーザーはモバイルトラフィックの正確な比率をカウントできます。

もう一つの例を挙げます。テーブルにユーザーのメールアドレスのようなプライベートデータがあり、そのメールアドレスを単独で公開したくない場合。
テーブルが十分に大きく、異なるメールアドレスが複数含まれ、特定のメールが他のメールよりも非常に高い頻度を持っていない場合、すべてのデータを匿名化します。しかし、カラムに異なる値が少ない場合は、そのいくつかを再現することができます。
このツールの作業アルゴリズムを確認し、コマンドラインパラメータを微調整する必要があります。

このツールは、少なくとも中程度のデータ量（最低でも1000行以上）で正常に動作します。
