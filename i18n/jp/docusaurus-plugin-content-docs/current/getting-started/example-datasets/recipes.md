---
'description': 'The RecipeNLG dataset, containing 2.2 million recipes'
'sidebar_label': 'Recipes Dataset'
'slug': '/getting-started/example-datasets/recipes'
'title': 'Recipes Dataset'
---



The RecipeNLG dataset is available for download [here](https://recipenlg.cs.put.poznan.pl/dataset). It contains 2.2 million recipes. The size is slightly less than 1 GB.
## Download and Unpack the Dataset {#download-and-unpack-the-dataset}

1. ダウンロードページに移動します [https://recipenlg.cs.put.poznan.pl/dataset](https://recipenlg.cs.put.poznan.pl/dataset).
2. 利用規約に同意し、zipファイルをダウンロードします。
3. オプション: `md5sum dataset.zip` を使用してzipファイルを検証します。値は `3a168dfd0912bb034225619b3586ce76` と等しいはずです。
4. `unzip dataset.zip` を使用してzipファイルを解凍します。`dataset` ディレクトリ内に `full_dataset.csv` ファイルが生成されます。
## Create a Table {#create-a-table}

clickhouse-client を実行し、次のCREATEクエリを実行します:

```sql
CREATE TABLE recipes
(
    title String,
    ingredients Array(String),
    directions Array(String),
    link String,
    source LowCardinality(String),
    NER Array(String)
) ENGINE = MergeTree ORDER BY title;
```
## Insert the Data {#insert-the-data}

次のコマンドを実行します:

```bash
clickhouse-client --query "
    INSERT INTO recipes
    SELECT
        title,
        JSONExtract(ingredients, 'Array(String)'),
        JSONExtract(directions, 'Array(String)'),
        link,
        source,
        JSONExtract(NER, 'Array(String)')
    FROM input('num UInt32, title String, ingredients String, directions String, link String, source LowCardinality(String), NER String')
    FORMAT CSVWithNames
" --input_format_with_names_use_header 0 --format_csv_allow_single_quote 0 --input_format_allow_errors_num 10 < full_dataset.csv
```

これはカスタムCSVを解析する方法の例であり、複数の調整を必要とします。

説明:
- データセットはCSV形式ですが、挿入時にいくつかの前処理が必要です。私たちはテーブル関数 [input](../../sql-reference/table-functions/input.md) を使用して前処理を実行します;
- CSVファイルの構造はテーブル関数 `input` の引数で指定されます;
- フィールド `num`（行番号）は不要です - 私たちはファイルから解析して無視します;
- `FORMAT CSVWithNames` を使用しますが、CSVのヘッダーは無視されます（コマンドラインパラメーター `--input_format_with_names_use_header 0` によって）、ヘッダーは最初のフィールドの名前を含んでいないためです;
- ファイルはCSV文字列を囲むためにダブルクオートのみを使用しています。一部の文字列はダブルクオートで囲まれていないため、単一引用符を文字列の囲みとして解析してはいけません - そのため、`--format_csv_allow_single_quote 0` パラメーターも追加しています;
- CSVからの一部の文字列は解析できません。なぜなら、それらは値の先頭に `\M/` シーケンスを含んでいるからです; CSV内でバックスラッシュで始まる唯一の値は `\N` であり、これはSQL NULLとして解析されます。`--input_format_allow_errors_num 10` パラメーターを追加し、最大10件の不正なレコードをスキップできます;
- 材料、手順、NERフィールドに配列があります; これらの配列は通常とは異なる形式で表現されています: JSONとして文字列にシリアライズされ、その後CSVに配置されます - これをStringとして解析し、次に [JSONExtract](../../sql-reference/functions/json-functions.md) 関数を使用してArrayに変換します。
## Validate the Inserted Data {#validate-the-inserted-data}

行数を確認することで検証します:

クエリ:

```sql
SELECT count() FROM recipes;
```

結果:

```text
┌─count()─┐
│ 2231142 │
└─────────┘
```
## Example Queries {#example-queries}
### Top Components by the Number of Recipes: {#top-components-by-the-number-of-recipes}

この例では、[arrayJoin](../../sql-reference/functions/array-join.md) 関数を使用して配列を行セットに展開する方法を学びます。

クエリ:

```sql
SELECT
    arrayJoin(NER) AS k,
    count() AS c
FROM recipes
GROUP BY k
ORDER BY c DESC
LIMIT 50
```

結果:

```text
┌─k────────────────────┬──────c─┐
│ salt                 │ 890741 │
│ sugar                │ 620027 │
│ butter               │ 493823 │
│ flour                │ 466110 │
│ eggs                 │ 401276 │
│ onion                │ 372469 │
│ garlic               │ 358364 │
│ milk                 │ 346769 │
│ water                │ 326092 │
│ vanilla              │ 270381 │
│ olive oil            │ 197877 │
│ pepper               │ 179305 │
│ brown sugar          │ 174447 │
│ tomatoes             │ 163933 │
│ egg                  │ 160507 │
│ baking powder        │ 148277 │
│ lemon juice          │ 146414 │
│ Salt                 │ 122558 │
│ cinnamon             │ 117927 │
│ sour cream           │ 116682 │
│ cream cheese         │ 114423 │
│ margarine            │ 112742 │
│ celery               │ 112676 │
│ baking soda          │ 110690 │
│ parsley              │ 102151 │
│ chicken              │ 101505 │
│ onions               │  98903 │
│ vegetable oil        │  91395 │
│ oil                  │  85600 │
│ mayonnaise           │  84822 │
│ pecans               │  79741 │
│ nuts                 │  78471 │
│ potatoes             │  75820 │
│ carrots              │  75458 │
│ pineapple            │  74345 │
│ soy sauce            │  70355 │
│ black pepper         │  69064 │
│ thyme                │  68429 │
│ mustard              │  65948 │
│ chicken broth        │  65112 │
│ bacon                │  64956 │
│ honey                │  64626 │
│ oregano              │  64077 │
│ ground beef          │  64068 │
│ unsalted butter      │  63848 │
│ mushrooms            │  61465 │
│ Worcestershire sauce │  59328 │
│ cornstarch           │  58476 │
│ green pepper         │  58388 │
│ Cheddar cheese       │  58354 │
└──────────────────────┴────────┘

50 rows in set. Elapsed: 0.112 sec. Processed 2.23 million rows, 361.57 MB (19.99 million rows/s., 3.24 GB/s.)
```
### いちごを使った最も複雑なレシピ {#the-most-complex-recipes-with-strawberry}

```sql
SELECT
    title,
    length(NER),
    length(directions)
FROM recipes
WHERE has(NER, 'strawberry')
ORDER BY length(directions) DESC
LIMIT 10
```

結果:

```text
┌─title────────────────────────────────────────────────────────────┬─length(NER)─┬─length(directions)─┐
│ チョコレート・ストロベリー・オレンジ ウェディングケーキ                        │          24 │                126 │
│ ストロベリークリームチーズクランブルタルト                               │          19 │                 47 │
│ シャルロットスタイルのアイスクリーム                                    │          11 │                 45 │
│ 罪深いほど美味しいミリオンレイヤーチョコレートレイヤーケーキ、ストロベリーを添えて │          31 │                 45 │
│ エルダーフラワーシャーベットを添えた甘いベリー                          │          24 │                 44 │
│ チョコレートストロベリームースケーキ                                      │          15 │                 42 │
│ ルバーブシャルロット、ストロベリーとラム添え                             │          20 │                 42 │
│ シェフジョーのストロベリーバニラタルト                                   │           7 │                 37 │
│ オールドファッションアイスクリームサンデーケーキ                       │          17 │                 37 │
│ スイカケーキ                                                           │          16 │                 36 │
└──────────────────────────────────────────────────────────────────┴─────────────┴────────────────────┘

10行のセットです。経過時間: 0.215秒。処理した行数: 223万行、サイズ: 1.48 GB (10.35百万行/秒、6.86 GB/秒)
```

この例では、[has](../../sql-reference/functions/array-functions.md#hasarr-elem) 関数を使用して、配列要素でフィルタリングし、指示の数でソートします。

126のステップが必要なウェディングケーキがあります！その指示を表示します：

クエリ:

```sql
SELECT arrayJoin(directions)
FROM recipes
WHERE title = 'Chocolate-Strawberry-Orange Wedding Cake'
```

結果:

```text
┌─arrayJoin(directions)───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ オーブンの中央に1つ、下部の1/3に1つのラックを配置し、350Fに予熱する。                                                                                     │
│ 直径5インチ、高さ2インチのケーキ型1つ、直径8インチ、高さ2インチのケーキ型1つ、直径12インチ、高さ2インチのケーキ型1つにバターを塗る。                            │
│ 型に小麦粉を振り入れ、底にクッキングシートを敷く。                                                                                                            │
│ 1/3カップのオレンジジュースと2オンスの無糖チョコレートを重めの小鍋に入れる。                                                                                                                 │
│ 中火から弱火でチョコレートが溶けるまで混ぜる。                                                                                                                    │
│ 火から下ろす。                                                                                                                                                           │
│ 1 2/3カップのオレンジジュースを少しずつ加える。                                                                                                                             │
│ 3カップの小麦粉、2/3カップのココア、2 teaspoonsの重曹、1 teaspoonの塩、1/2 teaspoonのベーキングパウダーを中ボウルにふるい入れる。                                                 │
│ 電動ミキサーを使用して、大きなボウルで1カップ(2本)のバターと3カップの砂糖を混ぜる（混合物はざらついて見える）。                                                 │
│ 卵4個を1個ずつ加え、各卵を混ぜる。                                                                                                                        │
│ 1 tablespoonのオレンジの皮と1 tablespoonのバニラエッセンスを加える。                                                                                                          │
│ 乾燥材料をオレンジジュースの混合物と交互に3回に分けて加え、各回後によく混ぜる。                                                            │
│ 1カップのチョコレートチップを加える。                                                                                                                                               │
│ 準備した5インチの型には1カップと2 tablespoonsの生地、8インチの型には3カップの生地、12インチの型には残りの生地を（約6カップ）加える。                   │
│ 5インチと8インチの型をオーブンの中央のラックに置く。                                                                                                                        │
│ 12インチの型はオーブンの下段に置く。                                                                                                                                    │
│ ケーキが中心に差し込んだテスターがきれいに出てくるまで約35分焼く。                                                                                             │
│ 型からケーキをラックに移し、完全に冷やす。                                                                                                                        │
│ 6インチの段ボールケーキの中央に直径4インチの円をマークする。                                                                                                        │
│ マークした円を切り抜く。                                                                                                                                                      │
│ 8インチの段ボールケーキの中央に直径7インチの円をマークする。                                                                                                        │
│ マークした円を切り抜く。                                                                                                                                                      │
│ 12インチの段ボールケーキの中央に直径11インチの円をマークする。                                                                                                      │
│ マークした円を切り抜く。                                                                                                                                                      │
│ 5インチケーキの側面を切り離す。                                                                                                                                  │
│ 4インチの段ボールを型の上に置く。                                                                                                                                            │
│ 段ボールと型を一緒に持ち、ケーキを段ボールの上にひっくり返す。                                                                                                              │
│ クッキングシートを剥がす。ケーキを段ボールごとアルミホイルで包む。                                                                                                            │
│ 上記の手順を繰り返し、8インチケーキには7インチの段ボール、12インチケーキには11インチの段ボールを使用してひっくり返し、クッキングシートを剥がしてアルミホイルで包む。                        │
│ 残りの材料を使って、さらに1バッチのケーキ生地を作り、上記の手順で3つのケーキ層を焼く。                                                               │
│ 型でケーキを冷やす。                                                                                                                                                         │
│ 型のケーキをしっかりとアルミホイルで覆う。                                                                                                                                      │
│ （事前に準備できる。                                                                                                                                                     │
│ 室温で最大1日放置するか、すべてのケーキ層を二重に包んで最大1週間冷凍する。                                                                           │
│ 使用する前にケーキ層を室温に戻します。）                                                                                                                        │
│ 最初の12インチのケーキをそのダンボールの上に作業台に置く。                                                                                              │
│ 2 3/4カップのガナッシュをケーキの上に均等に広げ、端まで伸ばす。                                                                                                         │
│ 2/3カップのジャムをガナッシュの上に広げ、端に1/2インチのチョコレートの縁を残す。                                                                                                 │
│ 1 3/4カップのホワイトチョコレートフロスティングをジャムの上にスプーンで落とす。                                                                                                             │
│ フロスティングをジャムの上に優しく広げ、端に1/2インチのチョコレートの縁を残す。                                                                                                 │
│ 2番目の12インチダンボールの上に少しココアパウダーをふる。                                                                                                                        │
│ 2番目の12インチケーキの側面を切り離す。                                                                                                                          │
│ ダンボールの上にココア側を下にして置く。                                                                                                                                 │
│ ケーキをダンボールの上にひっくり返す。                                                                                                                                               │
│ クッキングシートを剥がす。                                                                                                                                                     │
│ ケーキをダンボールから丁寧に滑らせ、最初の12インチケーキのフィリングの上に置く。                                                                                                  │
│ 冷蔵する。                                                                                                                                                                │
│ 最初の8インチケーキをその段ボールの上に作業台に置く。                                                                                                                   │
│ 1カップのガナッシュをケーキの上に端まで広げる。                                                                                                                          │
│ 1/4カップのジャムを広げ、端に1/2インチのチョコレートの縁を残す。                                                                                                         │
│ 1カップのホワイトチョコレートのフロスティングをジャムの上にスプーンで落とす。                                                                                                                  │
│ フロスティングをジャムの上に優しく広げ、端に1/2インチのチョコレートの縁を残す。                                                                                                 │
│ 2番目の8インチダンボールの上に少しココアをふる。                                                                                                                                │
│ 2番目の8インチケーキの側面を切り離す。                                                                                                                           │
│ ダンボールの上にココア側を下にして置く。                                                                                                                                 │
│ ケーキをダンボールの上にひっくり返す。                                                                                                                                               │
│ クッキングシートを剥がす。                                                                                                                                                     │
│ ケーキをダンボールから滑らせて、最初の8インチケーキのフィリングの上に置く。                                                                                                             │
│ 冷蔵する。                                                                                                                                                                │
│ 最初の5インチケーキをその段ボールの上に作業台に置く。                                                                                                                   │
│ ケーキの上に1/2カップのガナッシュを端まで広げる。                                                                                                            │
│ 2 tablespoonsのジャムを広げ、端に1/2インチのチョコレートの縁を残す。                                                                                                   │
│ 1/3カップのホワイトチョコレートフロスティングをジャムの上にスプーンで落とす。                                                                                                                │
│ フロスティングをジャムの上に優しく広げ、端に1/2インチのチョコレートの縁を残す。                                                                                                 │
│ ココアを2番目の6インチダンボールの上にふる。                                                                                                                                     │
│ 2番目の5インチケーキの側面を切り離す。                                                                                                                           │
│ ダンボールの上にココア側を下にして置く。                                                                                                                                 │
│ ケーキをダンボールの上にひっくり返す。                                                                                                                                               │
│ クッキングシートを剥がす。                                                                                                                                                     │
│ ケーキをダンボールから滑らせて、最初の5インチケーキのフィリングの上に置く。                                                                                                             │
│ すべてのケーキを1時間冷やしてフィリングを固める。                                                                                                                                      │
│ 12インチの多層ケーキをそのダンボールの上に回転するケーキスタンドに置く。                                                                                                         │
│ 2 2/3カップのフロスティングをケーキの上と側面に第一コートとして広げる。                                                                                                      │
│ ケーキを冷蔵する。                                                                                                                                                           │
│ 8インチの多層ケーキをそのダンボールの上にケーキスタンドに置く。                                                                                                                    │
│ 1 1/4カップのフロスティングをケーキの上と側面に第一コートとして広げる。                                                                                                      │
│ ケーキを冷蔵する。                                                                                                                                                           │
│ 5インチの多層ケーキをその段ボールの上にケーキスタンドに置く。                                                                                                                    │
│ 3/4カップのフロスティングをケーキの上と側面に第一コートとして広げる。                                                                                                         │
│ すべてのケーキがフロスティングの最初のコートが固まるまで、約1時間冷蔵する。                                                                                                      │
│ （ケーキはこの時点まで最大1日前に作成できます。カバーして冷蔵庫に保管してください。）                                                                                            │
│ フロスティングの2回目のバッチを準備し、残りのフロスティング材料を使用して最初のバッチの指示に従う。                                                            │
│ 小さな星の先端のついた絞り袋に2カップのフロスティングを入れる。                                                                                                           │
│ 12インチケーキをその段ボールの上に大きな平皿に置く。                                                                                                                  │
│ 平皿をケーキスタンドの上に置く。                                                                                                                                                │
│ アイススパチュラを使用して、ケーキの上と側面に2 1/2カップのフロスティングを広げ、上を平滑にする。                                                                                     │
│ 絞り袋を使ってケーキの上のエッジの周りに装飾的なボーダーを絞り出す。                                                                                                    │
│ ケーキを皿の上で冷蔵する。                                                                                                                                                │
│ 8インチケーキをその段ボールの上にケーキスタンドに置く。                                                                                                                           │
│ アイススパチュラを使用して、ケーキの上と側面に1 1/2カップのフロスティングを広げ、上を平滑にする。                                                                                     │
│ 絞り袋を使用してケーキの上のエッジの周りに装飾的なボーダーを絞り出す。                                                                                                           │
│ ケーキをその段ボールの上で冷蔵する。                                                                                                                                          │
│ 5インチケーキをその段ボールの上にケーキスタンドに置く。                                                                                                                           │
│ アイススパチュラを使用して、ケーキの上と側面に3/4カップのフロスティングを広げ、上を平滑にする。                                                                                        │
│ 絞り袋を使用してケーキの上のエッジの周りに装飾的なボーダーを絞り出し、必要に応じて袋にフロスティングを追加する。                                                             │
│ ケーキをその段ボールの上で冷蔵する。                                                                                                                                          │
│ フロスティングが固まるまで、すべてのケーキを冷蔵しておく。約2時間。                                                                                                             │
│ （最大2日前に準備できます。                                                                                                                                              │
│ ゆるくカバーし、冷蔵庫で保管してください。）                                                                                                                                          │
│ 12インチケーキを作業台の皿の上に置く。                                                                                                                              │
│ 1本の木製のダウエルを真っ直ぐ下に押し込み、ケーキの中央を完全に貫通させる。                                                                                              │
│ ダウエルをフロスティングの上部から1/4インチの高さにマーク。                                                                                                                                  │
│ ダウエルを取り外し、マークした位置で鋸歯状のナイフで切断する。                                                                                                                   │
│ 同じ長さに4本のダウエルを切る。                                                                                                                                           │
│ 1本の切断したダウエルをケーキの中央に戻し、                                                                                                                                   │
│ 残りの4本の切断したダウエルをケーキに押し込み、ケーキの端から3 1/2インチ内側に位置させ、均等に間隔をあける。                                                                 │
│ 8インチケーキをその段ボールの上に作業台に置く。                                                                                                                         │
│ 1本のダウエルを真っ直ぐ下に押し込み、ケーキの中央を完全に貫通させる。                                                                                                     │
│ ダウエルをフロスティングの上部から1/4インチの高さにマーク。                                                                                                                                  │
│ ダウエルを取り外し、マークした位置で鋸歯状のナイフで切断する。                                                                                                                   │
│ 同じ長さに3本のダウエルを切る。                                                                                                                                           │
│ 1本の切断したダウエルをケーキの中央に戻し、                                                                                                                                   │
│ 残りの3本の切断したダウエルをケーキに押し込み、端から2 1/2インチ内側に位置させ、均等に間隔をあける。                                                                      │
│ 大きな金属スパチュラを使って、8インチケーキを12インチケーキのダウエルの上に注意深く置き、中心を合わせます。                                                      │
│ 5インチケーキを8インチケーキのダウエルの上に注意深く置き、中心を合わせます。                                                                                  │
│ シトラスストリッパーを使用して、オレンジからオレンジの皮の長いストリップを切り取ります。                                                                                                         │
│ ストリップを長いセグメントに切断します。                                                                                                                                              │
│ オレンジの皮のコイルを作るには、皮のセグメントを木製のスプーンのハンドルに巻きつけます；皮がコイル状の形を保つように、ハンドルから優しく滑らせます。                                   │
│ ケーキをオレンジの皮のコイル、アイビーやミントの枝、一部のベリーで飾ります。                                                                                                  │
│ （組み立てたケーキは最大8時間前に作ることができます。                                                                                                                            │
│ 暖かい室温で放置します。）                                                                                                                                        │
│ 上部と中央のケーキの層を取り外します。                                                                                                                                           │
│ ケーキからダウエルを取り外します。                                                                                                                                                   │
│ 上部と中央のケーキをスライスします。                                                                                                                                       │
│ 12インチケーキを切るには：端から3インチ内側に始めてナイフを真っ直ぐ下に挿入し、上から下まで切り込み、中央に6インチの直径の円を作ります。 │
│ ケーキの外側の部分をスライスし、内側の部分もスライスし、ストロベリーと一緒に提供します。                                                                           │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

126行のセットです。経過時間: 0.011秒。処理した行数: 8.19千行、サイズ: 5.34 MB (737.75千行/秒、480.59 MB/秒)
```
### オンラインプレイグラウンド {#online-playground}

データセットは、[オンラインプレイグラウンド](https://sql.clickhouse.com?query_id=HQXNQZE26Z1QWYP9KC76ML)でも利用可能です。
