---
sidebar_label: 'Настройка IP фильтров'
slug: /cloud/security/setting-ip-filters
title: 'Настройка IP фильтров'
description: 'Эта страница объясняет, как настроить IP фильтры в ClickHouse Cloud для контроля доступа к услугам ClickHouse.'
---

import Image from '@theme/IdealImage';
import ip_filtering_after_provisioning from '@site/static/images/cloud/security/ip-filtering-after-provisioning.png';
import ip_filter_add_single_ip from '@site/static/images/cloud/security/ip-filter-add-single-ip.png';

## Настройка IP фильтров {#setting-ip-filters}

IP списки доступа фильтруют трафик к вашим услугам ClickHouse, указывая, какие исходные адреса могут подключаться к вашей услуге ClickHouse. Списки конфигурабельны для каждой услуги. Списки могут быть настроены во время развертывания услуги или после него. Если вы не настроили список доступа IP во время обеспечения, или если вы хотите изменить свой первоначальный список, вы можете внести эти изменения, выбрав услугу, а затем вкладку **Безопасность**.

:::important
Если вы пропустите создание списка доступа IP для услуги ClickHouse Cloud, тогда никакой трафик не будет разрешен к услуге.
:::

## Подготовка {#prepare}
Прежде чем начать, соберите IP адреса или диапазоны, которые должны быть добавлены в список доступа. Учитывайте удалённых работников, места вызова, VPN и т.д. Интерфейс пользователя списка доступа IP принимает отдельные адреса и обозначение CIDR.

Обозначение безклассовой междоменной маршрутизации (CIDR) позволяет вам указывать диапазоны IP адресов, меньшие, чем традиционные размеры маски подсети классов A, B или C (8, 6 или 24). [ARIN](https://account.arin.net/public/cidrCalculator) и несколько других организаций предоставляют калькуляторы CIDR, если вам нужно, и если вы хотите больше информации о нотации CIDR, пожалуйста, смотрите [Безклассовая междоменная маршрутизация (CIDR)](https://www.rfc-editor.org/rfc/rfc4632.html) RFC.

## Создание или изменение списка доступа IP {#create-or-modify-an-ip-access-list}

Из списка своих услуг ClickHouse Cloud выберите услугу, а затем выберите **Настройки**. В разделе **Безопасность** вы найдете список доступа IP. Щелкните по гиперссылке, где написано: *Вы можете подключиться к этой услуге из* **(откуда угодно | x конкретные места)**

Появится боковая панель с опциями для настройки:

- Разрешить входящий трафик откуда угодно к услуге
- Разрешить доступ с конкретных мест к услуге
- Запретить весь доступ к услуге

Скриншот показывает список доступа, который позволяет трафик из диапазона IP адресов, описанный как "Диапазон офиса NY":

<Image img={ip_filtering_after_provisioning} size="md" alt="Существующий список доступа в ClickHouse Cloud" border/>

### Возможные действия {#possible-actions}

1. Чтобы добавить дополнительный элемент, вы можете использовать **+ Добавить новый IP**

   Этот пример добавляет один IP адрес с описанием `Лондонский сервер`:

<Image img={ip_filter_add_single_ip} size="md" alt="Добавление одного IP в список доступа в ClickHouse Cloud" border/>

1. Удалить существующий элемент

   Кликнув по крестику (x), можно удалить элемент

1. Отредактировать существующий элемент

   Прямое изменение элемента

1. Переключиться на разрешение доступа с **Любого места**

   Это не рекомендуется, но разрешено. Мы рекомендуем делать приложение, построенное на ClickHouse, доступным для публики и ограничивать доступ к бэк-энду сервиса ClickHouse Cloud.

Чтобы применить изменения, которые вы внесли, обязательно нажмите **Сохранить**.

## Проверка {#verification}

После создания фильтра подтвердите подключение из указанного диапазона и убедитесь, что подключения снаружи разрешенного диапазона отклоняются. Простая команда `curl` может быть использована для проверки:
```bash title="Попытка отклонена снаружи разрешенного списка"
curl https://<HOSTNAME>.clickhouse.cloud:8443
```
```response
curl: (35) error:02FFF036:system library:func(4095):Connection reset by peer
```
или
```response
curl: (35) LibreSSL SSL_connect: SSL_ERROR_SYSCALL in connection to HOSTNAME.clickhouse.cloud:8443
```

```bash title="Попытка разрешена изнутри разрешенного списка"
curl https://<HOSTNAME>.clickhouse.cloud:8443
```
```response
Ok.
```

## Ограничения {#limitations}

- В настоящее время списки доступа IP поддерживают только IPv4
