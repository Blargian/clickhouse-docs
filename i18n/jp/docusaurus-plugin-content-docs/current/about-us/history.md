---
slug: /about-us/history
sidebar_label: 'ClickHouseの歴史'
sidebar_position: 40
description: 'ClickHouseの開発の歴史'
keywords: ['history','development','Metrica']
title: 'ClickHouseの歴史'
---


# ClickHouseの歴史 {#clickhouse-history}

ClickHouseは、[Yandex.Metrica](https://metrica.yandex.com/)を支えるために最初に開発されました。[世界で2番目に大きなウェブ解析プラットフォーム](http://w3techs.com/technologies/overview/traffic_analysis/all)であり、現在でもその中核を成しています。データベース内に130兆件以上のレコードがあり、毎日200億以上のイベントが処理されるClickHouseは、非集約データからその場でカスタムレポートを生成することを可能にします。本記事では、ClickHouseの初期の開発目標について簡単に説明します。

Yandex.Metricaは、ユーザーによって定義された任意のセグメントに基づいてヒット数やセッションに応じたカスタマイズされたレポートをその場で構築します。このプロセスでは、ユニークユーザー数のような複雑な集計を構築する必要があることが多く、新しいデータがリアルタイムでレポート構築に使用されます。

2014年4月の時点で、Yandex.Metricaは毎日120億件のイベント（ページビューやクリック）を追跡していました。これらの全てのイベントは、カスタムレポートを作成するために保存する必要がありました。単一のクエリの実行には、数百ミリ秒で数百万行、あるいは数秒で数億行をスキャンすることが求められました。

## Yandex.Metricaおよび他のYandexサービスでの使用 {#usage-in-yandex-metrica-and-other-yandex-services}

ClickHouseは、Yandex.Metricaにおいて複数の目的に使われています。
その主な目的は、非集約データを使用してオンラインモードでレポートを構築することです。374台のサーバークラスターを使用しており、データベース内には203兆行以上の行が保存されています。圧縮データのボリュームは約2PBで、重複やレプリカは考慮していません。非圧縮データのボリューム（TSV形式で）は約17PBになります。

ClickHouseはまた、以下のプロセスにおいて重要な役割を果たしています：

- Yandex.Metricaからのセッションリプレイのためのデータ保存。
- 中間データの処理。
- 分析を用いたグローバルレポートの構築。
- Yandex.Metricaエンジンのデバッグ用クエリの実行。
- APIおよびユーザーインターフェースからのログ分析。

現在、他のYandexサービスや部門において、ClickHouseのインストールは数十件存在します：検索縦列、eコマース、広告、ビジネス分析、モバイル開発、個人サービスなど。

## 集約データと非集約データ {#aggregated-and-non-aggregated-data}

統計を効果的に計算するためには、データを集約する必要があるという広く知られた意見があります。これによりデータのボリュームが減少します。

しかし、データ集約には多くの制限が伴います：

- 必要なレポートの事前定義リストが必要です。
- ユーザーはカスタムレポートを作成できません。
- 多数の異なるキーにわたって集約する際、データボリュームはほとんど減少せず、集約は無駄になります。
- 多数のレポートに対しては、集約のバリエーションが多すぎます（組み合わせ爆発）。
- 高いカーディナリティを持つキー（URLなど）で集約する際、データボリュームはあまり減少しません（2倍未満）。
- このため、集約におけるデータボリュームは縮小ではなく増加する可能性があります。
- ユーザーは、私たちが生成する全てのレポートを見るわけではありません。そのため、多くの計算は無駄になります。
- 様々な集約のためにデータの論理的整合性が損なわれることがあります。

何も集約せずに非集約データで作業する場合、計算量が減る可能性があります。

しかし、集約を用いることで作業の大部分がオフラインで行われ、比較的落ち着いて完了することができます。これに対し、オンライン計算ではできるだけ早く計算を行うことが求められるため、ユーザーは結果を待っています。

Yandex.Metricaには、Metrageというデータ集約のための専門的なシステムがあり、これが大部分のレポートで使用されていました。
2009年以降、Yandex.Metricaは非集約データのためにOLAPServerという専門のOLAPデータベースも使用していました。これは以前はレポートビルダーに使用されていました。
OLAPServerは非集約データに対してはうまく機能しましたが、希望通りの全てのレポートに使用できない多くの制限がありました。これには、データ型のサポート（数値のみ）の欠如や、リアルタイムでデータを段階的に更新する能力の欠如（データは日々書き換えることでしか更新できませんでした）が含まれます。OLAPServerはDBMSではなく、専門のDBです。

ClickHouseの初期の目標は、OLAPServerの制限を排除し、全てのレポートに対して非集約データで作業する問題を解決することでしたが、年月が経つにつれ、幅広い分析タスクに適した汎用のデータベース管理システムへと成長しました。
