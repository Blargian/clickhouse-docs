---
alias: []
description: 'Документация для формата DWARF'
input_format: true
keywords: ['DWARF']
output_format: false
slug: /interfaces/formats/DWARF
title: 'DWARF'
---

| Input | Output  | Alias |
|-------|---------|-------|
| ✔     | ✗       |       |

## Описание {#description}

Формат `DWARF` разбирает символы отладки DWARF из ELF файла (исполняемого, библиотеки или объектного файла). Он похож на `dwarfdump`, но намного быстрее (сотни МБ/с) и поддерживает SQL. Он производит одну строку для каждого элемента информации отладки (DIE) в секции `.debug_info` и включает "нулевые" записи, которые кодировка DWARF использует для завершения списков дочерних элементов в дереве.

:::info
`.debug_info` состоит из *единиц*, которые соответствуют единицам компиляции: 
- Каждая единица представляет собой дерево *DIE*, с `compile_unit` DIE в качестве корня. 
- Каждый DIE имеет *тег* и список *атрибутов*. 
- Каждый атрибут имеет *имя* и *значение* (а также *форму*, которая указывает, как значение закодировано). 

DIE представляют вещи из исходного кода, и их *тег* указывает, какого рода это вещь. Например, существуют:

- функции (тег = `subprogram`)
- классы/структуры/перечисления (`class_type`/`structure_type`/`enumeration_type`)
- переменные (`variable`)
- аргументы функций (`formal_parameter`).

Структура дерева отражает соответствующий исходный код. Например, `class_type` DIE может содержать `subprogram` DIE, представляющие методы класса.
:::

Формат `DWARF` выводит следующие столбцы:

- `offset` - позиция DIE в секции `.debug_info`
- `size` - число байт в закодированном DIE (включая атрибуты)
- `tag` - тип DIE; общепринятый префикс "DW_TAG_" опущен
- `unit_name` - имя единицы компиляции, содержащей этот DIE
- `unit_offset` - позиция единицы компиляции, содержащей этот DIE в секции `.debug_info`
- `ancestor_tags` - массив тегов предков текущего DIE в дереве, в порядке от самого внутреннего к самому внешнему
- `ancestor_offsets` - смещения предков, параллельные `ancestor_tags`
- несколько общих атрибутов, продублированных из массива атрибутов для удобства:
    - `name`
    - `linkage_name` - искаженное полное имя; обычно только у функций есть это (но не у всех функций)
    - `decl_file` - имя файла исходного кода, где этот элемент был объявлен
    - `decl_line` - номер строки в исходном коде, где этот элемент был объявлен
- параллельные массивы, описывающие атрибуты:
    - `attr_name` - имя атрибута; общепринятый префикс "DW_AT_" опущен
    - `attr_form` - как атрибут кодируется и интерпретируется; общепринятый префикс DW_FORM_ опущен
    - `attr_int` - целочисленное значение атрибута; 0, если у атрибута нет числового значения
    - `attr_str` - строковое значение атрибута; пустое, если у атрибута нет строкового значения

## Пример использования {#example-usage}

Формат `DWARF` можно использовать для нахождения единиц компиляции, которые имеют наибольшее количество определений функций (включая инстанциации шаблонов и функции из включенных заголовочных файлов):

```sql title="Запрос"
SELECT
    unit_name,
    count() AS c
FROM file('programs/clickhouse', DWARF)
WHERE tag = 'subprogram' AND NOT has(attr_name, 'declaration')
GROUP BY unit_name
ORDER BY c DESC
LIMIT 3
```
```text title="Ответ"
┌─unit_name──────────────────────────────────────────────────┬─────c─┐
│ ./src/Core/Settings.cpp                                    │ 28939 │
│ ./src/AggregateFunctions/AggregateFunctionSumMap.cpp       │ 23327 │
│ ./src/AggregateFunctions/AggregateFunctionUniqCombined.cpp │ 22649 │
└────────────────────────────────────────────────────────────┴───────┘

3 строки в наборе. Затраченное время: 1.487 сек. Обработано 139.76 миллионов строк, 1.12 ГБ (93.97 миллионов строк/с, 752.77 МБ/с.)
Максимальное использование памяти: 271.92 МБ.
```

## Настройки формата {#format-settings}
