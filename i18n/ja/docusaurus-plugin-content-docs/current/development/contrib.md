---
slug: /development/contrib
sidebar_position: 60
sidebar_label: サードパーティライブラリ
---

# サードパーティライブラリ

ClickHouseは、他のデータベースとの接続、ディスクからの読み込み/保存時のデータのデコード/エンコード、または特定の特殊なSQL関数の実装など、さまざまな目的のためにサードパーティライブラリを利用しています。ターゲットシステムで利用可能なライブラリに依存しないように、各サードパーティライブラリはClickHouseのソースツリーにGitサブモジュールとしてインポートされ、ClickHouseと共にコンパイルおよびリンクされます。サードパーティライブラリとそのライセンスの一覧は、以下のクエリを使用して取得できます。

``` sql
SELECT library_name, license_type, license_path FROM system.licenses ORDER BY library_name COLLATE 'en';
```

リストアップされているライブラリは、ClickHouseリポジトリの`contrib/`ディレクトリ内にあるものです。ビルドオプションによっては、一部のライブラリがコンパイルされていない場合があり、その結果、ランタイムでその機能が利用できなくなることがあります。

[例](https://sql.clickhouse.com?query_id=478GCPU7LRTSZJBNY3EJT3)

## サードパーティライブラリの追加と管理 {#adding-and-maintaining-third-party-libraries}

各サードパーティライブラリは、ClickHouseリポジトリの`contrib/`ディレクトリ内に専用のディレクトリを持つ必要があります。外部コードのコピーをライブラリディレクトリにダンプすることは避けてください。代わりに、Gitサブモジュールを作成して、外部のアップストリームリポジトリからサードパーティコードを取得します。

ClickHouseで使用されるすべてのサブモジュールは`.gitmodule`ファイルにリストされています。
- ライブラリをそのまま使用できる場合（デフォルトの場合）、アップストリームリポジトリを直接参照できます。
- ライブラリにパッチを当てる必要がある場合は、[GitHubのClickHouse組織](https://github.com/ClickHouse)でアップストリームリポジトリのフォークを作成してください。

後者の場合、カスタムパッチを可能な限りアップストリームのコミットから切り離すことを目指します。そのために、統合したいブランチまたはタグから`ClickHouse/`プレフィックスのブランチを作成します。例えば、`ClickHouse/2024_2`（ブランチ`2024_2`の場合）や`ClickHouse/release/vX.Y.Z`（タグ`release/vX.Y.Z`の場合）です。フォークリポジトリ内で、アップストリームの開発ブランチ`master`/`main`/`dev`に従うことは避けてください（つまり、`ClickHouse/master` / `ClickHouse/main` / `ClickHouse/dev`というプレフィックスブランチ）。そのようなブランチは動的なターゲットであり、適切なバージョニングを困難にします。“プレフィックスブランチ”は、アップストリームリポジトリからフォークへのプルがカスタム`ClickHouse/`ブランチに影響を与えないようにします。`contrib/`内のサブモジュールは、フォークされたサードパーティリポジトリの`ClickHouse/`ブランチのみを追跡する必要があります。

パッチは外部ライブラリの`ClickHouse/`ブランチに対してのみ適用されます。

これを行う方法は2つあります：
- フォークされたリポジトリの `ClickHouse/` プレフィックスブランチに対して新しい修正を行いたい場合（例：サニタイザーに関する修正）、`ClickHouse/`プレフィックスを持つブランチとして修正をプッシュします。例えば、`ClickHouse/fix-sanitizer-disaster`。次に、新しいブランチからカスタムトラッキングブランチに対してPRを作成します（例：`ClickHouse/2024_2 <-- ClickHouse/fix-sanitizer-disaster`）そしてPRをマージします。
- サブモジュールを更新し、以前のパッチを再適用する必要がある場合。この場合、古いPRを再作成するのはオーバーキルです。代わりに、単に新しい`ClickHouse/`ブランチ（新しいバージョンに対応）に古いコミットをチェリーピックしてください。複数のコミットがあったPRのコミットをスカッシュしても構いません。最良の場合、私たちはカスタムパッチをアップストリームに再度貢献し、新しいバージョンではパッチを省略できるかもしれません。

サブモジュールが更新されたら、ClickHouse内のサブモジュールを新しいハッシュが指すように更新します。

サードパーティライブラリのパッチを公式リポジトリを念頭に置いて作成し、そのパッチをアップストリームリポジトリに再度貢献することを考慮してください。これにより、他のユーザーもパッチの恩恵を受けることができ、ClickHouseチームにとって保守の負担にならないようにします。
