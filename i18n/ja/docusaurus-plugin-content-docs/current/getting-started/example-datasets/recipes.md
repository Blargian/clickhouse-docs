---
description: "RecipeNLGデータセットには220万のレシピが含まれています"
slug: /getting-started/example-datasets/recipes
sidebar_label: レシピデータセット
title: "レシピデータセット"
---

RecipeNLGデータセットは[こちらから](https://recipenlg.cs.put.poznan.pl/dataset)ダウンロードできます。220万のレシピが含まれており、サイズはおおよそ1GB未満です。

## データセットのダウンロードと解凍 {#download-and-unpack-the-dataset}

1. ダウンロードページにアクセス [https://recipenlg.cs.put.poznan.pl/dataset](https://recipenlg.cs.put.poznan.pl/dataset)。
2. 利用規約に同意し、zipファイルをダウンロードします。
3. オプション: `md5sum dataset.zip`を使用してzipファイルを検証し、`3a168dfd0912bb034225619b3586ce76`と等しいか確認します。
4. `unzip dataset.zip`を使用してzipファイルを解凍します。`dataset`ディレクトリ内に`full_dataset.csv`ファイルが得られます。

## テーブルの作成 {#create-a-table}

clickhouse-clientを実行し、以下のCREATEクエリを実行します:

``` sql
CREATE TABLE recipes
(
    title String,
    ingredients Array(String),
    directions Array(String),
    link String,
    source LowCardinality(String),
    NER Array(String)
) ENGINE = MergeTree ORDER BY title;
```

## データの挿入 {#insert-the-data}

以下のコマンドを実行します:

``` bash
clickhouse-client --query "
    INSERT INTO recipes
    SELECT
        title,
        JSONExtract(ingredients, 'Array(String)'),
        JSONExtract(directions, 'Array(String)'),
        link,
        source,
        JSONExtract(NER, 'Array(String)')
    FROM input('num UInt32, title String, ingredients String, directions String, link String, source LowCardinality(String), NER String')
    FORMAT CSVWithNames
" --input_format_with_names_use_header 0 --format_csv_allow_single_quote 0 --input_format_allow_errors_num 10 < full_dataset.csv
```

これはカスタムCSVを解析する方法の一例です。いくつかの調整が必要です。

説明:
- データセットはCSV形式ですが、挿入時にいくつかの前処理が必要です; テーブル関数[input](../../sql-reference/table-functions/input.md)を使用して前処理を行います;
- CSVファイルの構造は、テーブル関数`input`の引数に指定されています;
- `num`フィールド（行番号）は不要であり、ファイルから解析され、無視されます;
- `FORMAT CSVWithNames`を使用しますが、CSV内のヘッダは無視されます（コマンドラインパラメータ`--input_format_with_names_use_header 0`によって）、ヘッダには最初のフィールドの名前が含まれていないためです;
- ファイルはCSV文字列を囲むためにダブルクオーテーションのみを使用しています; いくつかの文字列はダブルクオーテーションで囲まれておらず、シングルクオーテーションは文字列の囲いとして解析されるべきではありません - そのため、`--format_csv_allow_single_quote 0`パラメータも追加します;
- CSVからの一部の文字列は解析できません; なぜなら、それらは値の先頭に`\M/`シーケンスを含むからです; CSV内でバックスラッシュで始まる唯一の値は、SQL NULLとして解析される `\N` です。`--input_format_allow_errors_num 10`パラメータを追加し、最大10の不正なレコードをスキップできます;
- 材料、調理手順、NERフィールドに配列があります; これらの配列は珍しい形式で表現されています: それらは文字列としてJSONにシリアライズされ、次にCSVに配置されます - 文字列として解析した後、[JSONExtract](../../sql-reference/functions/json-functions.md)関数を使用して配列に変換します。

## 挿入したデータの検証 {#validate-the-inserted-data}

行数を確認することで:

クエリ:

``` sql
SELECT count() FROM recipes;
```

結果:

``` text
┌─count()─┐
│ 2231142 │
└─────────┘
```

## 例となるクエリ {#example-queries}

### レシピの数によるトップコンポーネント: {#top-components-by-the-number-of-recipes}

この例では、[arrayJoin](../../sql-reference/functions/array-join.md)関数を使用して配列を行のセットに展開する方法を学びます。

クエリ:

``` sql
SELECT
    arrayJoin(NER) AS k,
    count() AS c
FROM recipes
GROUP BY k
ORDER BY c DESC
LIMIT 50
```

結果:

``` text
┌─k────────────────────┬──────c─┐
│ salt                 │ 890741 │
│ sugar                │ 620027 │
│ butter               │ 493823 │
│ flour                │ 466110 │
│ eggs                 │ 401276 │
│ onion                │ 372469 │
│ garlic               │ 358364 │
│ milk                 │ 346769 │
│ water                │ 326092 │
│ vanilla              │ 270381 │
│ olive oil            │ 197877 │
│ pepper               │ 179305 │
│ brown sugar          │ 174447 │
│ tomatoes             │ 163933 │
│ egg                  │ 160507 │
│ baking powder        │ 148277 │
│ lemon juice          │ 146414 │
│ Salt                 │ 122558 │
│ cinnamon             │ 117927 │
│ sour cream           │ 116682 │
│ cream cheese         │ 114423 │
│ margarine            │ 112742 │
│ celery               │ 112676 │
│ baking soda          │ 110690 │
│ parsley              │ 102151 │
│ chicken              │ 101505 │
│ onions               │  98903 │
│ vegetable oil        │  91395 │
│ oil                  │  85600 │
│ mayonnaise           │  84822 │
│ pecans               │  79741 │
│ nuts                 │  78471 │
│ potatoes             │  75820 │
│ carrots              │  75458 │
│ pineapple            │  74345 │
│ soy sauce            │  70355 │
│ black pepper         │  69064 │
│ thyme                │  68429 │
│ mustard              │  65948 │
│ chicken broth        │  65112 │
│ bacon                │  64956 │
│ honey                │  64626 │
│ oregano              │  64077 │
│ ground beef          │  64068 │
│ unsalted butter      │  63848 │
│ mushrooms            │  61465 │
│ Worcestershire sauce │  59328 │
│ cornstarch           │  58476 │
│ green pepper         │  58388 │
│ Cheddar cheese       │  58354 │
└──────────────────────┴────────┘

50行がセットされました。経過時間: 0.112秒。2.23百万行、361.57 MBが処理されました (19.99百万行/s, 3.24 GB/s)。
```

### いちごを使った最も複雑なレシピ {#the-most-complex-recipes-with-strawberry}

``` sql
SELECT
    title,
    length(NER),
    length(directions)
FROM recipes
WHERE has(NER, 'strawberry')
ORDER BY length(directions) DESC
LIMIT 10
```

結果:

``` text
┌─title────────────────────────────────────────────────────────────┬─length(NER)─┬─length(directions)─┐
│ チョコレート-イチゴ-オレンジウェディングケーキ                │          24 │                126 │
│ イチゴクリームチーズクランブルタルト                          │          19 │                 47 │
│ シャルロットスタイルアイスクリーム                             │          11 │                 45 │
│ 恐ろしいほどおいしい！ミリオンレイヤーチョコレートケーキ（イチゴ入り） │          31 │                 45 │
│ エルダーフラワーシャーベットで甘くしたベリー                   │          24 │                 44 │
│ チョコレート-イチゴムースケーキ                               │          15 │                 42 │
│ イチゴとラムのルバーブシャルロット                             │          20 │                 42 │
│ シェフのジョーイのイチゴバニラタルト                          │           7 │                 37 │
│ オールドファッションアイスクリームサンデーケーキ             │          17 │                 37 │
│ スイカケーキ                                                 │          16 │                 36 │
└──────────────────────────────────────────────────────────────────┴─────────────┴────────────────────┘

10行がセットされました。経過時間: 0.215秒。2.23百万行、1.48 GBが処理されました (10.35百万行/s, 6.86 GB/s)。
```

この例では、[has](../../sql-reference/functions/array-functions.md#hasarr-elem)関数を使用して配列要素でフィルタリングし、手順の数でソートします。

126ステップを要するウェディングケーキが存在します！その手順を示します:

クエリ:

``` sql
SELECT arrayJoin(directions)
FROM recipes
WHERE title = 'チョコレート-イチゴ-オレンジウェディングケーキ'
```

結果:

``` text
┌─arrayJoin(directions)───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ オーブンの中央に1つ、下の3分の1に1つのラックを置き、350Fに予熱します。                                                                                           │
│ 5インチ直径、2インチ高のケーキ型1つ、8インチ直径、2インチ高のケーキ型1つ、12インチ直径、2インチ高のケーキ型1つをバターで塗ります。   │
│ 型に粉をまぶし、底にパーチメントを敷きます。                                                                                                                          │
│ 小さな重い鍋に1/3カップのオレンジジュースと2オンスの無糖チョコレートを組み合わせます。                                                                                    │
│ 中低火で混合物をかき混ぜながら、チョコレートが溶けるまで加熱します。                                                                                                                    │
│ 火から下ろします。                                                                                                                                                           │
│ 1 2/3カップのオレンジジュースを徐々に混ぜます。                                                                                                                                   │
│ 大きなボウルに3カップの粉、2/3カップのココア、2小さじの重曹、1小さじの塩、1/2小さじのベーキングパウダーをふるい入れます。                                                 │
│ 電動ミキサーを使用して、大きなボウルで1カップ（2本）バターと3カップの砂糖を混ぜ、混合物がブレンドされるまで混ぜます（混合物は粒状になります）。                                                 │
│ 卵4個を1個ずつ加え、その都度よく混ぜます。                                                                                                                       │
│ オレンジの皮の1大さじとバニラエッセンスの1大さじを加えます。                                                                                                          │
│ 乾燥成分をオレンジジュースの混合物と3回交互に加え、その都度よく混ぜます。                                                            │
│ 1カップのチョコレートチップを混ぜます。                                                                                                                                               │
│ 準備した5インチ型に1カップと2大さじの生地を、準備した8インチ型に3カップの生地、残りの生地（約6カップ）を12インチ型に移します。                   │
│ 5インチと8インチの型をオーブンの中央のラックに置きます。                                                                                                                        │
│ 12インチの鍋をオーブンの下のラックに置きます。                                                                                                                                    │
│ 竹串を中央に差し込んで、よく焼けるまで約35分焼きます。                                                                                             │
│ 型からケーキをラックに取り出し、完全に冷却します。                                                                                                                        │
│ 直径4インチの円を一つの6インチの厚紙のケーキボードにマークします。                                                                                                    │
│ マークした円を切り抜きます。                                                                                                                                                      │
│ マークした8インチの厚紙のケーキボードに7インチの円をマークします。                                                                                                    │
│ マークした円を切り抜きます。                                                                                                                                                      │
│ マークした12インチの厚紙のケーキボードに11インチの円をマークします。                                                                                                  │
│ マークした円を切り抜きます。                                                                                                                                                      │
│ 5インチのケーキの側面を切って緩めます。                                                                                                                                  │
│ 厚紙を型の上に置きます。                                                                                                                                            │
│ 厚紙と型を一緒に持ち、ケーキを厚紙の上にひっくり返します。                                                                                                              │
│ パーチメントを剥がします。ケーキを厚紙で包みます。                                                                                                                     │
│ 同じように7インチのケーキ用に厚紙を使い、8インチのケーキのために11インチの厚紙を使って、厚紙で包みます。                        │
│ 残りの材料を使用して、もう1ロットのケーキバッターを作り、上記のように3つのケーキ層を焼きます。                                                               │
│ 型でケーキを冷やします。                                                                                                                                                         │
│ ケーキを型にしっかりと覆い、フォイルで包みます。                                                                                                                                      │
│ （事前に準備しておくことができます。                                                                                                                                                     │
│ 室温で最大1日放置するか、すべてのケーキ層を二重に包んで最大1週間冷凍します。                                                                           │
│ 使用する前にケーキ層を室温に戻します。）                                                                                                                        │
│ 最初の12インチケーキをその厚紙の上に置きます。                                                                                                                  │
│ ケーキの上に2 3/4カップのガナッシュを広げ、端まで広げます。                                                                                                         │
│ ガナッシュの上に2/3カップのジャムを広げ、端に1/2インチのチョコレートの境界を残します。                                                                                                 │
│ ジャムの上に1 3/4カップのホワイトチョコレートフロスティングをスプーンで落とします。                                                                                                             │
│ フロスティングをジャムの上に優しく広げ、端に1/2インチのチョコレートの境界を残します。                                                                                                 │
│ 2つ目の12インチ厚紙の上にココアをこすります。                                                                                                                        │
│ 2つ目の12インチケーキを切って緩めます。                                                                                                                          │
│ 厚紙、ココアの側を下にして型の上に置きます。                                                                                                                                 │
│ ケーキを厚紙の上にひっくり返します。                                                                                                                                               │
│ パーチメントを剥がします。                                                                                                                                                         │
│ ケーキを厚紙から注意深く滑らせて、最初の12インチケーキのフィリングの上に置きます。                                                                                                  │
│ 冷やします。                                                                                                                                                                │
│ 最初の8インチケーキをその厚紙の上に置きます。                                                                                                                   │
│ ケーキの上に1カップのガナッシュを均等に広げ、端まで広げます。                                                                                                                          │
│ 上に1/4カップのジャムを広げ、端に1/2インチのチョコレートの境界を残します。                                                                                                         │
│ ジャムの上に1カップのホワイトチョコレートフロスティングをスプーンで落とします。                                                                                                                  │
│ フロスティングをジャムの上に優しく広げ、端に1/2インチのチョコレートの境界を残します。                                                                                                 │
│ 2つ目の8インチの厚紙でココアをこすります。                                                                                                                                │
│ 2つ目の8インチケーキを切って緩めます。                                                                                                                           │
│ 厚紙、ココアの側を下にして型の上に置きます。                                                                                                                                 │
│ ケーキを厚紙の上にひっくり返します。                                                                                                                                               │
│ パーチメントを剥がします。                                                                                                                                                         │
│ ケーキを厚紙から滑らせて、最初の8インチケーキのフィリングの上に置きます。                                                                                                             │
│ 冷やします。                                                                                                                                                                │
│ 最初の5インチケーキをその厚紙の上に置きます。                                                                                                                   │
│ ケーキの上に1/2カップのガナッシュを均等に広げ、端まで広げます。                                                                                                            │
│ 上に2大さじのジャムを広げ、端に1/2インチのチョコレートの境界を残します。                                                                                                   │
│ ジャムの上に1/3カップのホワイトチョコレートフロスティングをスプーンで落とします。                                                                                                                │
│ フロスティングをジャムの上に優しく広げ、端に1/2インチのチョコレートの境界を残します。                                                                                                 │
│ 2つ目の6インチの厚紙でココアをこすります。                                                                                                                                     │
│ 2つ目の5インチケーキを切って緩めます。                                                                                                                           │
│ 厚紙、ココアの側を下にして型の上に置きます。                                                                                                                                 │
│ ケーキを厚紙の上にひっくり返します。                                                                                                                                               │
│ パーチメントを剥がします。                                                                                                                                                         │
│ ケーキを厚紙から滑らせて、最初の5インチケーキのフィリングの上に置きます。                                                                                                             │
│ すべてのケーキを冷やして1時間フィリングを固めます。                                                                                                                                      │
│ 12インチの tiered ケーキをその厚紙の上に置き、回転ケーキスタンドに置きます。                                                                                                         │
│ ケーキの上と側面に2 2/3カップのフロスティングを最初のコートとして広げます。                                                                                                      │
│ ケーキを冷やします。                                                                                                                                                           │
│ 8インチの tiered ケーキをその厚紙の上に置き、ケーキスタンドに置きます。                                                                                                                    │
│ ケーキの上と側面に1 1/4カップのフロスティングを最初のコートとして広げます。                                                                                                      │
│ ケーキを冷やします。                                                                                                                                                           │
│ 5インチの tiered ケーキをその厚紙の上に置き、ケーキスタンドに置きます。                                                                                                                    │
│ ケーキの上と側面に3/4カップのフロスティングを最初のコートとして広げます。                                                                                                         │
│ 最初のフロスティングのコートが固まるまで、すべてのケーキを冷やします。約1時間。                                                                                                      │
│ （ケーキはこの時点まで、最大1日前に準備できます; カバーして冷蔵します。）                                                                                            │
│ フロスティングの残りの材料を使って、2回目のフロスティングのバッチを準備し、最初のバッチの手順に従います。                                                            │
│ 小さな星形の先が付いた絞り袋に2カップのフロスティングを入れます。                                                                                                           │
│ 12インチのケーキを大きな平らな皿の上に置きます。                                                                                                                  │
│ 皿をケーキスタンドの上に置きます。                                                                                                                                                │
│ アイスパテラで、ケーキの上と側面に2 1/2カップのフロスティングを広げ、上を平滑にします。                                                                                   │
│ 満たされた絞り袋を使って、ケーキの上端に装飾的なボーダーを絞ります。                                                                                                    │
│ 皿の上でケーキを冷やします。                                                                                                                                                │
│ 8インチのケーキをその厚紙の上に置き、ケーキスタンドに置きます。                                                                                                                           │
│ アイスパテラで、ケーキの上と側面に1 1/2カップのフロスティングを広げ、上を平滑にします。                                                                                     │
│ 絞り袋を使って、ケーキの上端に装飾的なボーダーを絞ります。                                                                                                           │
│ 厚紙の上に置いて冷やします。                                                                                                                                          │
│ 5インチのケーキをその厚紙の上に置き、ケーキスタンドに置きます。                                                           │
│ アイスパテラで、ケーキの上と側面に3/4カップのフロスティングを広げ、上を平滑にします。                                                                                        │
│ 絞り袋を使って、ケーキの上端に装飾的なボーダーを絞り、必要に応じて袋にフロスティングを追加します。                                                             │
│ 厚紙の上でケーキを冷やします。                                                                                                                                          │
│ フロスティングが固まるまで、すべてのケーキを冷蔵します。約2時間。                                                                                                             │
│ （2日前まで準備できます。                                                                                                                                              │
│ ゆるくカバーして冷蔵します。）                                                                                                                                          │
│ 12インチのケーキを作業面の皿の上に置きます。                                                                                                                              │
│ 1本の木製のダウエルをケーキの中央に真っ直ぐに押し込み、完全に通します。                                                                                              │
│ ダウエルのトップから1/4インチの高さをマークします。                                                                                                                                  │
│ ダウエルを取り外し、マークした位置で鋸歯状のナイフで切ります。                                                                                                                   │
│ さらに4本のダウエルを同じ長さに切ります。                                                                                                                                           │
│ 1本の切ったダウエルをケーキの中央に押し戻します。                                                                                                                                 │
│ 残りの4本の切ったダウエルをケーキに押し込み、ケーキの端から3 1/2インチ内側に配置して均等に間隔を取ります。                                                                 │
│ 8インチのケーキをその厚紙の上に置き、作業面に置きます。                                                                                                                         │
│ 1本のダウエルをケーキの中央に真っ直ぐに押し込み、完全に通します。                                                                                                     │
│ ダウエルのトップから1/4インチの高さをマークします。                                                                                                                                  │
│ ダウエルを取り外し、マークした位置で鋸歯状のナイフで切ります。                                                                                                                   │
│ さらに3本のダウエルを同じ長さに切ります。                                                                                                                                           │
│ 1本の切ったダウエルをケーキの中央に押し戻します。                                                                                                                                 │
│ 残りの3本の切ったダウエルをケーキに押し込み、端から2 1/2インチ内側に配置して均等に間隔を取ります。                                                                      │
│ 大きな金属のスパテラを支えとして使用し、8インチのケーキを12インチケーキのダウエルの上に置き、注意深く中心を合わせます。                                                      │
│ 5インチのケーキを8インチのケーキのダウエルの上に注意深く置き、中心を合わせます。                                                                                  │
│ 柑橘類の皮むき器を使って、オレンジからオレンジの皮の長いストリップを切り取ります。                                                                                                         │
│ ストリップを長いセグメントに切ります。                                                                                                                                              │
│ オレンジの皮のコイルを作るために、皮のセグメントを木製のスプーンのハンドルの周りに巻きつけ、皮をハンドルから慎重に滑り降ろして皮が巻きついた形を保持するようにします。                                   │
│ ケーキにオレンジの皮のコイル、アイビー、ミントの小枝、そしていくつかのベリーで飾ります。                                                                                                  │
│ （組み立てたケーキは最大8時間前まで作成できます。                                                                                                                            │
│ 涼しい室温で放置します。）                                                                                                                                        │
│ 上部と中央のケーキ層を取り外します。                                                                                                                                           │
│ ケーキからダウエルを取り外します。                                                                                                                                                   │
│ 上部と中央のケーキをスライスします。                                                                                                                                       │
│ 12インチのケーキを切るには: エッジから3インチ内側から始めて、ナイフを真っ直ぐに押し込み、上から下まで切り、ケーキの中央に6インチの円を作ります。│
│ ケーキの外側をスライスし、内側をスライスしてイチゴと一緒に提供します。                                                                           │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

126 行がセットにあります。経過時間: 0.011 秒。8.19 千行、5.34 MB を処理しました（737.75 千行/秒、480.59 MB/秒）。
```

### オンラインプレイグラウンド {#online-playground}

データセットは [オンラインプレイグラウンド](https://sql.clickhouse.com?query_id=HQXNQZE26Z1QWYP9KC76ML) でも利用可能です。
