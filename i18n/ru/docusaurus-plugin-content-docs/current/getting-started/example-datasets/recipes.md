---
description: 'Набор данных RecipeNLG, содержащий 2,2 миллиона рецептов'
sidebar_label: 'Набор данных рецептов'
slug: /getting-started/example-datasets/recipes
title: 'Набор данных рецептов'
---

Набор данных RecipeNLG доступен для загрузки [здесь](https://recipenlg.cs.put.poznan.pl/dataset). Он содержит 2,2 миллиона рецептов. Размер составляет чуть менее 1 ГБ.
## Загрузка и распаковка набора данных {#download-and-unpack-the-dataset}

1. Перейдите на страницу загрузки [https://recipenlg.cs.put.poznan.pl/dataset](https://recipenlg.cs.put.poznan.pl/dataset).
2. Примите условия и загрузите zip-файл.
3. Вариант: Используйте `md5sum dataset.zip`, чтобы проверить zip-файл; он должен равняться `3a168dfd0912bb034225619b3586ce76`.
4. Распакуйте zip-файл с помощью `unzip dataset.zip`. Вы получите файл `full_dataset.csv` в директории `dataset`.
## Создание таблицы {#create-a-table}

Запустите clickhouse-client и выполните следующий запрос CREATE:

```sql
CREATE TABLE recipes
(
    title String,
    ingredients Array(String),
    directions Array(String),
    link String,
    source LowCardinality(String),
    NER Array(String)
) ENGINE = MergeTree ORDER BY title;
```
## Вставка данных {#insert-the-data}

Выполните следующую команду:

```bash
clickhouse-client --query "
    INSERT INTO recipes
    SELECT
        title,
        JSONExtract(ingredients, 'Array(String)'),
        JSONExtract(directions, 'Array(String)'),
        link,
        source,
        JSONExtract(NER, 'Array(String)')
    FROM input('num UInt32, title String, ingredients String, directions String, link String, source LowCardinality(String), NER String')
    FORMAT CSVWithNames
" --input_format_with_names_use_header 0 --format_csv_allow_single_quote 0 --input_format_allow_errors_num 10 < full_dataset.csv
```

Это демонстрация того, как парсить собственный CSV, так как требуется множество настроек.

Объяснение:
- Набор данных в формате CSV, но он требует некоторой предобработки при вставке; мы используем табличную функцию [input](../../sql-reference/table-functions/input.md) для выполнения предобработки;
- Структура файла CSV указана в аргументе табличной функции `input`;
- Поле `num` (номер строки) не нужно — мы парсим его из файла и игнорируем;
- Мы используем `FORMAT CSVWithNames`, но заголовок в CSV будет проигнорирован (с помощью параметра командной строки `--input_format_with_names_use_header 0`), потому что заголовок не содержит имени для первого поля;
- Файл использует только двойные кавычки для заключения строк CSV; некоторые строки не заключены в двойные кавычки, и одинарная кавычка не должна парситься как заключение строки — именно поэтому мы также добавляем параметр `--format_csv_allow_single_quote 0`;
- Некоторые строки из CSV не могут быть распознаны, потому что они содержат последовательность `\M/` в начале значения; единственное значение, начинающееся с обратной косой черты в CSV, может быть `\N`, которое распознается как SQL NULL. Мы добавляем параметр `--input_format_allow_errors_num 10`, и до десяти некорректных записей могут быть пропущены;
- Массивы содержатся для полей ingredients, directions и NER; эти массивы представлены в необычной форме: они сериализованы в строку как JSON и затем помещены в CSV — мы парсим их как String и затем используем функцию [JSONExtract](../../sql-reference/functions/json-functions.md), чтобы преобразовать их в Array.
## Валидация вставленных данных {#validate-the-inserted-data}

Проверив количество строк:

Запрос:

```sql
SELECT count() FROM recipes;
```

Результат:

```text
┌─count()─┐
│ 2231142 │
└─────────┘
```
## Примеры запросов {#example-queries}
### Наиболее употребляемые компоненты по количеству рецептов: {#top-components-by-the-number-of-recipes}

В этом примере мы узнаем, как использовать функцию [arrayJoin](../../sql-reference/functions/array-join.md) для развертывания массива в набор строк.

Запрос:

```sql
SELECT
    arrayJoin(NER) AS k,
    count() AS c
FROM recipes
GROUP BY k
ORDER BY c DESC
LIMIT 50
```

Результат:

```text
┌─k────────────────────┬──────c─┐
│ salt                 │ 890741 │
│ sugar                │ 620027 │
│ butter               │ 493823 │
│ flour                │ 466110 │
│ eggs                 │ 401276 │
│ onion                │ 372469 │
│ garlic               │ 358364 │
│ milk                 │ 346769 │
│ water                │ 326092 │
│ vanilla              │ 270381 │
│ olive oil            │ 197877 │
│ pepper               │ 179305 │
│ brown sugar          │ 174447 │
│ tomatoes             │ 163933 │
│ egg                  │ 160507 │
│ baking powder        │ 148277 │
│ lemon juice          │ 146414 │
│ Salt                 │ 122558 │
│ cinnamon             │ 117927 │
│ sour cream           │ 116682 │
│ cream cheese         │ 114423 │
│ margarine            │ 112742 │
│ celery               │ 112676 │
│ baking soda          │ 110690 │
│ parsley              │ 102151 │
│ chicken              │ 101505 │
│ onions               │  98903 │
│ vegetable oil        │  91395 │
│ oil                  │  85600 │
│ mayonnaise           │  84822 │
│ pecans               │  79741 │
│ nuts                 │  78471 │
│ potatoes             │  75820 │
│ carrots              │  75458 │
│ pineapple            │  74345 │
│ soy sauce            │  70355 │
│ black pepper         │  69064 │
│ thyme                │  68429 │
│ mustard              │  65948 │
│ chicken broth        │  65112 │
│ bacon                │  64956 │
│ honey                │  64626 │
│ oregano              │  64077 │
│ ground beef          │  64068 │
│ unsalted butter      │  63848 │
│ mushrooms            │  61465 │
│ Worcestershire sauce │  59328 │
│ cornstarch           │  58476 │
│ green pepper         │  58388 │
│ Cheddar cheese       │  58354 │
└──────────────────────┴────────┘

50 строк в наборе. Затраченное время: 0.112 сек. Обработано 2.23 миллиона строк, 361.57 MB (19.99 миллиона строк/с., 3.24 GB/с.)
```
### Самые сложные рецепты с клубникой {#the-most-complex-recipes-with-strawberry}

```sql
SELECT
    title,
    length(NER),
    length(directions)
FROM recipes
WHERE has(NER, 'strawberry')
ORDER BY length(directions) DESC
LIMIT 10
```

Результат:

```text
┌─title────────────────────────────────────────────────────────────┬─length(NER)─┬─length(directions)─┐
│ Шоколадно-клубнично-апельсиновый свадебный торт                │          24 │                126 │
│ Клубничный тарт с кремом из сливочного сыра                   │          19 │                 47 │
│ Мороженое в стиле Шарлотты                                     │          11 │                 45 │
│ Греховно вкусный торт с миллионом слоев шоколада с клубникой  │          31 │                 45 │
│ Сладкие ягоды с шертбертом из цветков бузины                   │          24 │                 44 │
│ Шоколадно-клубничный муссовый торт                             │          15 │                 42 │
│ Шарлотка с ревенем и клубникой                                 │          20 │                 42 │
│ Тарт шеф-повара Джои с клубникой и ванилью                    │           7 │                 37 │
│ Торт с мороженым старомодный                                   │          17 │                 37 │
│ Торт из арбуза                                                │          16 │                 36 │
└──────────────────────────────────────────────────────────────────┴─────────────┴────────────────────┘

10 строк в наборе. Время выполнения: 0.215 сек. Обработано 2.23 миллиона строк, 1.48 ГБ (10.35 миллионов строк/с., 6.86 ГБ/с.)
```

В этом примере мы используем [has](../../sql-reference/functions/array-functions.md#hasarr-elem) функцию для фильтрации по элементам массива и сортируем по количеству инструкций.

Существует свадебный торт, который требует целых 126 шагов для его приготовления! Покажем все инструкции:

Запрос:

```sql
SELECT arrayJoin(directions)
FROM recipes
WHERE title = 'Шоколадно-клубнично-апельсиновый свадебный торт'
```

Результат:

```text
┌─arrayJoin(directions)───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ Установите решетку в центре и одну решетку в нижней трети духовки и разогрейте до 350F.                                                                                          │
│ Смажьте один торт диаметром 5 дюймов с высотой 2 дюйма, один торт диаметром 8 дюймов с высотой 2 дюйма и один торт диаметром 12 дюймов с высотой 2 дюйма.                            │
│ Посыпьте формы мукой; выстелите дно пергаментом.                                                                                                                                 │
│ Смешайте 1/3 стакана апельсинового сока и 2 унции несладкого шоколада в небольшой кастрюле с толстым дном.                                                                        │
│ Помешивайте смесь на среднем огне, пока шоколад не растопится.                                                                                                                  │
│ Уберите с огня.                                                                                                                                                                     │
│ Постепенно вмешивайте 1 2/3 стакана апельсинового сока.                                                                                                                          │
│ Просейте 3 стакана муки, 2/3 стакана какао-порошка, 2 чайные ложки разрыхлителя, 1 чайную ложку соли и 1/2 чайной ложки соды в средней миске.                                       │
│ Используя электрический миксер, взбейте 1 стакан (2 палочки) масла и 3 стакана сахара в большой миске до смешивания (смесь будет выглядеть зернистой).                              │
│ Добавьте 4 яйца по одному, взбивая после каждого добавления.                                                                                                                       │
│ Вмешайте 1 столовую ложку апельсиновой цедры и 1 столовую ложку ванильного экстракта.                                                                                             │
│ Добавляйте сухие ингредиенты чередуя с апельсиновым соком в 3 приема, хорошо взбивая после каждого добавления.                                                                  │
│ Вмешайте 1 стакан шоколадных кусочков.                                                                                                                                             │
│ Переложите 1 стакан плюс 2 столовые ложки теста в подготовленную форму диаметром 5 дюймов, 3 стакана теста в подготовленную форму диаметром 8 дюймов и оставшееся тесто (примерно 6 стаканов) в форму диаметром 12 дюймов. │
│ Поместите формы диаметром 5 и 8 дюймов на центральную решетку духовки.                                                                                                            │
│ Поместите форму диаметром 12 дюймов на нижнюю решетку духовки.                                                                                                                    │
│ Выпекайте торты до тех пор, пока тестовая палочка, вставленная в центр, не выйдет чистой, около 35 минут.                                                                         │
│ Переложите торты в формах на решетки и полностью охладите.                                                                                                                         │
│ Нанесите круг диаметром 4 дюйма на один круг картона диаметром 6 дюймов.                                                                                                        │
│ Вырежьте отмеченный круг.                                                                                                                                                          │
│ Нанесите круг диаметром 7 дюймов на один круг картона диаметром 8 дюймов.                                                                                                        │
│ Вырежьте отмеченный круг.                                                                                                                                                          │
│ Нанесите круг диаметром 11 дюймов на один круг картона диаметром 12 дюймов.                                                                                                      │
│ Вырежьте отмеченный круг.                                                                                                                                                          │
│ Проведите ножом по кругу вокруг торта диаметром 5 дюймов, чтобы освободить его.                                                                                                    │
│ Поместите 4-дюймовый картон на форму.                                                                                                                                             │
│ Держите картон и форму вместе; переверните торт на картон.                                                                                                                        │
│ Снимите пергамент. Заверните торты в фольгу на их картоне.                                                                                                                       │
│ Повторите переворачивание, снятие пергамента и обертывание тортов в фольгу, используя 7-дюймовый картон для 8-дюймового торта и 11-дюймовый картон для 12-дюймового торта.             │
│ Используя оставшиеся ингредиенты, сделайте еще одну порцию теста для торта и выпекайте 3 дополнительных пирожных, как описано выше.                                               │
│ Охладите торты в формах.                                                                                                                                                          │
│ Плотно заверните торты в формах в фольгу.                                                                                                                                         │
│ (Могут быть приготовлены заранее.                                                                                                                                                  │
│ Оставьте при комнатной температуре до 1 дня или дважды заверните все слои торта и заморозьте до 1 недели.                                                                        │
│ Дайте слоям торта достичь комнатной температуры перед использованием.)                                                                                                             │
│ Поместите первый 12-дюймовый торт на его картон на рабочую поверхность.                                                                                                         │
│ Распределите 2 3/4 стакана ганаша по верхней части торта и по краям.                                                                                                             │
│ Распределите 2/3 стакана варенья по ганашу, оставляя 1/2 дюйма шоколадной границы по краю.                                                                                       │
│ Разложите 1 3/4 стакана белого шоколадного фростинга ложками по варенью.                                                                                                         │
│ Осторожно распределите фростинг по варенью, оставляя 1/2 дюйма шоколадной границы по краю.                                                                                        │
│ Посыпьте немного какао порошка на второй круг картона диаметром 12 дюймов.                                                                                                       │
│ Проведите ножом по кругу вокруг второго 12-дюймового торта, чтобы освободить его.                                                                                                │
│ Поместите картон, какао-стороной вниз, на форму.                                                                                                                                 │
│ Переверните торт на картон.                                                                                                                                                       │
│ Снимите пергамент.                                                                                                                                                                 │
│ Осторожно снимите торт с картона и положите на начинку первого 12-дюймового торта.                                                                                              │
│ Уберите в холодильник.                                                                                                                                                             │
│ Поместите первый 8-дюймовый торт на его картон на рабочую поверхность.                                                                                                          │
│ Распределите 1 стакан ганаша по верхнему краю торта.                                                                                                                             │
│ Распределите 1/4 стакана варенья, оставляя 1/2-дюймовую шоколадную границу по краю.                                                                                              │
│ Уложите 1 стакан белого шоколадного фростинга ложками по варенью.                                                                                                              │
│ Осторожно распределите фростинг по варенью, оставляя 1/2-дюймовую шоколадную границу по краю.                                                                                   │
│ Посыпьте немного какао на второй круг картона диаметром 8 дюймов.                                                                                                                │
│ Проведите ножом по кругу вокруг второго 8-дюймового торта, чтобы освободить его.                                                                                                │
│ Поместите картон, какао-стороной вниз, на форму.                                                                                                                                 │
│ Переверните торт на картон.                                                                                                                                                       │
│ Снимите пергамент.                                                                                                                                                                 │
│ Осторожно снимите торт с картона и положите на начинку первого 8-дюймового торта.                                                                                               │
│ Уберите в холодильник.                                                                                                                                                             │
│ Поместите первый 5-дюймовый торт на его картон на рабочей поверхности.                                                                                                          │
│ Распределите 1/2 стакана ганаша по верхнему краю торта.                                                                                                                          │
│ Распределите 2 столовые ложки варенья, оставляя 1/2-дюймовую шоколадную границу по краю.                                                                                         │
│ Разложите 1/3 стакана белого шоколадного фростинга ложками по варенью.                                                                                                          │
│ Осторожно распределите фростинг по варенью, оставляя 1/2-дюймовую шоколадную границу по краю.                                                                                   │
│ Посыпьте немного какао на второй круг картона диаметром 6 дюймов.                                                                                                              │
│ Проведите ножом по кругу вокруг второго 5-дюймового торта, чтобы освободить его.                                                                                                │
│ Поместите картон, какао-стороной вниз, на форму.                                                                                                                                 │
│ Переверните торт на картон.                                                                                                                                                       │
│ Снимите пергамент.                                                                                                                                                                 │
│ Осторожно снимите торт с картона и положите на начинку первого 5-дюймового торта.                                                                                               │
│ Охладите все торты в течение 1 часа, чтобы начинка застыла.                                                                                                                    │
│ Поместите 12-дюймовый многослойный торт на его картон на вращающемся подставке для торта.                                                                                       │
│ Распределите 2 2/3 стакана фростинга по верхней части и бокам торта в качестве первого покрытия.                                                                                  │
│ Уберите торт в холодильник.                                                                                                                                                       │
│ Поместите 8-дюймовый многослойный торт на его картон на подставке для торта.                                                                                                     │
│ Распределите 1 1/4 стакана фростинга по верхней части и бокам торта в качестве первого покрытия.                                                                                  │
│ Уберите торт в холодильник.                                                                                                                                                       │
│ Поместите 5-дюймовый многослойный торт на его картон на подставке для торта.                                                                                                     │
│ Распределите 3/4 стакана фростинга по верхней части и бокам торта в качестве первого покрытия.                                                                                   │
│ Уберите все торты в холодильник, пока первое покрытие фростинга не застынет, примерно на 1 час.                                                                                   │
│ (Торты могут быть приготовлены заранее на этом этапе на 1 день; накрыть и хранить в холодильнике.)                                                                               │
│ Приготовьте вторую партию фростинга, используя оставшиеся ингредиенты и следуя указаниям для первой партии.                                                                        │
│ Наполните 2 стакана фростинга в кондитерский пакет с маленьким звездным кончиком.                                                                                                 │
│ Поместите 12-дюймовый торт на его картон на большое плоское блюдо.                                                                                                              │
│ Поместите блюдо на подставку для торта.                                                                                                                                          │
│ Используя шпатель для нанесения глазури, распределите 2 1/2 стакана фростинга по верхней части и бокам торта; выровняйте верх.                                                    │
│ Используя заполненный кондитерский пакет, нанесите декоративный бордюр по верхнему краю торта.                                                                                   │
│ Уберите торт на блюде в холодильник.                                                                                                                                             │
│ Поместите 8-дюймовый торт на его картон на подставке для торта.                                                                                                              │
│ Используя шпатель для глазури, распределите 1 1/2 стакана фростинга по верхней части и бокам торта; выровняйте верх.                                                            │
│ Используя кондитерский пакет, нанесите декоративный бордюр по верхнему краю торта.                                                                                               │
│ Уберите торт на его картоне в холодильник.                                                                                                                                      │
│ Поместите 5-дюймовый торт на его картон на подставке для торта.                                                                                                               │
│ Используя шпатель для глазури, распределите 3/4 стакана фростинга по верхней части и бокам торта; выровняйте верх.                                                              │
│ Используя кондитерский пакет, нанесите декоративный бордюр по верхнему краю торта, добавляя больше фростинга в пакет, если это необходимо.                                          │
│ Уберите торт на его картоне в холодильник.                                                                                                                                      │
│ Храните все торты в холодильнике, пока фростинг не застынет, примерно 2 часа.                                                                                                   │
│ (Может быть приготовлено за 2 дня.                                                                                                                                              │
│ Накройте свободно; храните в холодильнике.)                                                                                                                                      │
│ Поместите 12-дюймовый торт на блюдо на рабочей поверхности.                                                                                                                     │
│ Осторожно введите 1 деревянный шип прямо вниз в центр торта.                                                                                                                    │
│ Отметьте шип на 1/4 дюйма выше верхней части фростинга.                                                                                                                        │
│ Удалите шип и обрежьте его зазубренным ножом по отмеченной точке.                                                                                                              │
│ Обрежьте еще 4 шипа до такой же длины.                                                                                                                                           │
│ Введите один обрезанный шип обратно в центр торта.                                                                                                                               │
│ Введите оставшиеся 4 обрезанных шипа в торт, расположив их на расстоянии 3 1/2 дюйма от краев торта и равномерно распределив.                                                      │
│ Поместите 8-дюймовый торт на его картон на рабочей поверхности.                                                                                                               │
│ Осторожно введите 1 шип прямо вниз в центр торта.                                                                                                                                 │
│ Отметьте шип на 1/4 дюйма выше верхней части фростинга.                                                                                                                        │
│ Удалите шип и обрежьте его зазубренным ножом по отмеченной точке.                                                                                                              │
│ Обрежьте еще 3 шипа до такой же длины.                                                                                                                                           │
│ Введите один обрезанный шип обратно в центр торта.                                                                                                                               │
│ Введите оставшиеся 3 обрезанных шипа в торт, расположив их на расстоянии 2 1/2 дюйма от краев и равномерно распределив.                                                           │
│ Используя большой металлический шпатель в качестве помощи, поместите 8-дюймовый торт на его картон над шипами в 12-дюймовом торте, аккуратно центрируя.                              │
│ Осторожно положите 5-дюймовый торт на его картон над шипами в 8-дюймовом торте, аккуратно центрируя.                                                                            │
│ Используя очиститель цитрусовых, нарежьте длинные полоски апельсиновой кожуры из апельсинов.                                                                                      │
│ Нарежьте полоски на длинные сегменты.                                                                                                                                          │
│ Чтобы сделать спирали из апельсиновой кожуры, оберните сегмент кожуры вокруг ручки деревянной ложки; аккуратно снимите кожуру с ручки, чтобы кожура сохраняла спиралевидную форму.       │
│ Украсьте торт спиралями из апельсиновой кожуры, веточками плюща или мяты и несколькими ягодами.                                                                                  │
│ (Собранный торт можно сделать заранее до 8 часов.                                                                                                                                  │
│ Оставьте при прохладной комнатной температуре.)                                                                                                                                 |
│ Удалите верхние и средние уровни тортов.                                                                                                                                         │
│ Удалите шипы из тортов.                                                                                                                                                           │
│ Нарежьте верхние и средние торты на куски.                                                                                                                                         │
│ Чтобы нарезать 12-дюймовый торт: начиная от края на 3 дюйма вовнутрь и вставляя нож вертикально, разрежьте от верха до низа, чтобы сделать круг диаметром 6 дюймов в центре торта.        │
│ Нарежьте внешнюю часть торта на куски; нарежьте внутреннюю часть на куски и подавайте с клубникой.                                                                                │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

126 строк в наборе. Время выполнения: 0.011 сек. Обработано 8.19 тысячи строк, 5.34 МБ (737.75 тысячи строк/с., 480.59 МБ/с.)
```
### Онлайн-игровая площадка {#online-playground}

Набор данных также доступен в [Онлайн-игровой площадке](https://sql.clickhouse.com?query_id=HQXNQZE26Z1QWYP9KC76ML).
